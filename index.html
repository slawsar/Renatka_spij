<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Śpij Słoneczko | Relaksująca aplikacja do zasypiania</title>
    <!-- Favicon -->
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <!-- Bootstrap CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <!-- Dodatkowe ikony -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Preload plików audio dla szybszego ładowania -->
    <link rel="preload" href="sounds/ocean.wav" as="audio" crossorigin="anonymous">
    <link rel="preload" href="sounds/rain.mp3" as="audio" crossorigin="anonymous">
    <link rel="preload" href="sounds/forest.mp3" as="audio" crossorigin="anonymous">
    <link rel="preload" href="sounds/night.mp3" as="audio" crossorigin="anonymous">
    <link rel="preload" href="sounds/whitenoise.wav" as="audio" crossorigin="anonymous">
    <link rel="preload" href="sounds/dziubasek.mp3" as="audio" crossorigin="anonymous">
    <link rel="preload" href="sounds/dziubasek-vol2.mp3" as="audio" crossorigin="anonymous">
    
    <!-- PWA Support -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0a1128">
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    
    <style>
        /* Główna kolorystyka i ogólne stylowanie */
        :root {
            /* Podstawowe kolory */
            --primary-dark: #0a1128;
            --primary-medium: #1c2541;
            --primary-light: #3a506b;
            --accent: #5bc0be;
            --accent-dark: #3a8a88;
            --text-light: #e9ecef;
            
            /* Przezroczyste warianty kolorów */
            --accent-transparent-light: rgba(91, 192, 190, 0.2);
            --accent-transparent-medium: rgba(91, 192, 190, 0.5);
            --accent-transparent-strong: rgba(91, 192, 190, 0.7);
            --white-transparent-light: rgba(255, 255, 255, 0.05);
            --white-transparent-medium: rgba(255, 255, 255, 0.4);
            --white-transparent-strong: rgba(255, 255, 255, 0.7);
            --black-transparent-light: rgba(0, 0, 0, 0.1);
            --black-transparent-medium: rgba(0, 0, 0, 0.3);
            --black-transparent-strong: rgba(0, 0, 0, 0.5);
            
            /* System cieni */
            --shadow-sm: 0 2px 5px rgba(0, 0, 0, 0.2);
            --shadow-md: 0 4px 15px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 8px 25px rgba(0, 0, 0, 0.4);
            
            /* System zaokrągleń */
            --radius-sm: 8px;
            --radius-md: 10px;
            --radius-lg: 15px;
            
            /* Czas trwania przejść */
            --transition-speed: 0.3s ease;
        }
        
        body {
            background-color: var(--primary-dark);
            color: var(--text-light);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
            transition: background-color var(--transition-speed);
        }
        
        body.light-mode {
            --primary-dark: #e9f5f9;
            --primary-medium: #c4e0f3;
            --primary-light: #93c5fd;
            --accent: #3b82f6;
            --accent-dark: #2563eb;
            --text-light: #0f172a;
            --accent-transparent-light: rgba(59, 130, 246, 0.2);
            --accent-transparent-medium: rgba(59, 130, 246, 0.5);
            --accent-transparent-strong: rgba(59, 130, 246, 0.7);
            background-color: var(--primary-dark);
            color: var(--text-light);
        }
        
        /* Animowane tło z gwiazdami */
        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }
        
        .star {
            position: absolute;
            background-color: white;
            border-radius: 50%;
            opacity: 0;
            animation: twinkle var(--duration, 4s) infinite var(--delay, 0s);
        }
        
        @keyframes twinkle {
            0% { opacity: 0; }
            50% { opacity: var(--intensity, 1); }
            100% { opacity: 0; }
        }
        
        /* Półprzezroczyste chmury */
        .cloud {
            position: absolute;
            background-color: var(--white-transparent-light);
            border-radius: 50%;
            filter: blur(20px);
            animation: float var(--duration, 60s) infinite linear;
            opacity: 0.3;
        }
        
        @keyframes float {
            0% { transform: translateX(-5%); }
            50% { transform: translateX(5%); }
            100% { transform: translateX(-5%); }
        }
        
        /* Główne elementy stylowania */
        .container {
            padding: 2rem 1rem;
            position: relative;
            z-index: 1;
        }
        
        header {
            text-align: center;
            padding: 2rem 0 1rem;
            position: relative;
        }
        
        h1 {
            color: var(--accent);
            font-size: 2.8rem;
            margin-bottom: 0.5rem;
            text-shadow: 0 0 10px var(--accent-transparent-strong);
        }
        
        h2 {
            color: var(--accent);
            font-size: 1.8rem;
            margin: 1.5rem 0;
        }
        
        h3 {
            color: var(--accent);
            font-size: 1.5rem;
        }
        
        .card {
            background-color: var(--primary-medium);
            border: none;
            border-radius: var(--radius-lg);
            margin-bottom: 2rem;
            box-shadow: var(--shadow-md);
            transition: transform var(--transition-speed), box-shadow var(--transition-speed);
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }
        
        /* Stylowanie odtwarzacza dźwięku */
        .sound-player {
            padding: 1.5rem;
        }
        
        .sound-btn {
            background-color: var(--primary-light);
            color: var(--text-light);
            border: none;
            border-radius: var(--radius-md);
            padding: 0.8rem 1.2rem;
            margin: 0.5rem;
            transition: all var(--transition-speed);
            box-shadow: var(--shadow-sm);
        }
        
        .sound-btn:hover {
            background-color: var(--accent);
            color: var(--primary-dark);
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
        }
        
        .sound-btn.active {
            background-color: var(--accent);
            color: var(--primary-dark);
            box-shadow: 0 0 10px var(--accent);
        }
        
        .sound-card {
            background-color: var(--primary-light);
            border-radius: var(--radius-md);
            padding: 1rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            opacity: 0.7;
            transition: opacity var(--transition-speed);
        }
        
        .sound-card.active {
            opacity: 1;
            box-shadow: 0 0 10px var(--accent-transparent-medium);
        }
        
        .sound-wave {
            display: flex;
            align-items: flex-end;
            height: 30px;
            width: 50px;
            margin-right: 10px;
        }
        
        .sound-wave.active span {
            animation: soundWave 1s infinite;
        }
        
        .sound-wave span {
            display: inline-block;
            width: 4px;
            margin: 0 2px;
            background-color: var(--accent);
            height: 5px;
            border-radius: 2px;
        }
        
        @keyframes soundWave {
            0%, 100% { height: 5px; }
            50% { height: 20px; }
        }
        
        .sound-wave span:nth-child(1) { animation-delay: 0.1s; }
        .sound-wave span:nth-child(2) { animation-delay: 0.2s; }
        .sound-wave span:nth-child(3) { animation-delay: 0.05s; }
        .sound-wave span:nth-child(4) { animation-delay: 0.3s; }
        .sound-wave span:nth-child(5) { animation-delay: 0.15s; }
        
        .controls {
            margin-top: 2rem;
        }
        
        .slider-container {
            margin: 1.5rem 0;
        }
        
        .form-label {
            color: var(--accent);
            font-weight: 500;
            font-size: 1.1rem;
            margin-bottom: 0.8rem;
        }
        
        .form-range::-webkit-slider-thumb {
            background: var(--accent);
        }
        
        .form-range::-moz-range-thumb {
            background: var(--accent);
        }
        
        /* Stylowanie timera */
        .timer-container {
            text-align: center;
            margin: 1.5rem 0;
        }
        
        .timer-display {
            font-size: 2.2rem;
            font-weight: bold;
            margin: 1rem 0;
            color: var(--accent);
            text-shadow: 0 0 5px var(--accent-transparent-medium);
        }
        
        .custom-timer-container {
            margin-top: 1rem;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .custom-timer-input {
            width: 80px;
            background-color: var(--primary-medium);
            border: 2px solid var(--accent);
            border-radius: var(--radius-sm);
            color: var(--text-light);
            padding: 0.4rem;
            margin-right: 0.5rem;
            text-align: center;
        }
        
        /* Stylowanie dla ćwiczeń relaksacyjnych */
        .relaxation-exercise {
            text-align: center;
            padding: 1.5rem 0;
        }
        
        .breathing-exercise {
            text-align: center;
            padding: 1.5rem 0;
        }
        
        #breathing-description {
            color: var(--text-light);
            font-weight: 500;
            margin-bottom: 1.2rem;
        }
        
        .breathing-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            margin: 0 auto;
            background-color: var(--accent-transparent-light);
            border: 3px solid var(--accent);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: transform var(--transition-speed), background-color var(--transition-speed);
        }
        
        .breathing-circle.inhale {
            animation: inhale 4s forwards;
        }
        
        .breathing-circle.hold {
            animation: hold 7s forwards;
        }
        
        .breathing-circle.exhale {
            animation: exhale 8s forwards;
        }
        
        .breathing-circle.box-inhale {
            animation: inhale 4s forwards;
        }
        
        .breathing-circle.box-hold1 {
            animation: hold 4s forwards;
        }
        
        .breathing-circle.box-exhale {
            animation: exhale 4s forwards;
        }
        
        .breathing-circle.box-hold2 {
            animation: hold 4s forwards;
        }
        
        .muscle-relaxation-section {
            margin-top: 1.5rem;
            padding: 1rem;
            border-radius: var(--radius-md);
            background-color: var(--primary-light);
            text-align: left;
        }
        
        .muscle-group {
            padding: 1.2rem;
            margin-bottom: 1rem;
            border-radius: var(--radius-sm);
            background-color: var(--primary-medium);
            position: relative;
            cursor: pointer;
            transition: background-color var(--transition-speed);
        }
        
        .muscle-group h4 {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--accent);
            text-shadow: 0 1px 2px var(--black-transparent-light);
        }
        
        .muscle-group:hover {
            background-color: var(--primary-light);
        }
        
        .muscle-group.active {
            background-color: var(--accent-dark);
        }
        
        .muscle-group.active h4 {
            color: white;
            text-shadow: 0 1px 2px var(--black-transparent-medium);
        }
        
        .muscle-instruction {
            display: none;
            padding: 1.2rem;
            margin-top: 0.7rem;
            border-radius: var(--radius-sm);
            background-color: var(--accent-transparent-light);
            border-left: 4px solid var(--accent);
            font-size: 1.1rem;
            line-height: 1.6;
            color: var(--text-light);
            font-weight: 500;
        }
        
        .muscle-instruction.visible {
            display: block;
        }
        
        .muscle-instruction p {
            margin-bottom: 0.7rem;
            text-shadow: 0 1px 1px var(--black-transparent-light);
        }
        
        .relaxation-progress {
            height: 10px;
            background-color: var(--primary-medium);
            border-radius: 5px;
            margin: 1rem 0;
            overflow: hidden;
        }
        
        .relaxation-progress-bar {
            height: 100%;
            background-color: var(--accent);
            width: 0;
            transition: width var(--transition-speed);
        }
        
        .visualization-scene {
            position: relative;
            height: 200px;
            border-radius: var(--radius-md);
            overflow: hidden;
            margin: 1.5rem 0;
            background-size: cover;
            background-position: center;
        }
        
        .visualization-scene-tabs .exercise-tab.active {
        background-color: var(--accent);
        color: var(--primary-dark);
        box-shadow: 0 0 8px var(--accent);
        transform: translateY(-2px);
        }
        
        .visualization-beach {
            background-image: linear-gradient(to bottom, #87CEEB, #1E90FF);
        }
        
        .visualization-forest {
            background-image: linear-gradient(to bottom, #228B22, #006400);
        }
        
        .visualization-sky {
            background-image: linear-gradient(to bottom, #4169E1, #191970);
        }
        
        .visualization-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            text-shadow: 1px 1px 3px var(--black-transparent-strong);
            padding: 1rem;
            background-color: var(--black-transparent-light);
        }
        
        .visualization-text {
            font-size: 1.2rem;
            max-width: 80%;
            text-align: center;
        }
        
        .exercise-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
        }
        
        .nav-btn {
            background-color: var(--primary-light);
            color: var(--text-light);
            border: none;
            border-radius: var(--radius-sm);
            padding: 0.5rem 1rem;
            cursor: pointer;
            transition: all var(--transition-speed);
        }
        
        .nav-btn:hover {
            background-color: var(--accent);
            color: var(--primary-dark);
        }
        
        .exercise-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }
        
        .exercise-tab {
            padding: 0.7rem 1.2rem;
            margin: 0.3rem;
            background-color: var(--primary-light);
            color: var(--text-light);
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all var(--transition-speed);
        }
        
        .exercise-tab.active {
            background-color: var(--accent);
            color: var(--primary-dark);
            box-shadow: 0 0 8px var(--accent);
            transform: translateY(-2px);
        }
        
        .exercise-content {
            display: none;
        }
        
        .exercise-content.active {
            display: block;
        }
        
        /* Stylowanie opisów ćwiczeń */
        .exercise-intro {
            font-size: 1.15rem;
            line-height: 1.7;
            color: var(--text-light);
            padding: 1rem;
            margin-bottom: 1.5rem;
            font-weight: 500;
            background-color: var(--accent-transparent-light);
            border-radius: var(--radius-sm);
            border-left: 4px solid var(--accent);
            text-shadow: 0 1px 2px var(--black-transparent-light);
        }
        
        @keyframes inhale {
            from { transform: scale(1); background-color: var(--accent-transparent-light); }
            to { transform: scale(1.5); background-color: var(--accent-transparent-medium); }
        }
        
        @keyframes hold {
            from { transform: scale(1.5); background-color: var(--accent-transparent-medium); }
            to { transform: scale(1.5); background-color: var(--accent-transparent-medium); }
        }
        
        @keyframes exhale {
            from { transform: scale(1.5); background-color: var(--accent-transparent-medium); }
            to { transform: scale(1); background-color: var(--accent-transparent-light); }
        }
        
        /* Animacja fali dla wizualizacji plaży */
        .wave {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 20px;
            background: var(--white-transparent-medium);
            border-radius: 50% 50% 0 0;
            animation: wave 8s infinite linear;
        }
        
        .wave:nth-child(2) {
            height: 15px;
            bottom: 10px;
            opacity: 0.6;
            animation-delay: 0.5s;
        }
        
        .wave:nth-child(3) {
            height: 10px;
            bottom: 15px;
            opacity: 0.4;
            animation-delay: 1s;
        }
        
        @keyframes wave {
            0% { transform: translateX(-50%); }
            100% { transform: translateX(50%); }
        }
        
        /* Sekcja porad dotyczących snu */
        .sleep-tips {
            padding: 1.5rem;
        }
        
        .tip-item {
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--primary-light);
        }
        
        .tip-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .tip-item p {
            color: var(--text-light);
            font-size: 1rem;
            line-height: 1.6;
        }
        
        .tip-item h4 {
            color: var(--accent);
            font-size: 1.2rem;
            margin-bottom: 0.8rem;
            font-weight: 600;
        }
        
        .tip-icon {
            color: var(--accent);
            margin-right: 0.5rem;
        }
        
        /* Przełącznik trybu jasny/ciemny */
        .theme-toggle {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            color: var(--accent);
            font-size: 1.5rem;
            cursor: pointer;
            z-index: 10;
            transition: transform var(--transition-speed);
        }
        
        .theme-toggle:hover {
            transform: rotate(30deg);
        }
        
        /* Stopka */
        footer {
            text-align: center;
            padding: 1.5rem 0;
            margin-top: 1rem;
            color: var(--text-light);
            opacity: 0.7;
        }
        
        /* Animacja księżyca */
        .moon {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 50px;
            height: 50px;
            background-color: var(--white-transparent-strong);
            border-radius: 50%;
            box-shadow: 0 0 20px var(--white-transparent-strong);
            z-index: 0;
            transition: background-color var(--transition-speed), box-shadow var(--transition-speed);
        }
        
        .light-mode .moon {
            background-color: #fbbf24;
            box-shadow: 0 0 30px rgba(251, 191, 36, 0.7);
        }
        
        /* Toast powiadomienia */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        .custom-toast {
            background-color: var(--primary-medium);
            color: var(--text-light);
            border-left: 4px solid var(--accent);
            box-shadow: var(--shadow-md);
        }
        
        /* Style dla różnych typów powiadomień */
        .error-toast {
            border-left: 4px solid var(--bs-danger) !important;
        }
        .warning-toast {
            border-left: 4px solid var(--bs-warning) !important;
        }
        .success-toast {
            border-left: 4px solid var(--bs-success) !important;
        }
        .info-toast {
            border-left: 4px solid var(--accent) !important;
        }
        
        .offline-mode .network-dependent {
            opacity: 0.6;
            pointer-events: none;
        }
        
        /* Stylowanie dla bajek na dobranoc */
        .bedtime-stories {
            margin-top: 1.5rem;
        }
        
        .story-accordion {
            margin-bottom: 1.5rem;
        }
        
        .story-header {
            padding: 1rem;
            background-color: var(--primary-light);
            border-radius: var(--radius-sm);
            margin-bottom: 0.5rem;
            cursor: pointer;
            position: relative;
            transition: background-color var(--transition-speed);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .story-header:hover {
            background-color: var(--accent-transparent-light);
        }
        
        .story-header.active {
            background-color: var(--accent-dark);
        }
        
        .story-header h4 {
            color: var(--text-light);
            margin: 0;
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .story-header.active h4 {
            color: white;
        }
        
        .story-toggle-icon {
            transition: transform var(--transition-speed);
        }
        
        .story-header.active .story-toggle-icon {
            transform: rotate(180deg);
        }
        
        .story-content {
            display: none;
            padding: 1rem;
            background-color: var(--primary-medium);
            border-radius: var(--radius-sm);
            margin-bottom: 1rem;
            border-left: 4px solid var(--accent);
            line-height: 1.6;
        }
        
        .story-content.visible {
            display: block;
        }
        
        .story-content p {
            margin-bottom: 1rem;
            text-shadow: 0 1px 1px var(--black-transparent-light);
            color: var(--text-light); /* Jawne określenie koloru dla zapewnienia widoczności */
        }
        
        /* Nowe style dla terminarza snu */
        .sleep-schedule-card {
            background-color: var(--primary-light);
            border-radius: var(--radius-md);
        }
        
        .sleep-calculation-result {
            background-color: var(--accent-transparent-light);
            border-radius: var(--radius-md);
        }
        
        /* Style dla śledzenia jakości snu */
        .sleep-rating-btn {
            background: none;
            border: none;
            padding: 0.5rem;
            border-radius: var(--radius-sm);
            transition: transform var(--transition-speed);
        }
        
        .sleep-rating-btn:hover {
            transform: scale(1.1);
        }
        
        .sleep-rating-btn.active {
            background-color: var(--accent-transparent-light);
        }
        
        /* Wsparcie dla prefers-reduced-motion */
        @media (prefers-reduced-motion: reduce) {
            .star, .cloud, .wave, .breathing-circle {
                animation: none !important;
                transition: none !important;
            }
            
            .breathing-circle.inhale, 
            .breathing-circle.exhale,
            .breathing-circle.hold,
            .breathing-circle.box-inhale,
            .breathing-circle.box-hold1,
            .breathing-circle.box-exhale,
            .breathing-circle.box-hold2 {
                transform: none !important;
                background-color: var(--accent-transparent-medium) !important;
            }
        }
        
        /* Responsywność */
        @media (max-width: 768px) {
            h1 {
                font-size: 2.2rem;
            }
            
            h2 {
                font-size: 1.5rem;
            }
            
            .sound-btn {
                padding: 0.6rem 1rem;
                margin: 0.3rem;
                font-size: 0.9rem;
            }
            
            .timer-display {
                font-size: 1.8rem;
            }
            
            .moon {
                width: 40px;
                height: 40px;
                top: 15px;
                left: 15px;
            }
            
            .breathing-circle {
                width: 120px;
                height: 120px;
            }
        }
    </style>
</head>
<body>
    <!-- Tło z gwiazdami i chmurami -->
    <div class="stars" id="stars"></div>
    <div class="moon"></div>
    
    <!-- Toast powiadomienia -->
    <div class="toast-container">
        <div class="toast custom-toast" role="alert" aria-live="assertive" aria-atomic="true" id="app-toast">
            <div class="toast-header">
                <strong class="me-auto" id="toast-title">Powiadomienie</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body" id="toast-message">
                Wiadomość
            </div>
        </div>
    </div>
    
    <div class="container">
        <!-- Przełącznik trybu jasny/ciemny -->
        <button class="theme-toggle" id="theme-toggle" title="Zmień motyw">
            <i class="fas fa-moon" id="theme-icon" aria-hidden="true"></i>
        </button>
        
        <!-- Nagłówek -->
        <header>
            <h1>Śpij Słoneczko</h1>
            <p class="lead">Relaksująca aplikacja stworzona przez dziubaska dla Renatki</p>
        </header>
        
        <!-- Główna zawartość -->
        <main>
            <!-- Odtwarzacz dźwięków i timer -->
            <div class="card sound-player">
                <div class="card-body">
                    <h2><i class="fas fa-music" aria-hidden="true"></i> Relaksujące dźwięki</h2>
                    
                    <!-- Przyciski dźwięków -->
                    <div class="d-flex flex-wrap justify-content-center mb-4">
                        <button class="sound-btn" data-sound="ocean" aria-pressed="false" aria-label="Odtwórz szum morza">
                            <i class="fas fa-water" aria-hidden="true"></i> Szum morza
                        </button>
                        <button class="sound-btn" data-sound="rain" aria-pressed="false" aria-label="Odtwórz deszcz">
                            <i class="fas fa-cloud-rain" aria-hidden="true"></i> Deszcz
                        </button>
                        <button class="sound-btn" data-sound="forest" aria-pressed="false" aria-label="Odtwórz las">
                            <i class="fas fa-tree" aria-hidden="true"></i> Las
                        </button>
                        <button class="sound-btn" data-sound="night" aria-pressed="false" aria-label="Odtwórz noc">
                            <i class="fas fa-moon" aria-hidden="true"></i> Noc
                        </button>
                        <button class="sound-btn" data-sound="whitenoise" aria-pressed="false" aria-label="Odtwórz biały szum">
                            <i class="fas fa-wave-square" aria-hidden="true"></i> Biały szum
                        </button>
                        <button class="sound-btn" data-sound="dziubasek" aria-pressed="false" aria-label="Odtwórz dziubasek">
                            <i class="fas fa-heart" aria-hidden="true"></i> Dziubasek
                        </button>
                        <button class="sound-btn" data-sound="dziubasek-vol2" aria-pressed="false" aria-label="Odtwórz dziubasek vol2">
                            <i class="fas fa-heartbeat" aria-hidden="true"></i> Dziubasek Vol.2
                        </button>
                    </div>
                    
                    <!-- Wizualizacja aktywnych dźwięków -->
                    <div class="active-sounds my-3" id="active-sounds-container">
                        <!-- Aktywne dźwięki będą dodawane tutaj dynamicznie -->
                    </div>
                    
                    <div class="controls">
                        <!-- Kontrola głośności -->
                        <div class="slider-container">
                            <label for="volume" class="form-label" id="volume-label">
                                <i class="fas fa-volume-up" aria-hidden="true"></i> Głośność
                            </label>
                            <input type="range" class="form-range" id="volume" min="0" max="1" step="0.01" value="0.5"
                                  aria-labelledby="volume-label">
                        </div>
                        
                        <!-- Timer -->
                        <div class="timer-container">
                            <h3><i class="fas fa-clock" aria-hidden="true"></i> Timer snu</h3>
                            <div class="timer-display" id="timer-display" aria-live="polite">00:00:00</div>
                            <div class="d-flex flex-wrap justify-content-center">
                                <button class="sound-btn timer-btn" data-time="5" aria-label="Ustaw timer na 5 minut">5 min</button>
                                <button class="sound-btn timer-btn" data-time="15" aria-label="Ustaw timer na 15 minut">15 min</button>
                                <button class="sound-btn timer-btn" data-time="30" aria-label="Ustaw timer na 30 minut">30 min</button>
                                <button class="sound-btn timer-btn" data-time="60" aria-label="Ustaw timer na 1 godzinę">1 godz</button>
                                <button class="sound-btn timer-btn" data-time="0" aria-label="Wyłącz timer">
                                    <i class="fas fa-stop" aria-hidden="true"></i> Wyłącz
                                </button>
                            </div>
                            
                            <!-- Niestandardowy timer -->
                            <div class="custom-timer-container mt-3">
                                <input type="number" min="1" max="480" class="custom-timer-input" id="custom-timer-input" 
                                       placeholder="min" aria-label="Liczba minut dla niestandardowego timera">
                                <button class="sound-btn" id="custom-timer-btn" aria-label="Ustaw niestandardowy timer">
                                    <i class="fas fa-check" aria-hidden="true"></i> Ustaw
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Rozbudowane ćwiczenia relaksacyjne -->
            <div class="card relaxation-exercises">
                <div class="card-body">
                    <h2><i class="fas fa-spa" aria-hidden="true"></i> Ćwiczenia relaksacyjne</h2>
                    
                    <div class="exercise-tabs" role="tablist">
                        <button class="exercise-tab active" data-tab="breathing" role="tab" aria-selected="true" aria-controls="breathing-content">
                            <i class="fas fa-lungs" aria-hidden="true"></i> Techniki oddechowe
                        </button>
                        <button class="exercise-tab" data-tab="muscle" role="tab" aria-selected="false" aria-controls="muscle-content">
                            <i class="fas fa-walking" aria-hidden="true"></i> Relaksacja mięśni
                        </button>
                        <button class="exercise-tab" data-tab="visualization" role="tab" aria-selected="false" aria-controls="visualization-content">
                            <i class="fas fa-cloud-sun" aria-hidden="true"></i> Wizualizacje
                        </button>
                        <button class="exercise-tab" data-tab="stories" role="tab" aria-selected="false" aria-controls="stories-content">
                            <i class="fas fa-book" aria-hidden="true"></i> Bajki na dobranoc
                        </button>
                    </div>
                    
                    <!-- Techniki oddechowe -->
                    <div class="exercise-content active" id="breathing-content" role="tabpanel" aria-labelledby="breathing-tab">
                        <div class="exercise-tabs">
                            <button class="exercise-tab active" data-breathing="478">
                                <i class="fas fa-wind" aria-hidden="true"></i> Technika 4-7-8
                            </button>
                            <button class="exercise-tab" data-breathing="box">
                                <i class="fas fa-square" aria-hidden="true"></i> Oddychanie kwadratowe 4-4-4-4
                            </button>
                            <button class="exercise-tab" data-breathing="diaphragm">
                                <i class="fas fa-circle" aria-hidden="true"></i> Oddychanie przeponowe
                            </button>
                        </div>
                        
                        <div class="breathing-exercise">
                            <p id="breathing-description">Technika 4-7-8 pomaga zrelaksować się i przygotować do snu</p>
                            <div class="breathing-circle" id="breathing-circle" tabindex="0" aria-label="Kliknij, aby rozpocząć ćwiczenie oddechowe">
                                <span id="breathing-text">Kliknij, aby rozpocząć</span>
                            </div>
                            <button class="sound-btn mt-4" id="start-breathing-btn">Rozpocznij ćwiczenie</button>
                        </div>
                    </div>
                    
                    <!-- Progresywna relaksacja mięśni -->
                    <div class="exercise-content" id="muscle-content" role="tabpanel" aria-labelledby="muscle-tab">
                        <p class="exercise-intro">Progresywna relaksacja mięśni polega na naprzemiennym napinaniu i rozluźnianiu poszczególnych grup mięśni. Wykonuj to ćwiczenie w wygodnej pozycji, najlepiej leżącej.</p>
                        
                        <div class="relaxation-progress" aria-label="Postęp ćwiczenia relaksacji mięśni">
                            <div class="relaxation-progress-bar" id="muscle-progress" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                        
                        <div class="muscle-relaxation-section">
                            <div class="muscle-group" data-group="hands" tabindex="0">
                                <h4><i class="fas fa-hand-paper" aria-hidden="true"></i> Dłonie i przedramiona</h4>
                                <div class="muscle-instruction">
                                    <p>1. Zaciśnij dłonie w pięści tak mocno, jak możesz</p>
                                    <p>2. Utrzymaj napięcie przez 5 sekund</p>
                                    <p>3. Powoli rozluźnij dłonie, czując jak napięcie odpływa</p>
                                    <p>4. Odpoczywaj przez 10 sekund, skupiając się na uczuciu rozluźnienia</p>
                                </div>
                            </div>
                            
                            <div class="muscle-group" data-group="arms" tabindex="0">
                                <h4><i class="fas fa-running" aria-hidden="true"></i> Ramiona i bicepsy</h4>
                                <div class="muscle-instruction">
                                    <p>1. Zegnij ręce w łokciach i napnij bicepsy</p>
                                    <p>2. Utrzymaj napięcie przez 5 sekund</p>
                                    <p>3. Powoli rozluźnij mięśnie, pozwalając ramionom opaść swobodnie</p>
                                    <p>4. Odpoczywaj przez 10 sekund, zauważając różnicę między napięciem a rozluźnieniem</p>
                                </div>
                            </div>
                            
                            <div class="muscle-group" data-group="shoulders" tabindex="0">
                                <h4><i class="fas fa-user" aria-hidden="true"></i> Barki i kark</h4>
                                <div class="muscle-instruction">
                                    <p>1. Podnieś barki w kierunku uszu (jak przy wzruszaniu ramionami)</p>
                                    <p>2. Utrzymaj napięcie przez 5 sekund</p>
                                    <p>3. Powoli opuść barki, pozwalając im całkowicie opaść</p>
                                    <p>4. Odpoczywaj przez 10 sekund, skupiając się na cieple rozchodzącym się po barkach</p>
                                </div>
                            </div>
                            
                            <div class="muscle-group" data-group="face" tabindex="0">
                                <h4><i class="fas fa-smile" aria-hidden="true"></i> Twarz i szczęka</h4>
                                <div class="muscle-instruction">
                                    <p>1. Zaciśnij szczękę, napnij usta i zmruż mocno oczy</p>
                                    <p>2. Utrzymaj napięcie przez 5 sekund</p>
                                    <p>3. Powoli rozluźnij wszystkie mięśnie twarzy</p>
                                    <p>4. Odpoczywaj przez 10 sekund, pozwalając twarzy być całkowicie rozluźnioną</p>
                                </div>
                            </div>
                            
                            <div class="muscle-group" data-group="chest" tabindex="0">
                                <h4><i class="fas fa-lungs" aria-hidden="true"></i> Klatka piersiowa i brzuch</h4>
                                <div class="muscle-instruction">
                                    <p>1. Weź głęboki wdech i napnij mięśnie brzucha</p>
                                    <p>2. Utrzymaj napięcie przez 5 sekund</p>
                                    <p>3. Powoli wydychaj powietrze, rozluźniając mięśnie</p>
                                    <p>4. Odpoczywaj przez 10 sekund, oddychając naturalnie</p>
                                </div>
                            </div>
                            
                            <div class="muscle-group" data-group="legs" tabindex="0">
                                <h4><i class="fas fa-shoe-prints" aria-hidden="true"></i> Nogi i stopy</h4>
                                <div class="muscle-instruction">
                                    <p>1. Napnij uda, łydki i stopy, podciągając palce stóp do góry</p>
                                    <p>2. Utrzymaj napięcie przez 5 sekund</p>
                                    <p>3. Powoli rozluźnij wszystkie mięśnie nóg</p>
                                    <p>4. Odpoczywaj przez 10 sekund, czując ciężar rozluźnionych nóg</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="text-center mt-4">
                            <button class="sound-btn" id="start-muscle-relaxation">Rozpocznij pełne ćwiczenie</button>
                        </div>
                    </div>
                    
                    <!-- Wizualizacje relaksacyjne -->
                    <div class="exercise-content" id="visualization-content" role="tabpanel" aria-labelledby="visualization-tab">
                        <p class="exercise-intro">Wybierz scenę do wizualizacji. Zamknij oczy, słuchaj opisu i spróbuj wyobrazić sobie to miejsce wszystkimi zmysłami.</p>
                        
                        <div class="exercise-tabs visualization-scene-tabs">
                            <button class="exercise-tab active" data-scene="beach">
                                <i class="fas fa-umbrella-beach" aria-hidden="true"></i> Plaża
                            </button>
                            <button class="exercise-tab" data-scene="forest">
                                <i class="fas fa-tree" aria-hidden="true"></i> Las
                            </button>
                            <button class="exercise-tab" data-scene="sky">
                                <i class="fas fa-cloud-moon" aria-hidden="true"></i> Rozgwieżdżone niebo
                            </button>
                        </div>
                        
                        <div class="visualization-scene visualization-beach" id="visualization-scene" aria-live="polite">
                            <div class="wave"></div>
                            <div class="wave"></div>
                            <div class="wave"></div>
                            <div class="visualization-overlay">
                                <p class="visualization-text" id="visualization-text">
                                    Wyobraź sobie, że leżysz na ciepłej, miękkiej plaży. Słońce delikatnie ogrzewa twoją skórę.
                                    Słyszysz rytmiczny szum fal, które łagodnie uderzają o brzeg...
                                </p>
                            </div>
                        </div>
                        
                        <div class="text-center mt-3">
                            <button class="sound-btn" id="start-visualization">Rozpocznij wizualizację</button>
                        </div>
                    </div>
                    
                    <!-- Bajki na dobranoc -->
                    <div class="exercise-content" id="stories-content" role="tabpanel" aria-labelledby="stories-tab">
                        <p class="exercise-intro">Wybierz jedną z bajek na dobranoc. Przeczytaj lub opowiedz ją, aby pomóc w wyciszeniu się przed snem.</p>
                        
                        <div class="bedtime-stories">
                            <div class="story-accordion">
                                <div class="story-header" data-story="star" tabindex="0" role="button" aria-expanded="false" aria-controls="star-story">
                                    <h4><i class="fas fa-star tip-icon" aria-hidden="true"></i> Renatka, Gwiazda o Złotym Blasku</h4>
                                    <i class="fas fa-chevron-down story-toggle-icon" aria-hidden="true"></i>
                                </div>
                                <div class="story-content" id="star-story">
                                    <p>Dawno temu, wysoko na niebie mieszkała mała gwiazda o imieniu Renatka. Renatka była wyjątkowa – w przeciwieństwie do innych gwiazd, które kochały noc, ona czasem bała się ciemności.</p>
                                    <p>"Jak możesz bać się ciemności?" - pytały inne gwiazdy. "Przecież jesteśmy gwiazdami! Świecimy właśnie w ciemności!"</p>
                                    <p>Ale Renatka nie zawsze potrafiła poradzić sobie ze swoim lękiem. Czasami jej blask był mniej intensywny, jakby przytłumiony przez niepewność.</p>
                                    <p>Pewnej nocy Renatka spotkała inną gwiazdę o imieniu Dziubasek, który zauważył jej zmartwienie. "Droga Renatko," powiedział łagodnie, "pozwól, że zdradzę ci pewien sekret. Ciemność nie jest niczym strasznym. To po prostu przestrzeń czekająca, aż wypełni ją nasze światło."</p>
                                    <p>Renatka zastanowiła się nad tymi słowami. "Ale co jeśli moje światło jest zbyt małe, aby wypełnić całą tę ciemność?" - zapytała.</p>
                                    <p>"Spójrz w dół, na Ziemię," odpowiedział Dziubasek. Renatka spojrzała i zobaczyła małą dziewczynkę, która nie mogła zasnąć, gdyż również bała się ciemności. Dziewczynka wyglądała przez okno, szukając światła na niebie.</p>
                                    <p>"Widzisz?" - powiedział Dziubasek. "Dla tej małej dziewczynki twoje światło może być najjaśniejszym punktem w nocy, przewodnikiem i pocieszeniem."</p>
                                    <p>Renatka pomyślała o dziewczynce – o kimś, kto potrzebował jej światła tak samo, jak ona potrzebowała odwagi. Nagle poczuła, jak jej strach zaczyna znikać, a jej światło staje się coraz jaśniejsze.</p>
                                    <p>Od tej nocy Renatka i Dziubasek świecili razem, jako dwie najjaśniejsze gwiazdy na niebie. A mała dziewczynka patrząc na nich, czuła się bezpieczna i mogła spokojnie zasnąć.</p>
                                    <p>I tak Renatka odkryła, że kiedy jest się z kimś, kto daje wsparcie i miłość, wszystkie lęki stają się mniejsze, a nasze wewnętrzne światło świeci najjaśniej.</p>
                                </div>
                            </div>
                            
                            <div class="story-accordion">
                                <div class="story-header" data-story="forest" tabindex="0" role="button" aria-expanded="false" aria-controls="forest-story">
                                    <h4><i class="fas fa-tree tip-icon" aria-hidden="true"></i> Dziubasek i Las Pięknych Snów</h4>
                                    <i class="fas fa-chevron-down story-toggle-icon" aria-hidden="true"></i>
                                </div>
                                <div class="story-content" id="forest-story">
                                    <p>W samym sercu Czarodziejskiego Lasu mieszkał mądry ptaszek o imieniu Dziubasek. Znany był ze swojej niezwykłej zdolności – umiał tworzyć piękne sny i dzielić się nimi z tymi, którzy mieli trudności ze spaniem.</p>
                                    <p>Co wieczór zwierzęta i leśne duszki przychodziły do jego przytulnego gniazdka, słuchając jego kojących opowieści, które pomagały im zasnąć. Dziubasek znał wiele historii – sny o lataniu dla wiewiórek, sny o pływaniu dla żabek, kolorowe sny dla motyli i przytulne sny dla jeżyków.</p>
                                    <p>Pewnego wieczoru do lasu przywędrowała zmęczona dziewczynka o imieniu Renatka. Miała za sobą długi dzień pełen przygód i potrzebowała dobrego odpoczynku, ale miała problem – jej umysł był pełen myśli i nie potrafiła zasnąć.</p>
                                    <p>"Próbowałam wszystkiego," wyszeptała do Dziubaska, "liczyłam owce, piłam ciepłe mleko z miodem, nawet słuchałam kołysanek, ale nic nie działa. Czy możesz mi pomóc?"</p>
                                    <p>Dziubasek spojrzał na Renatkę z czułością. "Twój problem, kochana Renatko, polega na tym, że twój umysł nadal pracuje, kiedy twoje ciało chce odpocząć. Potrzebujesz wyjątkowego snu, który pomoże ci się wyciszyć."</p>
                                    <p>Dziubasek zastanowił się przez chwilę, a potem zaczął nucić delikatną melodię. "To jest Melodia Spokoju. Jest wyjątkowa i stworzona specjalnie dla ciebie."</p>
                                    <p>Renatka słuchała z zamkniętymi oczami. Delikatny głos Dziubaska ukołysał ją do snu, a w jej śnie znalazła się na spokojnej polanie, gdzie słyszała tylko delikatny szept wiatru i śpiew ptaków. Powoli, jej oddech stał się głębszy, a myśli spokojniejsze.</p>
                                    <p>Rano Renatka obudziła się wypoczęta jak nigdy wcześniej. Czuła się lekka i pełna energii. Od tego dnia, zanim poszła spać, zawsze przypominała sobie melodię Dziubaska i wyobrażała sobie spokojną polanę ze swojego snu.</p>
                                    <p>"Melodia jest zawsze w twoim sercu," powiedział Dziubasek, gdy Renatka przyszła mu podziękować. "Nauczyłaś się, jak odnaleźć spokój w sobie. To jest prawdziwa magia dobrego snu."</p>
                                    <p>I tak Renatka odkryła, że najpiękniejsze sny rodzą się z miłości i troski, a najlepszym przewodnikiem do krainy spokojnego snu jest ktoś, kto troszczy się o nas całym sercem.</p>
                                </div>
                            </div>
                            
                            <div class="story-accordion">
                                <div class="story-header" data-story="moon" tabindex="0" role="button" aria-expanded="false" aria-controls="moon-story">
                                    <h4><i class="fas fa-moon tip-icon" aria-hidden="true"></i> Renatka, Księżyc i Nocne Marzenia</h4>
                                    <i class="fas fa-chevron-down story-toggle-icon" aria-hidden="true"></i>
                                </div>
                                <div class="story-content" id="moon-story">
                                    <p>Każdej nocy, gdy cały świat zasypiał, Renatka stawała się Księżycem Marzeń. Nie było to tylko zwykłe świecenie na niebie – jej najważniejszym zadaniem było zbieranie i spełnianie marzeń śpiących ludzi.</p>
                                    <p>Używając swoich srebrzystych promieni jak delikatnych rąk, ostrożnie podnosiła marzenia, które unosiły się nad głowami śpiących. Niektóre marzenia były lekkie jak piórka, inne ciężkie jak kamienie. Niektóre błyszczały kolorami tęczy, inne były ciche i skromne. Renatka kochała je wszystkie.</p>
                                    <p>Po zebraniu marzeń, Renatka-Księżyc zabierała je wysoko na niebo, gdzie jej przyjaciel Dziubasek, najjaśniejsza gwiazda, pomagał jej opiekować się marzeniami. Każdej nocy razem karmili je światłem i magią, sprawiając, że stawały się silniejsze.</p>
                                    <p>Pewnej nocy Renatka zauważyła wyjątkowe marzenie – należało do małego chłopca, który pragnął stworzyć coś pięknego dla kogoś, kogo kochał. Jego marzenie było wyjątkowo jasne i przyciągało uwagę. "To marzenie potrzebuje specjalnej opieki," pomyślała, powierzając je Dziubaskowi.</p>
                                    <p>"To przypomina mi nasze pierwsze spotkanie," powiedział Dziubasek z uśmiechem. "Pamiętasz? Też marzyłem, by stworzyć dla ciebie coś pięknego."</p>
                                    <p>Mijały noce i miesiące. Marzenie chłopca rosło i nabierało kształtów, aż pewnej nocy, gdy spał, stało się coś magicznego. W swoim śnie zobaczył dokładnie, co ma zrobić, by wyrazić swoją miłość – dokładnie tak, jak kiedyś Dziubasek zrozumiał, jak pokazać swoje uczucia Renatce.</p>
                                    <p>Gdy chłopiec się obudził, poczuł radość i spełnienie, choć nie pamiętał dokładnie swojego snu. Wiedział tylko, że jest szczęśliwy i że znalazł rozwiązanie, którego szukał.</p>
                                    <p>Tej samej nocy, gdy chłopiec spał, Renatka i Dziubasek zobaczyli coś niezwykłego – z jego serca unosiło się nowe marzenie, tym razem o pomaganiu innym w spełnianiu ich własnych marzeń.</p>
                                    <p>Renatka-Księżyc uśmiechnęła się do Dziubaska-Gwiazdy. Najpiękniejsza część ich pracy to nie tylko zbieranie marzeń, ale obserwowanie, jak jedno spełnione marzenie rodzi kolejne, jeszcze piękniejsze.</p>
                                    <p>I tak, każdej nocy, gdy patrzysz na niebo i widzisz Księżyc otoczony gwiazdami, pamiętaj – to Renatka i Dziubasek opiekują się twoimi najcenniejszymi marzeniami, aż nadejdzie czas, by stały się rzeczywistością.</p>
                                </div>
                            </div>
                            
                            <div class="story-accordion">
                                <div class="story-header" data-story="cloud" tabindex="0" role="button" aria-expanded="false" aria-controls="cloud-story">
                                    <h4><i class="fas fa-cloud tip-icon" aria-hidden="true"></i> Dziubasek, Chmurka Pełna Miłości</h4>
                                    <i class="fas fa-chevron-down story-toggle-icon" aria-hidden="true"></i>
                                </div>
                                <div class="story-content" id="cloud-story">
                                    <p>Wysoko na niebie, gdzie powietrze jest czyste i błękitne, żyła sobie mała chmurka o imieniu Dziubasek. Był najmniejszy spośród wszystkich obłoków na niebie i czasem czuł się niepewnie.</p>
                                    <p>"Jesteś zbyt mały, by tworzyć deszcz," mówiły większe chmury. "Nawet twój cień jest ledwo widoczny na ziemi."</p>
                                    <p>Dziubasek marzył o tym, by pewnego dnia stać się potężnym obłokiem, który mógłby przynosić życiodajny deszcz spragnionym polom i lasom. Ale bez względu na to, jak bardzo się starał, pozostawał maleńki i puszysty.</p>
                                    <p>Pewnego dnia silny wiatr porwał Dziubaska i poniósł daleko od innych chmur, nad piękny ale wysuszony ogród. Dziubasek zauważył tam samotny kwiat o imieniu Renatka, który walczył o przetrwanie w letnim upale.</p>
                                    <p>Gdy tak dryfował nad ogrodem, usłyszał cichy głos. "Proszę, chmurko, zostań ze mną choć na chwilę." To była Renatka, delikatny słonecznik spragniony odrobiny wilgoci.</p>
                                    <p>"Jestem tylko małym Dziubaskiem," odpowiedziała chmurka. "Nie mam w sobie deszczu, nie potrafię dać ci wody, której potrzebujesz."</p>
                                    <p>"Ale twój cień," powiedziała Renatka, "daje mi chwilę wytchnienia od palącego słońca. To więcej, niż miałam od wielu dni."</p>
                                    <p>Dziubasek nigdy nie pomyślał, że jego mały cień mógłby być dla kogoś tak ważny. Postanowił zostać nad Renatką tak długo, jak się da. Przez cały dzień zapewniał jej cień i ochłodę.</p>
                                    <p>Gdy wieczorem słońce zachodziło, Dziubasek poczuł coś niezwykłego - zaczął czuć się cięższy. To jego miłość i troska o Renatkę sprawiły, że w jego wnętrzu zaczęły formować się maleńkie kropelki wody.</p>
                                    <p>"Dziubasku, co się dzieje?" - zapytała zdziwiona Renatka, gdy pojedyncze krople zaczęły spadać na jej płatki.</p>
                                    <p>"To niemożliwe," wyszeptał zdumiony Dziubasek. "Jestem zbyt mały, by tworzyć deszcz..."</p>
                                    <p>Ale czasami to właśnie miłość i troska potrafią czynić niemożliwe możliwym. Dziubasek nie stał się wielką, burzową chmurą - zamiast tego stał się dokładnie taką chmurką, jakiej Renatka potrzebowała.</p>
                                    <p>Z czasem Dziubasek nauczył się, że prawdziwa wielkość nie zawsze zależy od rozmiaru. Czasami najmniejsza kropla deszczu może mieć największe znaczenie dla kogoś, kto jej potrzebuje.</p>
                                    <p>Od tamtego dnia Dziubasek i Renatka byli nierozłączni. Codziennie rano Dziubasek przynosił swojej ukochanej słoneczniczce dokładnie tyle wody, ile potrzebowała, a ona w podzięce zawsze odwracała swój złoty kielich w jego stronę, nawet gdy było pochmurno.</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Przyciski do czytania bajek na głos -->
                        <div class="text-center mt-3 mb-4">
                            <button class="sound-btn" id="read-story-btn">
                                <i class="fas fa-volume-up" aria-hidden="true"></i> Czytaj na głos
                            </button>
                            <button class="sound-btn d-none" id="pause-story-btn">
                                <i class="fas fa-pause" aria-hidden="true"></i> Pauzuj
                            </button>
                            <button class="sound-btn d-none" id="resume-story-btn">
                                <i class="fas fa-play" aria-hidden="true"></i> Kontynuuj
                            </button>
                            <button class="sound-btn d-none" id="stop-story-btn">
                                <i class="fas fa-stop" aria-hidden="true"></i> Zatrzymaj
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Terminarz snu (nowa sekcja) -->
            <div class="card">
                <div class="card-body">
                    <h2><i class="fas fa-calendar-alt" aria-hidden="true"></i> Terminarz snu</h2>
                    
                    <p class="exercise-intro">
                        Zaplanuj swój czas snu, aby zachować regularny schemat zasypiania i budzenia się.
                        Regularny harmonogram snu pomaga synchronizować Twój wewnętrzny zegar biologiczny.
                    </p>
                    
                    <div class="row g-3 mb-4">
                        <div class="col-md-6">
                            <div class="sleep-schedule-card p-3">
                                <h4><i class="fas fa-moon" aria-hidden="true"></i> Czas snu</h4>
                                <div class="input-group mb-3">
                                    <input type="time" class="form-control" id="sleep-time" value="22:30"
                                          aria-label="Czas zasypiania">
                                    <button class="btn btn-outline-secondary" type="button" id="set-sleep-reminder"
                                           style="background-color: var(--accent); color: var(--primary-dark); border: none;">
                                        <i class="fas fa-bell" aria-hidden="true"></i> Ustaw przypomnienie
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="sleep-schedule-card p-3">
                                <h4><i class="fas fa-sun" aria-hidden="true"></i> Czas budzenia</h4>
                                <div class="input-group mb-3">
                                    <input type="time" class="form-control" id="wake-time" value="06:30"
                                          aria-label="Czas budzenia">
                                    <button class="btn btn-outline-secondary" type="button" id="calculate-sleep"
                                           style="background-color: var(--accent); color: var(--primary-dark); border: none;">
                                        <i class="fas fa-calculator" aria-hidden="true"></i> Oblicz
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="sleep-calculation-result p-3 text-center mb-3" style="display: none;">
                        <h4 id="sleep-duration-result" aria-live="polite">8 godzin snu</h4>
                        <p id="sleep-cycles-result">To odpowiada 5 pełnym cyklom snu (90 min każdy)</p>
                        <div class="progress mt-2 mb-2" style="height: 20px; background-color: var(--primary-medium);">
                            <div class="progress-bar" role="progressbar" id="sleep-quality-bar"
                                 style="width: 75%; background-color: var(--accent);" 
                                 aria-valuenow="75" aria-valuemin="0" aria-valuemax="100">Dobra jakość</div>
                        </div>
                        <p class="mt-2 small" id="sleep-recommendation">
                            Zalecana długość snu dla dorosłych to 7-9 godzin.
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- Porady dotyczące snu -->
            <div class="card sleep-tips">
                <div class="card-body">
                    <h2><i class="fas fa-bed" aria-hidden="true"></i> Porady dla lepszego snu</h2>
                    <div class="tip-item">
                        <h4><i class="fas fa-calendar-alt tip-icon" aria-hidden="true"></i> Regularne godziny snu</h4>
                        <p>Staraj się chodzić spać i budzić się o tej samej porze każdego dnia, nawet w weekendy. To pomaga w regulacji twojego wewnętrznego zegara biologicznego.</p>
                    </div>
                    <div class="tip-item">
                        <h4><i class="fas fa-mobile-alt tip-icon" aria-hidden="true"></i> Unikaj niebieskiego światła</h4>
                        <p>Ogranicz korzystanie z urządzeń elektronicznych (telefon, tablet, laptop) co najmniej godzinę przed snem. Niebieskie światło emitowane przez te urządzenia może zakłócać produkcję melatoniny.</p>
                    </div>
                    <div class="tip-item">
                        <h4><i class="fas fa-spa tip-icon" aria-hidden="true"></i> Stwórz rytuał przed snem</h4>
                        <p>Rozwijaj rytuały, które sygnalizują twojemu ciału, że czas się zrelaksować. Może to być czytanie książki, ciepła kąpiel, medytacja lub słuchanie kojącej muzyki.</p>
                    </div>
                    <div class="tip-item">
                        <h4><i class="fas fa-mug-hot tip-icon" aria-hidden="true"></i> Pij ziołowe herbaty przed snem</h4>
                        <p>Ciepłe ziołowe napary, takie jak melisa, rumianek, lawenda czy lipa, pomagają się zrelaksować i przygotować ciało do snu. Wypijaj filiżankę około godzinę przed planowanym czasem snu.</p>
                    </div>
                    <div class="tip-item">
                        <h4><i class="fas fa-temperature-low tip-icon" aria-hidden="true"></i> Komfortowa sypialnia</h4>
                        <p>Upewnij się, że twoja sypialnia jest ciemna, cicha i ma odpowiednią temperaturę (18-20°C). Wygodny materac i poduszki również są ważne dla jakości snu.</p>
                    </div>
                    <div class="tip-item">
                        <h4><i class="fas fa-headphones tip-icon" aria-hidden="true"></i> Personalizuj dźwięki do zasypiania</h4>
                        <p>Wybieraj dźwięki, które osobiście działają na Ciebie uspokajająco. Możesz nagrać swoje ulubione odgłosy natury podczas spaceru, szum morza z wakacji, czy nawet znajome dźwięki domowe, które kojarzą Ci się z bezpieczeństwem i spokojem.</p>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- Stopka -->
        <footer>
            <p>© 2025 Śpij Słoneczko | Stworzone z miłością przez dziubaska dla Renatki <span aria-hidden="true">💝🌞💝</span></p>
            <p><a href="#" id="save-preferences" class="text-decoration-none" style="color: var(--accent)">Zapisz preferencje</a></p>
        </footer>
    </div>
    
    <!-- Szablony HTML -->
    <template id="sound-card-template">
        <div class="sound-card mb-2">
            <div class="d-flex align-items-center">
                <div class="sound-wave me-2">
                    <span></span>
                    <span></span>
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <span class="sound-name"></span>
            </div>
            <div>
                <input type="range" class="form-range individual-volume" min="0" max="1" step="0.01" value="0.5" style="width: 100px;"
                      aria-label="Głośność indywidualna">
                <button class="btn-close sound-close ms-2" aria-label="Close"></button>
            </div>
        </div>
    </template>
    
    <!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    
    <!-- Główny skrypt JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // ========== MODUŁY SERWISOWE ==========
            
            // Moduł do obsługi localStorage
            const StorageService = {
                // Prefiks dla kluczy
                PREFIX: 'spijSloneczko-',
                
                // Metoda zapisująca dane
                save: function(key, value) {
                    try {
                        const fullKey = this.PREFIX + key;
                        localStorage.setItem(fullKey, JSON.stringify(value));
                        return true;
                    } catch (error) {
                        console.error(`Błąd zapisu do localStorage (${key}):`, error);
                        return false;
                    }
                },
                
                // Metoda odczytująca dane
                load: function(key, defaultValue = null) {
                    try {
                        const fullKey = this.PREFIX + key;
                        const value = localStorage.getItem(fullKey);
                        return value ? JSON.parse(value) : defaultValue;
                    } catch (error) {
                        console.error(`Błąd odczytu z localStorage (${key}):`, error);
                        return defaultValue;
                    }
                }
            };
            
            // Moduł do obsługi powiadomień
            const NotificationService = {
                // Pokazuje powiadomienie
                showToast: function(title, message, type = 'info') {
                    // Pobierz element toasta
                    const toastEl = document.getElementById('app-toast');
                    if (!toastEl) {
                        console.error('Element toast nie został znaleziony!');
                        return;
                    }
                    
                    // Ustaw treść
                    document.getElementById('toast-title').textContent = title;
                    document.getElementById('toast-message').textContent = message;
                    
                    // Ustaw klasę w zależności od typu
                    toastEl.className = 'toast custom-toast';
                    
                    // Dodaj klasę koloru w zależności od typu
                    switch(type) {
                        case 'error':
                            toastEl.classList.add('error-toast');
                            break;
                        case 'warning':
                            toastEl.classList.add('warning-toast');
                            break;
                        case 'success':
                            toastEl.classList.add('success-toast');
                            break;
                        default:
                            toastEl.classList.add('info-toast');
                    }
                    
                    // Pokaż toast
                    const toast = new bootstrap.Toast(toastEl, {
                        autohide: true,
                        delay: type === 'error' ? 5000 : 3000
                    });
                    
                    toast.show();
                    
                    // Opcjonalnie: zaloguj błędy do konsoli
                    if (type === 'error') {
                        console.error(`[BŁĄD] ${title}: ${message}`);
                    }
                }
            };
            
            // Klasa do zarządzania dźwiękami przez Web Audio API
            // Klasa do zarządzania dźwiękami przez Web Audio API
class SoundManager {
    constructor() {
        // Tworzenie kontekstu audio
        this.audioContext = null;
        this.masterGain = null;
        this.initAudioContext();
        
        // Przechowywanie bufforów i źródeł
        this.buffers = new Map();
        this.sources = new Map();
        this.gains = new Map();
        
        // Załaduj dźwięki dopiero gdy są potrzebne
        this.loadedSounds = new Set();
        
        // Dodajemy flagę do śledzenia stanu inicjalizacji
        this.initialized = false;
    }
    
    initAudioContext() {
        try {
            // Utworzenie kontekstu audio
            this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
            this.masterGain = this.audioContext.createGain();
            this.masterGain.connect(this.audioContext.destination);
            this.masterGain.gain.value = 0.5; // Domyślna głośność
            console.log('Kontekst audio zainicjowany pomyślnie');
            return true;
        } catch (error) {
            console.error('Błąd inicjalizacji kontekstu audio:', error);
            NotificationService.showToast("Błąd", "Nie można zainicjować systemu audio w przeglądarce.", "error");
            return false;
        }
    }
    
    async ensureAudioContext() {
        // Sprawdź, czy kontekst audio istnieje, jeśli nie, utwórz go
        if (!this.audioContext) {
            if (!this.initAudioContext()) {
                throw new Error('Nie można utworzyć kontekstu audio');
            }
        }
        
        // Wznów kontekst audio, jeśli jest wstrzymany
        if (this.audioContext.state === 'suspended') {
            try {
                await this.audioContext.resume();
                console.log('Kontekst audio wznowiony');
            } catch (error) {
                console.error('Błąd wznawiania kontekstu audio:', error);
                throw new Error('Nie można wznowić kontekstu audio');
            }
        }
        
        // Zainicjalizujemy flagę, jeśli wszystko się powiodło
        this.initialized = true;
    }
    
    async loadSound(soundName, url) {
        // Najpierw upewnij się, że kontekst audio jest aktywny
        await this.ensureAudioContext();
        
        if (this.loadedSounds.has(soundName)) {
            console.log(`Dźwięk ${soundName} już załadowany, używam z pamięci podręcznej`);
            return this.buffers.get(soundName);
        }
        
        try {
            console.log(`Rozpoczynam ładowanie dźwięku: ${soundName} z ${url}`);
            
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            
            const arrayBuffer = await response.arrayBuffer();
            
            // Dodajemy dodatkowe debugowanie
            console.log(`Dźwięk ${soundName} pobrany, rozmiar: ${arrayBuffer.byteLength} bajtów`);
            
            if (arrayBuffer.byteLength === 0) {
                throw new Error(`Plik dźwiękowy ${soundName} jest pusty`);
            }
            
            try {
                const audioBuffer = await this.audioContext.decodeAudioData(arrayBuffer);
                console.log(`Dźwięk ${soundName} zdekodowany pomyślnie, długość: ${audioBuffer.duration} sekund`);
                
                this.buffers.set(soundName, audioBuffer);
                this.loadedSounds.add(soundName);
                
                return audioBuffer;
            } catch (decodeError) {
                console.error(`Błąd dekodowania dźwięku ${soundName}:`, decodeError);
                throw new Error(`Nie można zdekodować pliku audio: ${soundName}`);
            }
        } catch (error) {
            console.error(`Błąd ładowania dźwięku ${soundName}:`, error);
            NotificationService.showToast(
                "Błąd", 
                `Nie można załadować dźwięku: ${soundName}. Szczegóły: ${error.message}`, 
                "error"
            );
            throw error;
        }
    }
    
    async playSound(soundName, url) {
        // Upewnij się, że wszystkie zasoby są gotowe
        try {
            await this.ensureAudioContext();
            
            // Zatrzymaj, jeśli dźwięk już jest odtwarzany
            if (this.sources.has(soundName)) {
                console.log(`Zatrzymuję aktualnie grający dźwięk: ${soundName}`);
                this.stopSound(soundName);
                return null;
            }
            
            console.log(`Rozpoczynam odtwarzanie dźwięku: ${soundName}`);
            
            // Załaduj dźwięk, jeśli jeszcze nie został załadowany
            let buffer;
            if (!this.buffers.has(soundName)) {
                buffer = await this.loadSound(soundName, url);
            } else {
                buffer = this.buffers.get(soundName);
            }
            
            if (!buffer) {
                throw new Error(`Brak bufora dźwięku dla: ${soundName}`);
            }
            
            // Utwórz źródło i węzeł wzmocnienia
            const source = this.audioContext.createBufferSource();
            const gainNode = this.audioContext.createGain();
            
            source.buffer = buffer;
            source.loop = true;
            
            // Połącz węzły
            source.connect(gainNode);
            gainNode.connect(this.masterGain);
            
            // Ustaw poziom głośności
            gainNode.gain.value = this.masterGain.gain.value;
            
            // Zapisz referencje
            this.sources.set(soundName, source);
            this.gains.set(soundName, gainNode);
            
            // Rozpocznij odtwarzanie
            source.start(0);
            console.log(`Dźwięk ${soundName} rozpoczął odtwarzanie`);
            
            // Obsługa zakończenia (np. po usunięciu źródła)
            source.onended = () => {
                console.log(`Dźwięk ${soundName} zakończył odtwarzanie`);
                if (this.sources.has(soundName)) {
                    this.sources.delete(soundName);
                    this.gains.delete(soundName);
                }
            };
            
            return source;
        } catch (error) {
            console.error(`Błąd odtwarzania dźwięku ${soundName}:`, error);
            NotificationService.showToast(
                "Błąd", 
                `Problem z odtwarzaniem dźwięku: ${soundName}. Sprawdź, czy plik istnieje.`,
                "error"
            );
            return null;
        }
    }
    
    stopSound(soundName) {
        if (this.sources.has(soundName)) {
            console.log(`Zatrzymuję dźwięk: ${soundName}`);
            const source = this.sources.get(soundName);
            try {
                source.stop(0);
            } catch (e) {
                console.error(`Błąd zatrzymywania dźwięku ${soundName}:`, e);
            }
            this.sources.delete(soundName);
            this.gains.delete(soundName);
            return true;
        }
        return false;
    }
    
    stopAllSounds() {
        const soundNames = Array.from(this.sources.keys());
        console.log(`Zatrzymuję wszystkie dźwięki: ${soundNames.join(', ')}`);
        soundNames.forEach(name => this.stopSound(name));
    }
    
    setMasterVolume(value) {
        if (this.masterGain) {
            this.masterGain.gain.value = value;
        }
    }
    
    setSoundVolume(soundName, value) {
        if (this.gains.has(soundName)) {
            this.gains.get(soundName).gain.value = value;
        }
    }
    
    getSoundVolume(soundName) {
        return this.gains.has(soundName) ? this.gains.get(soundName).gain.value : this.masterGain?.gain.value || 0.5;
    }
    
    fadeOutSound(soundName, duration = 3000) {
        if (this.gains.has(soundName)) {
            const gainNode = this.gains.get(soundName);
            const currentTime = this.audioContext.currentTime;
            
            // Zapisz obecną wartość
            const currentValue = gainNode.gain.value;
            
            // Liniowe obniżenie głośności do 0 w czasie trwania
            gainNode.gain.setValueAtTime(currentValue, currentTime);
            gainNode.gain.linearRampToValueAtTime(0, currentTime + duration/1000);
            
            // Zatrzymaj dźwięk po zakończeniu fade out
            setTimeout(() => {
                this.stopSound(soundName);
            }, duration);
        }
    }
    
    fadeOutAllSounds(duration = 3000) {
        if (!this.audioContext || !this.masterGain) return;
        
        const currentTime = this.audioContext.currentTime;
        const currentValue = this.masterGain.gain.value;
        
        // Płynne wyciszenie głównego węzła głośności
        this.masterGain.gain.setValueAtTime(currentValue, currentTime);
        this.masterGain.gain.linearRampToValueAtTime(0, currentTime + duration/1000);
        
        // Zatrzymaj wszystkie dźwięki po wyciszeniu
        setTimeout(() => {
            this.stopAllSounds();
            // Przywróć głośność główną
            if (this.masterGain) {
                this.masterGain.gain.setValueAtTime(currentValue, this.audioContext.currentTime);
            }
        }, duration);
    }
    
    getActiveSoundNames() {
        return Array.from(this.sources.keys());
    }
}

// ===== INICJALIZACJA I WYWOŁANIA =====

// Funkcja do inicjalizacji odtwarzania dźwięków po interakcji użytkownika
function initializeAudioPlayback() {
    // Tutaj inicjalizujemy kontekst audio po interakcji użytkownika
    soundManager.ensureAudioContext()
        .then(() => {
            console.log('Kontekst audio zainicjowany po interakcji użytkownika');
            // Możemy teraz odtwarzać dźwięki
        })
        .catch(error => {
            console.error('Błąd inicjalizacji audio:', error);
            NotificationService.showToast("Błąd", "Nie można zainicjować systemu audio. Spróbuj odświeżyć stronę.", "error");
        });
}

// Dodaj to do obsługi zdarzeń po załadowaniu dokumentu
document.addEventListener('click', function audioInitializer() {
    initializeAudioPlayback();
    // Usuń nasłuchiwacz po pierwszym kliknięciu
    document.removeEventListener('click', audioInitializer);
});

// Sprawdzanie dostępności plików dźwiękowych
async function checkSoundFiles() {
    const soundErrors = [];
    
    for (const [name, path] of Object.entries(sounds)) {
        try {
            console.log(`Sprawdzam dostępność pliku: ${path}`);
            const response = await fetch(path, { method: 'HEAD' });
            
            if (!response.ok) {
                console.warn(`Plik dźwiękowy "${path}" nie został znaleziony (status: ${response.status}).`);
                soundErrors.push(`${name}: ${response.status}`);
                
                // Dezaktywuj przycisk
                const button = document.querySelector(`.sound-btn[data-sound="${name}"]`);
                if (button) {
                    button.classList.add('disabled');
                    button.setAttribute('aria-disabled', 'true');
                    button.setAttribute('title', `Dźwięk niedostępny: ${response.status}`);
                }
            } else {
                console.log(`Plik ${path} dostępny (status: ${response.status})`);
            }
        } catch (error) {
            console.error(`Błąd sprawdzania pliku "${path}":`, error);
            soundErrors.push(`${name}: ${error.message}`);
            
            // Dezaktywuj przycisk
            const button = document.querySelector(`.sound-btn[data-sound="${name}"]`);
            if (button) {
                button.classList.add('disabled');
                button.setAttribute('aria-disabled', 'true');
                button.setAttribute('title', `Błąd sprawdzania pliku: ${error.message}`);
            }
        }
    }
    
    // Jeśli jest dużo błędów, pokaż ogólne powiadomienie
    if (soundErrors.length > 0) {
        if (soundErrors.length === Object.keys(sounds).length) {
            NotificationService.showToast(
                "Błąd", 
                "Żadne pliki dźwiękowe nie są dostępne. Sprawdź ścieżki plików i uprawnienia.", 
                "error"
            );
        } else {
            NotificationService.showToast(
                "Ostrzeżenie", 
                `Niektóre pliki dźwiękowe (${soundErrors.length}) nie są dostępne.`, 
                "warning"
            );
        }
    }
}

// Funkcja odtwarzania dźwięku
function playSound(soundName) {
    // Jeśli dźwięk jest już odtwarzany, zatrzymaj go
    if (activeSounds.has(soundName)) {
        stopSound(soundName);
        return;
    }
    
    try {
        // Sprawdź, czy ścieżka do dźwięku istnieje
        if (!sounds[soundName]) {
            showToast("Błąd", `Brak pliku dźwiękowego dla: ${soundName}`, "error");
            return;
        }
        
        // Pokaż użytkownikowi, że próbujemy odtworzyć dźwięk
        const button = document.querySelector(`.sound-btn[data-sound="${soundName}"]`);
        if (button) {
            button.innerHTML = `<i class="fas fa-spinner fa-spin"></i> ${button.textContent.trim()}`;
        }
        
        // Odtwórz dźwięk przez Web Audio API
        soundManager.playSound(soundName, sounds[soundName])
            .then(source => {
                if (!source) {
                    // Przywróć oryginalny tekst przycisku
                    if (button) {
                        const originalIcon = soundIcons[soundName] || 'fa-music';
                        button.innerHTML = `<i class="fas ${originalIcon}"></i> ${soundNames[soundName] || soundName}`;
                    }
                    return;
                }
                
                // Utwórz interfejs audio dla kompatybilności z istniejącym kodem
                const audioInterface = {
                    soundName: soundName,
                    volume: volumeSlider.value,
                    // Właściwości i metody powiązane z interfejsem dźwięku
                    setVolume: function(value) {
                        this.volume = value;
                        soundManager.setSoundVolume(soundName, value);
                    },
                    getVolume: function() {
                        return soundManager.getSoundVolume(soundName);
                    }
                };
                
                // Dodaj dźwięk do aktywnych
                activeSounds.set(soundName, audioInterface);
                
                // Ustaw atrybut aria-pressed na przycisku
                if (button) {
                    // Przywróć oryginalny tekst i dodaj klasę active
                    const originalIcon = soundIcons[soundName] || 'fa-music';
                    button.innerHTML = `<i class="fas ${originalIcon}"></i> ${soundNames[soundName] || soundName}`;
                    button.classList.add('active');
                    button.setAttribute('aria-pressed', 'true');
                }
                
                // Dodaj kartę dźwięku do kontenera
                const soundCard = createSoundCard(soundName);
                activeContainer.appendChild(soundCard);
            })
            .catch(error => {
                console.error(`Błąd odtwarzania dźwięku ${soundName}:`, error);
                
                // Przywróć oryginalny tekst przycisku
                if (button) {
                    const originalIcon = soundIcons[soundName] || 'fa-music';
                    button.innerHTML = `<i class="fas ${originalIcon}"></i> ${soundNames[soundName] || soundName}`;
                }
                
                showToast("Błąd", `Wystąpił problem podczas odtwarzania dźwięku ${soundName}: ${error.message}`, "error");
            });
        
    } catch (error) {
        console.error("Nieoczekiwany błąd podczas odtwarzania dźwięku:", error);
        showToast("Błąd", `Wystąpił nieoczekiwany błąd podczas odtwarzania dźwięku: ${error.message}`, "error");
    }
}
            
            // Inicjalizacja menadżera dźwięków
            const soundManager = new SoundManager();
            
            // Inicjalizacja tooltipów Bootstrap
            const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });
            
            // Inicjalizacja toastów
            const toastEl = document.getElementById('app-toast');
            const toast = new bootstrap.Toast(toastEl, {
                autohide: true,
                delay: 3000
            });
            
            // Funkcja do pokazywania powiadomień
            function showToast(title, message, type = 'info') {
                NotificationService.showToast(title, message, type);
            }
            
            // Tworzenie gwiazd dla animowanego tła
            const starsContainer = document.getElementById('stars');
            const starsCount = 150; // Liczba gwiazd
            
            // Tworzenie gwiazd
            for (let i = 0; i < starsCount; i++) {
                const star = document.createElement('div');
                star.classList.add('star');
                
                // Losowa pozycja
                star.style.left = `${Math.random() * 100}%`;
                star.style.top = `${Math.random() * 100}%`;
                
                // Losowy rozmiar (1-3px)
                const size = Math.random() * 2 + 1;
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                
                // Losowa intensywność blasku
                star.style.setProperty('--intensity', 0.2 + Math.random() * 0.8);
                
                // Losowe opóźnienie i czas trwania animacji
                star.style.setProperty('--delay', `${Math.random() * 4}s`);
                star.style.setProperty('--duration', `${3 + Math.random() * 5}s`);
                
                starsContainer.appendChild(star);
            }
            
            // Dodanie kilku przesuwających się chmur
            for (let i = 0; i < 5; i++) {
                const cloud = document.createElement('div');
                cloud.classList.add('cloud');
                
                // Losowa pozycja
                cloud.style.left = `${Math.random() * 100}%`;
                cloud.style.top = `${Math.random() * 100}%`;
                
                // Losowy rozmiar
                const size = 100 + Math.random() * 200;
                cloud.style.width = `${size}px`;
                cloud.style.height = `${size / 2}px`;
                
                // Losowe opóźnienie i czas trwania animacji
                cloud.style.setProperty('--duration', `${50 + Math.random() * 30}s`);
                
                starsContainer.appendChild(cloud);
            }
            
            // ========== PRZEŁĄCZNIK TRYBU JASNY/CIEMNY ==========
            const themeToggle = document.getElementById('theme-toggle');
            const themeIcon = document.getElementById('theme-icon');
            
            // Sprawdź, czy użytkownik ma zapisane preferencje
            const savedTheme = StorageService.load('theme');
            if (savedTheme === 'light') {
                document.body.classList.add('light-mode');
                themeIcon.classList.remove('fa-moon');
                themeIcon.classList.add('fa-sun');
            }
            
            themeToggle.addEventListener('click', function() {
                document.body.classList.toggle('light-mode');
                
                if (document.body.classList.contains('light-mode')) {
                    themeIcon.classList.remove('fa-moon');
                    themeIcon.classList.add('fa-sun');
                    StorageService.save('theme', 'light');
                } else {
                    themeIcon.classList.remove('fa-sun');
                    themeIcon.classList.add('fa-moon');
                    StorageService.save('theme', 'dark');
                }
            });
            
            // ========== SYSTEM ODTWARZANIA DŹWIĘKÓW ==========
            
            // Pobranie elementów DOM
            const soundButtons = document.querySelectorAll('.sound-btn[data-sound]');
            const volumeSlider = document.getElementById('volume');
            const timerButtons = document.querySelectorAll('.timer-btn');
            const timerDisplay = document.getElementById('timer-display');
            const customTimerInput = document.getElementById('custom-timer-input');
            const customTimerBtn = document.getElementById('custom-timer-btn');
            const activeContainer = document.getElementById('active-sounds-container');
            const soundCardTemplate = document.getElementById('sound-card-template');
            
            // Zmienne dla timera
            let timerEndTime = null;
            let timerAnimationFrame = null;
            
            // Przechowywanie aktywnych dźwięków (jako mapa)
            const activeSounds = new Map();
            
            // ===== KONFIGURACJA DŹWIĘKÓW =====
            const sounds = {
                'ocean': 'sounds/ocean.wav',
                'rain': 'sounds/rain.mp3',
                'forest': 'sounds/forest.mp3',
                'night': 'sounds/night.mp3',
                'whitenoise': 'sounds/whitenoise.wav',
                'dziubasek': 'sounds/dziubasek.mp3',
                'dziubasek-vol2': 'sounds/dziubasek-vol2.mp3'
            };
            
            // Mapowanie nazw dźwięków na przyjazne nazwy polskie
            const soundNames = {
                'ocean': 'Szum morza',
                'rain': 'Deszcz',
                'forest': 'Las',
                'night': 'Noc',
                'whitenoise': 'Biały szum',
                'dziubasek': 'Dziubasek',
                'dziubasek-vol2': 'Dziubasek Vol.2'
            };
            
            // Mapowanie nazw dźwięków na ikony
            const soundIcons = {
                'ocean': 'fa-water',
                'rain': 'fa-cloud-rain',
                'forest': 'fa-tree',
                'night': 'fa-moon',
                'whitenoise': 'fa-wave-square',
                'dziubasek': 'fa-heart',
                'dziubasek-vol2': 'fa-heartbeat'
            };
            
            // Funkcja tworząca element karty dźwięku
            function createSoundCard(soundName) {
                const template = soundCardTemplate.content.cloneNode(true);
                const card = template.querySelector('.sound-card');
                card.dataset.sound = soundName;
                
                // Ustaw nazwę dźwięku
                const nameElement = card.querySelector('.sound-name');
                nameElement.textContent = soundNames[soundName] || soundName;
                
                // Dodaj ikonę
                const iconClass = soundIcons[soundName];
                if (iconClass) {
                    const icon = document.createElement('i');
                    icon.className = `fas ${iconClass} me-2`;
                    icon.setAttribute('aria-hidden', 'true');
                    nameElement.prepend(icon);
                }
                
                // Ustaw klasę aktywną dla wizualizacji dźwięku
                card.classList.add('active');
                const soundWave = card.querySelector('.sound-wave');
                soundWave.classList.add('active');
                
                // Obsługa indywidualnej głośności
                const volumeControl = card.querySelector('.individual-volume');
                volumeControl.value = soundManager.getSoundVolume(soundName);
                volumeControl.addEventListener('input', function() {
                    soundManager.setSoundVolume(soundName, parseFloat(this.value));
                });
                
                // Obsługa przycisku zamykania
                const closeBtn = card.querySelector('.sound-close');
                closeBtn.addEventListener('click', function() {
                    stopSound(soundName);
                });
                
                return card;
            }
            
            // Funkcja odtwarzania dźwięku
            function playSound(soundName) {
                // Jeśli dźwięk jest już odtwarzany, zatrzymaj go
                if (activeSounds.has(soundName)) {
                    stopSound(soundName);
                    return;
                }
                
                try {
                    // Sprawdź, czy ścieżka do dźwięku istnieje
                    if (!sounds[soundName]) {
                        showToast("Błąd", `Brak pliku dźwiękowego dla: ${soundName}`, "error");
                        return;
                    }
                    
                    // Odtwórz dźwięk przez Web Audio API
                    soundManager.playSound(soundName, sounds[soundName])
                        .then(source => {
                            if (!source) return; // Dźwięk został już zatrzymany przez inną operację
                            
                            // Utwórz interfejs audio dla kompatybilności z istniejącym kodem
                            const audioInterface = {
                                soundName: soundName,
                                volume: volumeSlider.value,
                                // Właściwości i metody powiązane z interfejsem dźwięku
                                setVolume: function(value) {
                                    this.volume = value;
                                    soundManager.setSoundVolume(soundName, value);
                                },
                                getVolume: function() {
                                    return soundManager.getSoundVolume(soundName);
                                }
                            };
                            
                            // Dodaj dźwięk do aktywnych
                            activeSounds.set(soundName, audioInterface);
                            
                            // Ustaw atrybut aria-pressed na przycisku
                            const button = document.querySelector(`.sound-btn[data-sound="${soundName}"]`);
                            if (button) {
                                button.classList.add('active');
                                button.setAttribute('aria-pressed', 'true');
                            }
                            
                            // Dodaj kartę dźwięku do kontenera
                            const soundCard = createSoundCard(soundName);
                            activeContainer.appendChild(soundCard);
                        })
                        .catch(error => {
                            console.error(`Błąd odtwarzania dźwięku ${soundName}:`, error);
                            showToast("Błąd", "Wystąpił problem podczas odtwarzania dźwięku", "error");
                        });
                    
                } catch (error) {
                    console.error("Nieoczekiwany błąd podczas odtwarzania dźwięku:", error);
                    showToast("Błąd", "Wystąpił nieoczekiwany błąd podczas odtwarzania dźwięku", "error");
                }
            }
            
            // Zatrzymanie pojedynczego dźwięku
            function stopSound(soundName) {
                if (activeSounds.has(soundName)) {
                    // Zatrzymaj dźwięk przez Web Audio API
                    soundManager.stopSound(soundName);
                    activeSounds.delete(soundName);
                    
                    // Usuń klasę active z przycisku
                    const button = document.querySelector(`.sound-btn[data-sound="${soundName}"]`);
                    if (button) {
                        button.classList.remove('active');
                        button.setAttribute('aria-pressed', 'false');
                    }
                    
                    // Usuń kartę dźwięku
                    const card = document.querySelector(`.sound-card[data-sound="${soundName}"]`);
                    if (card) card.remove();
                }
            }
            
            // Zatrzymanie wszystkich dźwięków
            function stopAllSounds() {
                soundManager.stopAllSounds();
                
                // Usuń wszystkie karty dźwięków
                activeContainer.innerHTML = '';
                
                // Usuń klasy active z przycisków
                soundButtons.forEach(button => {
                    button.classList.remove('active');
                    button.setAttribute('aria-pressed', 'false');
                });
                
                // Wyczyść mapę aktywnych dźwięków
                activeSounds.clear();
            }
            
            // Funkcja do płynnego wyciszania dźwięków
            function fadeOutAllSounds(duration = 3000) {
                soundManager.fadeOutAllSounds(duration);
                
                // Po zakończeniu wyciszania
                setTimeout(() => {
                    // Usuń wszystkie karty dźwięków
                    activeContainer.innerHTML = '';
                    
                    // Usuń klasy active z przycisków
                    soundButtons.forEach(button => {
                        button.classList.remove('active');
                        button.setAttribute('aria-pressed', 'false');
                    });
                    
                    // Wyczyść mapę aktywnych dźwięków
                    activeSounds.clear();
                }, duration);
            }
            
            // Funkcja aktualizująca wyświetlanie timera
            function updateTimerDisplay() {
                if (!timerEndTime) return false;
                
                const now = Date.now();
                const diff = timerEndTime - now;
                
                // Jeśli timer się zakończył
                if (diff <= 0) {
                    timerDisplay.textContent = '00:00:00';
                    timerAnimationFrame = null;
                    return false;
                }
                
                // Oblicz godziny, minuty, sekundy
                const hours = Math.floor(diff / 3600000);
                const minutes = Math.floor((diff % 3600000) / 60000);
                const seconds = Math.floor((diff % 60000) / 1000);
                
                // Formatuj wyświetlanie
                timerDisplay.textContent = 
                    `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                // Kontynuuj animację
                timerAnimationFrame = requestAnimationFrame(updateTimerDisplay);
                return true;
            }
            
            // Ustawienie timera
            function setTimer(minutes) {
                // Wyczyszczenie istniejącego timera
                if (timerAnimationFrame) {
                    cancelAnimationFrame(timerAnimationFrame);
                    timerAnimationFrame = null;
                }
                
                // Usunięcie klasy active ze wszystkich przycisków timera
                timerButtons.forEach(btn => btn.classList.remove('active'));
                
                // Jeśli minutes wynosi 0, wyczyść timer
                if (minutes === 0) {
                    timerDisplay.textContent = '00:00:00';
                    timerEndTime = null;
                    return;
                }
                
                // Aktywuj przycisk timera jeśli jest standardowym timerem
                const timerBtn = document.querySelector(`.timer-btn[data-time="${minutes}"]`);
                if (timerBtn) {
                    timerBtn.classList.add('active');
                }
                
                // Oblicz czas zakończenia
                timerEndTime = Date.now() + minutes * 60000;
                
                // Rozpocznij animację
                timerAnimationFrame = requestAnimationFrame(updateTimerDisplay);
                
                // Ustaw timeout do zakończenia timera
                setTimeout(function() {
                    if (timerEndTime && Date.now() >= timerEndTime) {
                        // Timer zakończony
                        if (timerAnimationFrame) {
                            cancelAnimationFrame(timerAnimationFrame);
                            timerAnimationFrame = null;
                        }
                        
                        // Płynnie wycisz wszystkie dźwięki
                        fadeOutAllSounds(5000);
                        
                        // Usuń aktywne klasy z przycisków timera
                        timerButtons.forEach(btn => btn.classList.remove('active'));
                        
                        // Powiadomienie
                        showToast('Timer zakończony', 'Dźwięki zostały płynnie wyciszone.', 'success');
                        
                        // Powiadomienie przeglądarki (opcjonalnie)
                        if ('Notification' in window && Notification.permission === 'granted') {
                            new Notification('Śpij Słoneczko', {
                                body: 'Timer zakończony. Dźwięki zostały wyciszone.',
                                icon: '/favicon.ico'
                            });
                        }
                    }
                }, minutes * 60000 + 100);
                
                // Pokaż powiadomienie o ustawieniu timera
                showToast('Timer ustawiony', `Timer ustawiony na ${minutes} minut.`, 'info');
            }
            
            // =========== ROZBUDOWANE ĆWICZENIA RELAKSACYJNE ===========
            // Zmienne dla ćwiczeń oddechowych
            const breathingCircle = document.getElementById('breathing-circle');
            const breathingText = document.getElementById('breathing-text');
            const breathingDescription = document.getElementById('breathing-description');
            const startBreathingBtn = document.getElementById('start-breathing-btn');
            let breathingInterval = null;
            let currentBreathingType = '478'; // domyślnie 4-7-8
            
            // Definicje ćwiczeń oddechowych
            const breathingTypes = {
                '478': {
                    description: 'Technika 4-7-8 pomaga zrelaksować się i przygotować do snu',
                    phases: [
                        { name: 'inhale', text: 'Wdech', duration: 4000 },
                        { name: 'hold', text: 'Zatrzymaj', duration: 7000 },
                        { name: 'exhale', text: 'Wydech', duration: 8000 }
                    ]
                },
                'box': {
                    description: 'Oddychanie kwadratowe 4-4-4-4 pomaga uspokoić umysł i znaleźć równowagę',
                    phases: [
                        { name: 'box-inhale', text: 'Wdech', duration: 4000 },
                        { name: 'box-hold1', text: 'Zatrzymaj', duration: 4000 },
                        { name: 'box-exhale', text: 'Wydech', duration: 4000 },
                        { name: 'box-hold2', text: 'Zatrzymaj', duration: 4000 }
                    ]
                },
                'diaphragm': {
                    description: 'Oddychanie przeponowe głęboko dotlenia organizm i pomaga się zrelaksować',
                    phases: [
                        { name: 'inhale', text: 'Głęboki wdech przeponą', duration: 5000 },
                        { name: 'exhale', text: 'Powolny, pełny wydech', duration: 7000 }
                    ]
                }
            };
            
            // Funkcja rozpoczynająca ćwiczenie oddechowe
            function startBreathingExercise() {
                // Zatrzymaj istniejący interwał jeśli istnieje
                if (breathingInterval) {
                    clearTimeout(breathingInterval);
                    breathingInterval = null;
                    breathingCircle.className = 'breathing-circle';
                    breathingText.textContent = 'Kliknij, aby rozpocząć';
                    startBreathingBtn.textContent = 'Rozpocznij ćwiczenie';
                    return;
                }
                
                const exerciseConfig = breathingTypes[currentBreathingType];
                let phase = 0;
                const phases = exerciseConfig.phases;
                
                function updateBreathingPhase() {
                    const currentPhase = phases[phase];
                    
                    // Usuń wszystkie klasy animacji
                    breathingCircle.className = 'breathing-circle';
                    
                    // Dodaj nową klasę animacji
                    setTimeout(() => {
                        breathingCircle.classList.add(currentPhase.name);
                        breathingText.textContent = currentPhase.text;
                    }, 10);
                    
                    // Przejdź do następnej fazy
                    phase = (phase + 1) % phases.length;
                    
                    // Ustaw timeout dla następnej fazy
                    breathingInterval = setTimeout(updateBreathingPhase, currentPhase.duration);
                }
                
                // Rozpocznij od pierwszej fazy
                updateBreathingPhase();
                
                // Zmień tekst przycisku
                startBreathingBtn.textContent = 'Zatrzymaj ćwiczenie';
            }
            
            // =========== PROGRESYWNA RELAKSACJA MIĘŚNI ===========
            const muscleGroups = document.querySelectorAll('.muscle-group');
            const startMuscleBtn = document.getElementById('start-muscle-relaxation');
            const muscleProgress = document.getElementById('muscle-progress');
            let muscleRelaxationInterval = null;
            let currentMuscleGroup = 0;
            
            // Funkcja prowadząca przez pełne ćwiczenie relaksacji mięśniowej
            function startMuscleRelaxation() {
                // Zatrzymanie istniejącego ćwiczenia
                if (muscleRelaxationInterval) {
                    clearInterval(muscleRelaxationInterval);
                    muscleRelaxationInterval = null;
                    startMuscleBtn.textContent = 'Rozpocznij pełne ćwiczenie';
                    muscleGroups.forEach(group => {
                        group.classList.remove('active');
                        group.querySelector('.muscle-instruction').classList.remove('visible');
                    });
                    muscleProgress.style.width = '0%';
                    return;
                }
                
                // Przygotuj wszystkie grupy
                muscleGroups.forEach(group => {
                    group.classList.remove('active');
                    group.querySelector('.muscle-instruction').classList.remove('visible');
                });
                
                currentMuscleGroup = 0;
                startMuscleBtn.textContent = 'Zatrzymaj ćwiczenie';
                
                // Funkcja przechodząca przez poszczególne grupy mięśniowe
                function goToNextMuscleGroup() {
                    // Zakończ ćwiczenie po przejściu przez wszystkie grupy
                    if (currentMuscleGroup >= muscleGroups.length) {
                        clearInterval(muscleRelaxationInterval);
                        muscleRelaxationInterval = null;
                        startMuscleBtn.textContent = 'Rozpocznij pełne ćwiczenie';
                        
                        // Pokaż powiadomienie o zakończeniu
                        showToast('Ćwiczenie zakończone', 'Gratulacje! Ukończyłeś/aś ćwiczenie relaksacji mięśni.', 'success');
                        
                        // Resetuj grupy mięśniowe
                        muscleGroups.forEach(group => {
                            group.classList.remove('active');
                            group.querySelector('.muscle-instruction').classList.remove('visible');
                        });
                        return;
                    }
                    
                    // Aktualizuj pasek postępu
                    const progressPercentage = (currentMuscleGroup / muscleGroups.length) * 100;
                    muscleProgress.style.width = `${progressPercentage}%`;
                    muscleProgress.setAttribute('aria-valuenow', progressPercentage);
                    
                    // Usuń aktywną klasę ze wszystkich grup
                    muscleGroups.forEach(group => {
                        group.classList.remove('active');
                        group.querySelector('.muscle-instruction').classList.remove('visible');
                    });
                    
                    // Aktywuj bieżącą grupę
                    const currentGroup = muscleGroups[currentMuscleGroup];
                    currentGroup.classList.add('active');
                    currentGroup.querySelector('.muscle-instruction').classList.add('visible');
                    
                    // Przewiń do aktywnej grupy
                    currentGroup.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    
                    // Przejdź do następnej grupy po 20 sekundach (5s napięcie + 15s relaks)
                    currentMuscleGroup++;
                    
                    // Pokaż powiadomienie
                    if (currentMuscleGroup <= muscleGroups.length) {
                        const groupName = currentGroup.querySelector('h4').textContent;
                        showToast('Grupa mięśniowa', groupName, 'info');
                    }
                }
                
                // Rozpocznij od pierwszej grupy
                goToNextMuscleGroup();
                
                // Ustaw interwał 20 sekund między grupami
                muscleRelaxationInterval = setInterval(goToNextMuscleGroup, 20000);
            }
            
            // =========== WIZUALIZACJE RELAKSACYJNE ===========
            const visualizationScene = document.getElementById('visualization-scene');
            let visualizationText = document.querySelector('#visualization-text');
            const startVisualizationBtn = document.getElementById('start-visualization');
            let visualizationInterval = null;
            let currentScene = 'beach'; // domyślna scena
            
            // Teksty dla różnych scen wizualizacji
            const visualizationScenes = {
                'beach': [
                    'Wyobraź sobie, że leżysz na ciepłej, miękkiej plaży. Czujesz delikatne ciepło słońca na swojej skórze.',
                    'Fale rytmicznie uderzają o brzeg, tworząc uspokajający szum. Wdychasz świeży, morski zapach.',
                    'Z każdym oddechem czujesz się coraz bardziej zrelaksowany/a. Twoje ciało powoli zanurza się w miękkim piasku.',
                    'Niebo nad tobą jest błękitne, z kilkoma puszystymi chmurami. Słyszysz odległe krzyki mew.',
                    'Twoje mięśnie się rozluźniają, a umysł uspokaja. Pozwól sobie na całkowite odprężenie w tym spokojnym miejscu.'
                ],
                'forest': [
                    'Znajdujesz się w pięknym, starym lesie. Otaczają cię wysokie drzewa, a ich liście szumią delikatnie na wietrze.',
                    'Promienie słońca przebijają się przez korony drzew, tworząc ciepłe plamy światła na ścieżce przed tobą.',
                    'Słyszysz śpiew ptaków i delikatny szelest liści. Powietrze jest świeże i pełne zapachu żywicy.',
                    'Z każdym krokiem zagłębiasz się dalej w las, czując spokój i harmonię tego miejsca.',
                    'Znajdujesz miękkie, mchowe miejsce, gdzie możesz usiąść lub położyć się. Czujesz, jak cały stres opuszcza twoje ciało.'
                ],
                'sky': [
                    'Leżysz na miękkim kocu i patrzysz w nocne niebo pełne gwiazd. Nad tobą rozciąga się nieskończony kosmos.',
                    'Gwiazdy migoczą delikatnie, a ty dostrzegasz znane konstelacje i jasny sierp księżyca.',
                    'Powietrze jest chłodne i rześkie. Z każdym oddechem czujesz, jak twój umysł się uspokaja.',
                    'Twoje ciało staje się lekkie, niemal jakbyś mógł/mogła unosić się wśród gwiazd. Grawitacja zdaje się słabnąć.',
                    'Problemy i zmartwienia maleją, stają się małe jak drobne punkty na niebie. Czujesz głęboki spokój i połączenie z wszechświatem.'
                ]
            };
            
            // Funkcja zmieniająca scenę wizualizacji
            function changeVisualizationScene(sceneName) {
                // Usuń wszystkie klasy scen i dodaj odpowiednią
                visualizationScene.className = 'visualization-scene';
                visualizationScene.classList.add(`visualization-${sceneName}`);
                
                // Dodaj lub usuń elementy specyficzne dla sceny
                visualizationScene.innerHTML = '';
                
                if (sceneName === 'beach') {
                    // Dodaj fale dla plaży
                    for (let i = 0; i < 3; i++) {
                        const wave = document.createElement('div');
                        wave.className = 'wave';
                        visualizationScene.appendChild(wave);
                    }
                }
                
                // Dodaj overlay z tekstem
                const overlay = document.createElement('div');
                overlay.className = 'visualization-overlay';
                overlay.innerHTML = `<p class="visualization-text" id="visualization-text">${visualizationScenes[sceneName][0]}</p>`;
                visualizationScene.appendChild(overlay);
                
                // Aktualizuj referencję do elementu tekstu
                visualizationText = overlay.querySelector('.visualization-text');
            }
            
            // Funkcja rozpoczynająca wizualizację
            function startVisualization() {
                // Zatrzymaj istniejącą wizualizację jeśli istnieje
                if (visualizationInterval) {
                    clearInterval(visualizationInterval);
                    visualizationInterval = null;
                    startVisualizationBtn.textContent = 'Rozpocznij wizualizację';
                    return;
                }
                
                startVisualizationBtn.textContent = 'Zatrzymaj wizualizację';
                
                let currentTextIndex = 0;
                const texts = visualizationScenes[currentScene];
                
                // Funkcja aktualizująca tekst wizualizacji
                function updateVisualizationText() {
                    // Płynna zmiana tekstu
                    visualizationText.style.opacity = '0';
                    
                    setTimeout(() => {
                        visualizationText.textContent = texts[currentTextIndex];
                        visualizationText.style.opacity = '1';
                        
                        // Przejdź do następnego tekstu
                        currentTextIndex = (currentTextIndex + 1) % texts.length;
                    }, 500);
                }
                
                // Rozpocznij od pierwszego tekstu
                updateVisualizationText();
                
                // Ustaw interwał do zmiany tekstów co 10 sekund
                visualizationInterval = setInterval(updateVisualizationText, 10000);
            }
            
            // =========== SYNTEZATOR MOWY DLA BAJEK ===========
            // Inicjalizacja syntezatora mowy
            const synth = window.speechSynthesis;
            let utterance = null;
            let isPaused = false;
            
            const readStoryBtn = document.getElementById('read-story-btn');
            const pauseStoryBtn = document.getElementById('pause-story-btn');
            const resumeStoryBtn = document.getElementById('resume-story-btn');
            const stopStoryBtn = document.getElementById('stop-story-btn');
            
            if (readStoryBtn) {
                // Funkcja rozpoczynająca czytanie aktywnej bajki
                function startReading() {
                    // Znajdź aktywną bajkę
                    const activeStory = document.querySelector('.story-content.visible');
                    if (!activeStory) {
                        showToast('Błąd', 'Najpierw wybierz bajkę do przeczytania', 'error');
                        return;
                    }
                    
                    // Pobierz tekst z paragrafów
                    const storyText = Array.from(activeStory.querySelectorAll('p'))
                        .map(p => p.textContent)
                        .join(' ');
                    
                    if (!storyText) {
                        showToast('Błąd', 'Nie znaleziono tekstu do przeczytania', 'error');
                        return;
                    }
                    
                    // Zatrzymaj aktualnie odtwarzaną mowę
                    if (synth.speaking) {
                        synth.cancel();
                    }
                    
                    // Utwórz nową wypowiedź
                    utterance = new SpeechSynthesisUtterance(storyText);
                    
                    // Znajdź polski głos, jeśli jest dostępny
                    const voices = synth.getVoices();
                    const polishVoice = voices.find(voice => voice.lang.includes('pl'));
                    if (polishVoice) {
                        utterance.voice = polishVoice;
                    }
                    
                    utterance.rate = 0.9; // Nieco wolniejsze tempo
                    utterance.pitch = 1;
                    
                    // Zdarzenia
                    utterance.onstart = () => {
                        readStoryBtn.classList.add('d-none');
                        pauseStoryBtn.classList.remove('d-none');
                        stopStoryBtn.classList.remove('d-none');
                    };
                    
                    utterance.onend = () => {
                        resetButtons();
                    };
                    
                    utterance.onerror = () => {
                        showToast('Błąd', 'Wystąpił problem podczas czytania', 'error');
                        resetButtons();
                    };
                    
                    // Rozpocznij czytanie
                    synth.speak(utterance);
                }
                
                function resetButtons() {
                    readStoryBtn.classList.remove('d-none');
                    pauseStoryBtn.classList.add('d-none');
                    resumeStoryBtn.classList.add('d-none');
                    stopStoryBtn.classList.add('d-none');
                    isPaused = false;
                }
                
                // Obsługa przycisków
                readStoryBtn.addEventListener('click', startReading);
                
                pauseStoryBtn.addEventListener('click', () => {
                    if (synth.speaking && !isPaused) {
                        synth.pause();
                        isPaused = true;
                        pauseStoryBtn.classList.add('d-none');
                        resumeStoryBtn.classList.remove('d-none');
                    }
                });
                
                resumeStoryBtn.addEventListener('click', () => {
                    if (synth.speaking && isPaused) {
                        synth.resume();
                        isPaused = false;
                        resumeStoryBtn.classList.add('d-none');
                        pauseStoryBtn.classList.remove('d-none');
                    }
                });
                
                stopStoryBtn.addEventListener('click', () => {
                    synth.cancel();
                    resetButtons();
                });
            }
            
            // =========== TERMINARZ SNU ===========
            const calculateSleepBtn = document.getElementById('calculate-sleep');
            if (calculateSleepBtn) {
                const sleepTimeInput = document.getElementById('sleep-time');
                const wakeTimeInput = document.getElementById('wake-time');
                const sleepDurationResult = document.getElementById('sleep-duration-result');
                const sleepCyclesResult = document.getElementById('sleep-cycles-result');
                const sleepQualityBar = document.getElementById('sleep-quality-bar');
                const sleepRecommendation = document.getElementById('sleep-recommendation');
                const sleepCalculationResult = document.querySelector('.sleep-calculation-result');
                
                calculateSleepBtn.addEventListener('click', function() {
                    const sleepTime = sleepTimeInput.value;
                    const wakeTime = wakeTimeInput.value;
                    
                    if (!sleepTime || !wakeTime) {
                        showToast('Błąd', 'Wybierz czas snu i budzenia', 'error');
                        return;
                    }
                    
                    // Konwersja czasów do minut od początku dnia
                    let sleepMinutes = timeToMinutes(sleepTime);
                    let wakeMinutes = timeToMinutes(wakeTime);
                    
                    // Obsługa przypadku, gdy budzenie jest następnego dnia
                    if (wakeMinutes < sleepMinutes) {
                        wakeMinutes += 24 * 60; // Dodaj jeden dzień w minutach
                    }
                    
                    // Oblicz różnicę w minutach
                    const durationMinutes = wakeMinutes - sleepMinutes;
                    
                    // Konwersja na godziny i minuty
                    const hours = Math.floor(durationMinutes / 60);
                    const minutes = durationMinutes % 60;
                    
                    // Oblicz liczbę cykli snu (jeden cykl to około 90 minut)
                    const cycles = Math.floor(durationMinutes / 90);
                    
                    // Określ jakość snu na podstawie długości
                    let quality = '';
                    let percentage = 0;
                    
                    if (hours < 6) {
                        quality = 'Niewystarczający';
                        percentage = Math.min(100, Math.max(0, (hours * 60 + minutes) / (7 * 60) * 100));
                        sleepRecommendation.textContent = 'Zbyt krótki sen może prowadzić do problemów z koncentracją i zdrowiem. Spróbuj wydłużyć czas snu.';
                    } else if (hours >= 6 && hours < 7) {
                        quality = 'Minimalny';
                        percentage = 60;
                        sleepRecommendation.textContent = 'To minimum dla funkcjonowania. Optymalny czas snu to 7-9 godzin.';
                    } else if (hours >= 7 && hours <= 9) {
                        quality = 'Optymalny';
                        percentage = 90;
                        sleepRecommendation.textContent = 'Świetnie! Śpisz optymalną ilość czasu dla dorosłego człowieka.';
                    } else {
                        quality = 'Dłuższy niż zalecany';
                        percentage = 75;
                        sleepRecommendation.textContent = 'Śpisz dłużej niż zalecane 7-9 godzin. Czasem może to prowadzić do uczucia zmęczenia.';
                    }
                    
                    // Aktualizuj UI
                    sleepDurationResult.textContent = `${hours} godzin${minutes > 0 ? ` i ${minutes} minut` : ''} snu`;
                    sleepCyclesResult.textContent = `To odpowiada ${cycles} pełnym cyklom snu (90 min każdy)${durationMinutes % 90 > 0 ? ` plus ${durationMinutes % 90} minut` : ''}`;
                    sleepQualityBar.style.width = `${percentage}%`;
                    sleepQualityBar.textContent = quality;
                    sleepQualityBar.setAttribute('aria-valuenow', percentage);
                    
                    // Ustaw kolor paska w zależności od jakości
                    if (percentage < 50) {
                        sleepQualityBar.style.backgroundColor = 'var(--bs-danger)';
                    } else if (percentage < 75) {
                        sleepQualityBar.style.backgroundColor = 'var(--bs-warning)';
                    } else {
                        sleepQualityBar.style.backgroundColor = 'var(--accent)';
                    }
                    
                    // Pokaż wyniki
                    sleepCalculationResult.style.display = 'block';
                });
                
                // Pomocnicza funkcja do konwersji czasu w formacie HH:MM na minuty
                function timeToMinutes(timeString) {
                    const [hours, minutes] = timeString.split(':').map(Number);
                    return hours * 60 + minutes;
                }
                
                // Obsługa przycisku ustawiania przypomnienia
                const setSleepReminderBtn = document.getElementById('set-sleep-reminder');
                if (setSleepReminderBtn) {
                    setSleepReminderBtn.addEventListener('click', function() {
                        const sleepTime = sleepTimeInput.value;
                        if (!sleepTime) {
                            showToast('Błąd', 'Wybierz czas snu', 'error');
                            return;
                        }
                        
                        // Sprawdź czy przeglądarka wspiera powiadomienia
                        if ('Notification' in window) {
                            if (Notification.permission === 'granted') {
                                scheduleReminder(sleepTime);
                            } else if (Notification.permission !== 'denied') {
                                Notification.requestPermission().then(permission => {
                                    if (permission === 'granted') {
                                        scheduleReminder(sleepTime);
                                    }
                                });
                            }
                        } else {
                            showToast('Informacja', 'Twoja przeglądarka nie wspiera powiadomień.', 'warning');
                        }
                    });
                    
                    function scheduleReminder(timeString) {
                        const now = new Date();
                        const reminderTime = new Date();
                        
                        // Parsuj czas z inputa
                        const [hours, minutes] = timeString.split(':').map(Number);
                        
                        // Ustaw czas przypomnienia (30 minut przed czasem snu)
                        reminderTime.setHours(hours, minutes - 30, 0, 0);
                        
                        // Jeśli czas już minął, przesuń na następny dzień
                        if (reminderTime < now) {
                            reminderTime.setDate(reminderTime.getDate() + 1);
                        }
                        
                        // Oblicz różnicę czasu w milisekundach
                        const delay = reminderTime - now;
                        
                        // Zapisz opcje przypomnienia w localStorage
                        StorageService.save('sleepReminder', {
                            time: timeString,
                            timestamp: reminderTime.getTime()
                        });
                        
                        // Pokaż powiadomienie o ustawionym przypomnieniu
                        const formattedTime = `${hours}:${minutes.toString().padStart(2, '0')}`;
                        const reminderTimeFormatted = `${reminderTime.getHours()}:${reminderTime.getMinutes().toString().padStart(2, '0')}`;
                        
                        showToast('Przypomnienie ustawione', `Otrzymasz powiadomienie o ${reminderTimeFormatted} przed planowanym czasem snu (${formattedTime}).`, 'success');
                        
                        // Symulacja przypomnienia dla celów demonstracyjnych
                        // W rzeczywistej aplikacji użylibyśmy Web Worker lub innego mechanizmu
                        // do triggowania powiadomień w odpowiednim czasie
                        setTimeout(() => {
                            new Notification('Śpij Słoneczko', {
                                body: `Pora przygotować się do snu! Powinieneś/aś iść spać o ${formattedTime}.`,
                                icon: '/favicon.ico'
                            });
                        }, delay);
                    }
                }
            }
            
            // =========== NASŁUCHIWACZE ZDARZEŃ ===========
            
            // Nasłuchiwacze zdarzeń dla przycisków dźwięku
            soundButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const soundName = this.dataset.sound;
                    playSound(soundName);
                });
                
                // Obsługa klawiatury
                button.addEventListener('keydown', function(e) {
                    // Aktywuj przycisk przy Enter lub Spacji
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        this.click();
                    }
                });
            });
            
            // Nasłuchiwacze zdarzeń dla suwaka głośności głównej
            volumeSlider.addEventListener('input', function() {
                const value = parseFloat(this.value);
                soundManager.setMasterVolume(value);
                
                // Aktualizuj wszystkie suwaki indywidualnej głośności
                document.querySelectorAll('.individual-volume').forEach(slider => {
                    slider.value = value;
                });
            });
            
            // Nasłuchiwacze zdarzeń dla przycisków timera
            timerButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const minutes = parseInt(this.dataset.time);
                    setTimer(minutes);
                });
            });
            
            // Nasłuchiwacz dla niestandardowego timera
            customTimerBtn.addEventListener('click', function() {
                const minutes = parseInt(customTimerInput.value);
                if (isNaN(minutes) || minutes <= 0 || minutes > 480) {
                    showToast('Błąd', 'Wprowadź wartość między 1 a 480 minut.', 'error');
                    return;
                }
                setTimer(minutes);
                
                // Wyczyść pole input
                customTimerInput.value = '';
            });
            
            // Obsługa Enter w polu niestandardowego timera
            customTimerInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    customTimerBtn.click();
                }
            });
            
            // Obsługa przycisków wyboru techniki oddechowej
            document.querySelectorAll('.exercise-tab[data-breathing]').forEach(tab => {
                tab.addEventListener('click', function() {
                    // Zatrzymaj aktualne ćwiczenie
                    if (breathingInterval) {
                        clearTimeout(breathingInterval);
                        breathingInterval = null;
                        breathingCircle.className = 'breathing-circle';
                        breathingText.textContent = 'Kliknij, aby rozpocząć';
                        startBreathingBtn.textContent = 'Rozpocznij ćwiczenie';
                    }
                    
                    // Ustaw nowy typ oddychania
                    currentBreathingType = this.dataset.breathing;
                    
                    // Aktualizuj opis
                    breathingDescription.textContent = breathingTypes[currentBreathingType].description;
                    
                    // Aktualizuj aktywny przycisk
                    document.querySelectorAll('.exercise-tab[data-breathing]').forEach(t => {
                        t.classList.remove('active');
                    });
                    this.classList.add('active');
                });
            });
            
            // Obsługa przycisku ćwiczenia oddechowego
            startBreathingBtn.addEventListener('click', startBreathingExercise);
            
            // Umożliwienie kliknięcia bezpośrednio na kółko
            breathingCircle.addEventListener('click', startBreathingExercise);
            breathingCircle.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    startBreathingExercise();
                }
            });
            
            // Obsługa kliknięć w grupy mięśniowe
            muscleGroups.forEach(group => {
                group.addEventListener('click', function() {
                    // Przełącz widoczność instrukcji
                    const instruction = this.querySelector('.muscle-instruction');
                    instruction.classList.toggle('visible');
                    
                    // Przełącz stan aktywny grupy
                    this.classList.toggle('active');
                });
                
                // Obsługa klawiatury
                group.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        this.click();
                    }
                });
            });
            
            // Obsługa przycisku rozpoczęcia ćwiczenia relaksacji mięśni
            startMuscleBtn.addEventListener('click', startMuscleRelaxation);
            
            // Obsługa przycisków wyboru sceny wizualizacji
            document.querySelectorAll('.visualization-scene-tabs .exercise-tab[data-scene]').forEach(tab => {
                tab.addEventListener('click', function() {
                    // Zatrzymaj aktualną wizualizację
                    if (visualizationInterval) {
                        clearInterval(visualizationInterval);
                        visualizationInterval = null;
                        startVisualizationBtn.textContent = 'Rozpocznij wizualizację';
                    }
                    
                    // Ustaw nową scenę
                    currentScene = this.dataset.scene;
                    changeVisualizationScene(currentScene);
                    
                    // Aktualizuj aktywny przycisk
                    document.querySelectorAll('.visualization-scene-tabs .exercise-tab').forEach(t => {
                        t.classList.remove('active');
                    });
                    this.classList.add('active');
                });
            });
            
            // Obsługa przycisku rozpoczęcia wizualizacji
            startVisualizationBtn.addEventListener('click', startVisualization);
            
            // Obsługa akordeonu z bajkami
            const storyHeaders = document.querySelectorAll('.story-header');
            
            storyHeaders.forEach(header => {
                header.addEventListener('click', function() {
                    const storyId = this.dataset.story;
                    const content = document.getElementById(`${storyId}-story`);
                    
                    // Przełącz aria-expanded
                    const isExpanded = this.getAttribute('aria-expanded') === 'true';
                    this.setAttribute('aria-expanded', !isExpanded);
                    
                    // Przełącz widoczność zawartości
                    content.classList.toggle('visible');
                    
                    // Przełącz stan aktywny nagłówka
                    this.classList.toggle('active');
                    
                    // Zamknij inne otwarte bajki
                    storyHeaders.forEach(otherHeader => {
                        if (otherHeader !== this && otherHeader.classList.contains('active')) {
                            otherHeader.classList.remove('active');
                            otherHeader.setAttribute('aria-expanded', 'false');
                            const otherId = otherHeader.dataset.story;
                            document.getElementById(`${otherId}-story`).classList.remove('visible');
                        }
                    });
                });
                
                // Obsługa klawiatury
                header.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        this.click();
                    }
                });
            });
            
            // Obsługa głównych zakładek ćwiczeń
            document.querySelectorAll('.exercise-tab[data-tab]').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.dataset.tab;
                    
                    // Aktualizuj ARIA
                    document.querySelectorAll('.exercise-tab[data-tab]').forEach(t => {
                        t.setAttribute('aria-selected', t === this);
                    });
                    
                    // Ukryj wszystkie treści ćwiczeń
                    document.querySelectorAll('.exercise-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    // Pokaż wybraną treść
                    document.getElementById(`${tabName}-content`).classList.add('active');
                    
                    // Aktualizuj aktywny przycisk
                    document.querySelectorAll('.exercise-tab[data-tab]').forEach(t => {
                        t.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // Zatrzymaj wszystkie aktywne ćwiczenia
                    if (breathingInterval) {
                        clearTimeout(breathingInterval);
                        breathingInterval = null;
                        breathingCircle.className = 'breathing-circle';
                        breathingText.textContent = 'Kliknij, aby rozpocząć';
                        startBreathingBtn.textContent = 'Rozpocznij ćwiczenie';
                    }
                    
                    if (muscleRelaxationInterval) {
                        clearInterval(muscleRelaxationInterval);
                        muscleRelaxationInterval = null;
                        startMuscleBtn.textContent = 'Rozpocznij pełne ćwiczenie';
                        muscleGroups.forEach(group => {
                            group.classList.remove('active');
                            group.querySelector('.muscle-instruction').classList.remove('visible');
                        });
                        muscleProgress.style.width = '0%';
                    }
                    
                    if (visualizationInterval) {
                        clearInterval(visualizationInterval);
                        visualizationInterval = null;
                        startVisualizationBtn.textContent = 'Rozpocznij wizualizację';
                    }
                });
            });
            
            // Obsługa zapisywania preferencji
            document.getElementById('save-preferences').addEventListener('click', function(e) {
                e.preventDefault();
                
                // Zapisz preferencje w localStorage
                const preferences = {
                    volume: volumeSlider.value,
                    theme: document.body.classList.contains('light-mode') ? 'light' : 'dark',
                    activeSounds: Array.from(soundManager.getActiveSoundNames())
                };
                
                const saved = StorageService.save('preferences', preferences);
                if (saved) {
                    showToast('Zapisano', 'Twoje preferencje zostały zapisane!', 'success');
                } else {
                    showToast('Błąd', 'Nie udało się zapisać preferencji.', 'error');
                }
            });
            
            // Obsługa klawisza Escape do zatrzymania ćwiczeń
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    if (breathingInterval) {
                        startBreathingBtn.click(); // Zatrzymaj ćwiczenie oddechowe
                    }
                    if (muscleRelaxationInterval) {
                        startMuscleBtn.click(); // Zatrzymaj relaksację mięśni
                    }
                    if (visualizationInterval) {
                        startVisualizationBtn.click(); // Zatrzymaj wizualizację
                    }
                    if (synth.speaking) {
                        synth.cancel(); // Zatrzymaj czytanie
                        if (stopStoryBtn) resetButtons();
                    }
                }
            });
            
            // Obsługa offline/online
            window.addEventListener('offline', function() {
                showToast(
                    "Brak połączenia", 
                    "Utracono połączenie z internetem. Niektóre funkcje mogą być ograniczone.",
                    "warning"
                );
                
                // Dodaj klasę do body, aby można było zastosować style dla trybu offline
                document.body.classList.add('offline-mode');
            });
            
            // Obsługa przywrócenia połączenia
            window.addEventListener('online', function() {
                showToast(
                    "Połączenie przywrócone", 
                    "Połączenie z internetem zostało przywrócone.",
                    "success"
                );
                
                // Usuń klasę offline
                document.body.classList.remove('offline-mode');
            });
            
            // Obsługa PWA
            // Rejestracja Service Worker dla funkcjonalności offline
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', () => {
                    navigator.serviceWorker.register('/service-worker.js')
                        .then(registration => {
                            console.log('ServiceWorker zarejestrowany pomyślnie:', registration.scope);
                        })
                        .catch(error => {
                            console.log('Rejestracja ServiceWorker nie powiodła się:', error);
                        });
                });
            }
            
            // Sprawdzenie dostępności plików dźwiękowych
            async function checkSoundFiles() {
                for (const [name, path] of Object.entries(sounds)) {
                    try {
                        const response = await fetch(path, { method: 'HEAD' });
                        if (!response.ok) {
                            console.warn(`Plik dźwiękowy "${path}" nie został znaleziony (status: ${response.status}).`);
                            
                            // Dezaktywuj przycisk
                            const button = document.querySelector(`.sound-btn[data-sound="${name}"]`);
                            if (button) {
                                button.classList.add('disabled');
                                button.setAttribute('aria-disabled', 'true');
                                button.setAttribute('title', 'Dźwięk niedostępny');
                            }
                        }
                    } catch (error) {
                        console.error(`Błąd sprawdzania pliku "${path}":`, error);
                    }
                }
            }
            
            // Ładowanie zapisanych preferencji
            function loadSavedPreferences() {
                const savedPrefs = StorageService.load('preferences');
                if (!savedPrefs) return;
                
                try {
                    // Ustaw głośność
                    if (savedPrefs.volume !== undefined) {
                        volumeSlider.value = savedPrefs.volume;
                        soundManager.setMasterVolume(savedPrefs.volume);
                    }
                    
                    // Ustaw motyw (już obsłużone wcześniej przy inicjalizacji)
                    
                    // Odtwórz zapisane dźwięki
                    if (savedPrefs.activeSounds && Array.isArray(savedPrefs.activeSounds)) {
                        // Ogranicz liczbę dźwięków do 5 aby nie przeciążać systemu
                        const maxSounds = 5;
                        const soundsToPlay = savedPrefs.activeSounds.slice(0, maxSounds);
                        
                        setTimeout(() => {
                            soundsToPlay.forEach(sound => {
                                playSound(sound);
                            });
                            
                            if (savedPrefs.activeSounds.length > maxSounds) {
                                showToast('Informacja', `Odtworzono tylko ${maxSounds} z ${savedPrefs.activeSounds.length} zapisanych dźwięków.`, 'info');
                            }
                        }, 1000);
                    }
                    
                } catch (error) {
                    console.error('Błąd podczas wczytywania preferencji:', error);
                    showToast('Błąd', 'Wystąpił problem podczas wczytywania preferencji.', 'error');
                }
            }
            
            // Zapytanie o pozwolenie na powiadomienia
            if ('Notification' in window && Notification.permission !== 'granted' && Notification.permission !== 'denied') {
                // Dodaj przycisk do prośby o pozwolenie
                const requestNotificationBtn = document.createElement('button');
                requestNotificationBtn.className = 'sound-btn';
                requestNotificationBtn.innerHTML = '<i class="fas fa-bell" aria-hidden="true"></i> Włącz powiadomienia';
                requestNotificationBtn.addEventListener('click', function() {
                    Notification.requestPermission().then(permission => {
                        if (permission === 'granted') {
                            showToast('Sukces', 'Powiadomienia zostały włączone!', 'success');
                            this.remove();
                        }
                    });
                });
                
                // Dodaj przycisk po timerze
                const timerContainer = document.querySelector('.timer-container');
                if (timerContainer) {
                    timerContainer.appendChild(requestNotificationBtn);
                }
            }
            
            // Inicjalizacja
            setTimeout(() => {
                checkSoundFiles();
                loadSavedPreferences();
            }, 1000);
        });
    </script>

<!-- Sample service-worker.js -->
<!-- Zapisz ten kod do pliku service-worker.js w głównym katalogu strony -->
<!-- 
self.addEventListener('install', (event) => {
  event.waitUntil(
    caches.open('spij-sloneczko-v1').then((cache) => {
      return cache.addAll([
        '/',
        '/index.html',
        '/sounds/ocean.wav',
        '/sounds/rain.mp3',
        '/sounds/forest.mp3',
        '/sounds/night.mp3',
        '/sounds/whitenoise.wav',
        '/sounds/dziubasek.mp3',
        '/sounds/dziubasek-vol2.mp3',
        '/favicon.ico',
        '/icons/icon-192x192.png',
        'https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css',
        'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css',
        'https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js'
      ]);
    })
  );
});

self.addEventListener('fetch', (event) => {
  event.respondWith(
    caches.match(event.request).then((response) => {
      return response || fetch(event.request).then((fetchResponse) => {
        // Cache dynamiczne zasoby
        if (event.request.url.includes('/sounds/') || 
            event.request.url.includes('/icons/')) {
          return caches.open('spij-sloneczko-dynamic').then((cache) => {
            cache.put(event.request, fetchResponse.clone());
            return fetchResponse;
          });
        }
        return fetchResponse;
      });
    }).catch(() => {
      // Jeśli wszystko zawiedzie, zwróć stronę offline
      if (event.request.mode === 'navigate') {
        return caches.match('/offline.html');
      }
      return new Response('Offline');
    })
  );
});
-->

<!-- Sample manifest.json -->
<!-- Zapisz ten kod do pliku manifest.json w głównym katalogu strony -->
<!--
{
  "name": "Śpij Słoneczko",
  "short_name": "Śpij Słoneczko",
  "description": "Relaksująca aplikacja do zasypiania",
  "start_url": "/index.html",
  "display": "standalone",
  "background_color": "#0a1128",
  "theme_color": "#0a1128",
  "icons": [
    {
      "src": "icons/icon-192x192.png",
      "sizes": "192x192",
      "type": "image/png"
    },
    {
      "src": "icons/icon-512x512.png",
      "sizes": "512x512",
      "type": "image/png"
    }
  ]
}
-->