<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Śpij Słoneczko | Relaksująca aplikacja do zasypiania</title>
    <!-- Favicon -->
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <!-- Bootstrap CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <!-- Dodatkowe ikony -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Preload plików audio dla szybszego ładowania -->
    <link rel="preload" href="sounds/ocean.wav" as="audio">
    <link rel="preload" href="sounds/rain.mp3" as="audio">
    <link rel="preload" href="sounds/forest.mp3" as="audio">
    <link rel="preload" href="sounds/night.mp3" as="audio">
    <link rel="preload" href="sounds/whitenoise.wav" as="audio">
    <link rel="preload" href="sounds/dziubasek.mp3" as="audio">
    <link rel="preload" href="sounds/dziubasek-vol2.mp3" as="audio">
    
    <style>
        /* Główna kolorystyka i ogólne stylowanie */
        :root {
            /* Podstawowe kolory */
            --primary-dark: #0a1128;
            --primary-medium: #1c2541;
            --primary-light: #3a506b;
            --accent: #5bc0be;
            --accent-dark: #3a8a88;
            --text-light: #e9ecef;
            
            /* Przezroczyste warianty kolorów */
            --accent-transparent-light: rgba(91, 192, 190, 0.2);
            --accent-transparent-medium: rgba(91, 192, 190, 0.5);
            --accent-transparent-strong: rgba(91, 192, 190, 0.7);
            --white-transparent-light: rgba(255, 255, 255, 0.05);
            --white-transparent-medium: rgba(255, 255, 255, 0.4);
            --white-transparent-strong: rgba(255, 255, 255, 0.7);
            --black-transparent-light: rgba(0, 0, 0, 0.1);
            --black-transparent-medium: rgba(0, 0, 0, 0.3);
            --black-transparent-strong: rgba(0, 0, 0, 0.5);
            
            /* System cieni */
            --shadow-sm: 0 2px 5px rgba(0, 0, 0, 0.2);
            --shadow-md: 0 4px 15px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 8px 25px rgba(0, 0, 0, 0.4);
            
            /* System zaokrągleń */
            --radius-sm: 8px;
            --radius-md: 10px;
            --radius-lg: 15px;
            
            /* Czas trwania przejść */
            --transition-speed: 0.3s ease;
        }
        
        body {
            background-color: var(--primary-dark);
            color: var(--text-light);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
            transition: background-color var(--transition-speed);
        }
        
        body.light-mode {
            --primary-dark: #e9f5f9;
            --primary-medium: #c4e0f3;
            --primary-light: #93c5fd;
            --accent: #3b82f6;
            --accent-dark: #2563eb;
            --text-light: #0f172a;
            --accent-transparent-light: rgba(59, 130, 246, 0.2);
            --accent-transparent-medium: rgba(59, 130, 246, 0.5);
            --accent-transparent-strong: rgba(59, 130, 246, 0.7);
            background-color: var(--primary-dark);
            color: var(--text-light);
        }
        
        /* Animowane tło z gwiazdami */
        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }
        
        .star {
            position: absolute;
            background-color: white;
            border-radius: 50%;
            opacity: 0;
            animation: twinkle var(--duration, 4s) infinite var(--delay, 0s);
        }
        
        @keyframes twinkle {
            0% { opacity: 0; }
            50% { opacity: var(--intensity, 1); }
            100% { opacity: 0; }
        }
        
        /* Półprzezroczyste chmury */
        .cloud {
            position: absolute;
            background-color: var(--white-transparent-light);
            border-radius: 50%;
            filter: blur(20px);
            animation: float var(--duration, 60s) infinite linear;
            opacity: 0.3;
        }
        
        @keyframes float {
            0% { transform: translateX(-5%); }
            50% { transform: translateX(5%); }
            100% { transform: translateX(-5%); }
        }
        
        /* Główne elementy stylowania */
        .container {
            padding: 2rem 1rem;
            position: relative;
            z-index: 1;
        }
        
        header {
            text-align: center;
            padding: 2rem 0 1rem;
            position: relative;
        }
        
        h1 {
            color: var(--accent);
            font-size: 2.8rem;
            margin-bottom: 0.5rem;
            text-shadow: 0 0 10px var(--accent-transparent-strong);
        }
        
        h2 {
            color: var(--accent);
            font-size: 1.8rem;
            margin: 1.5rem 0;
        }
        
        h3 {
            color: var(--accent);
            font-size: 1.5rem;
        }
        
        .card {
            background-color: var(--primary-medium);
            border: none;
            border-radius: var(--radius-lg);
            margin-bottom: 2rem;
            box-shadow: var(--shadow-md);
            transition: transform var(--transition-speed), box-shadow var(--transition-speed);
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }
        
        /* Stylowanie odtwarzacza dźwięku */
        .sound-player {
            padding: 1.5rem;
        }
        
        .sound-btn {
            background-color: var(--primary-light);
            color: var(--text-light);
            border: none;
            border-radius: var(--radius-md);
            padding: 0.8rem 1.2rem;
            margin: 0.5rem;
            transition: all var(--transition-speed);
            box-shadow: var(--shadow-sm);
        }
        
        .sound-btn:hover {
            background-color: var(--accent);
            color: var(--primary-dark);
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
        }
        
        .sound-btn.active {
            background-color: var(--accent);
            color: var(--primary-dark);
            box-shadow: 0 0 10px var(--accent);
        }
        
        .sound-card {
            background-color: var(--primary-light);
            border-radius: var(--radius-md);
            padding: 1rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            opacity: 0.7;
            transition: opacity var(--transition-speed);
        }
        
        .sound-card.active {
            opacity: 1;
            box-shadow: 0 0 10px var(--accent-transparent-medium);
        }
        
        .sound-wave {
            display: flex;
            align-items: flex-end;
            height: 30px;
            width: 50px;
            margin-right: 10px;
        }
        
        .sound-wave.active span {
            animation: soundWave 1s infinite;
        }
        
        .sound-wave span {
            display: inline-block;
            width: 4px;
            margin: 0 2px;
            background-color: var(--accent);
            height: 5px;
            border-radius: 2px;
        }
        
        @keyframes soundWave {
            0%, 100% { height: 5px; }
            50% { height: 20px; }
        }
        
        .sound-wave span:nth-child(1) { animation-delay: 0.1s; }
        .sound-wave span:nth-child(2) { animation-delay: 0.2s; }
        .sound-wave span:nth-child(3) { animation-delay: 0.05s; }
        .sound-wave span:nth-child(4) { animation-delay: 0.3s; }
        .sound-wave span:nth-child(5) { animation-delay: 0.15s; }
        
        .controls {
            margin-top: 2rem;
        }
        
        .slider-container {
            margin: 1.5rem 0;
        }
        
        .form-label {
            color: var(--accent);
            font-weight: 500;
            font-size: 1.1rem;
            margin-bottom: 0.8rem;
        }
        
        .form-range::-webkit-slider-thumb {
            background: var(--accent);
        }
        
        .form-range::-moz-range-thumb {
            background: var(--accent);
        }
        
        /* Stylowanie timera */
        .timer-container {
            text-align: center;
            margin: 1.5rem 0;
        }
        
        .timer-display {
            font-size: 2.2rem;
            font-weight: bold;
            margin: 1rem 0;
            color: var(--accent);
            text-shadow: 0 0 5px var(--accent-transparent-medium);
        }
        
        .custom-timer-container {
            margin-top: 1rem;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .custom-timer-input {
            width: 80px;
            background-color: var(--primary-medium);
            border: 2px solid var(--accent);
            border-radius: var(--radius-sm);
            color: var(--text-light);
            padding: 0.4rem;
            margin-right: 0.5rem;
            text-align: center;
        }
        
        /* Stylowanie dla ćwiczeń relaksacyjnych */
        .relaxation-exercise {
            text-align: center;
            padding: 1.5rem 0;
        }
        
        .breathing-exercise {
            text-align: center;
            padding: 1.5rem 0;
        }
        
        #breathing-description {
            color: var(--text-light);
            font-weight: 500;
            margin-bottom: 1.2rem;
        }
        
        .breathing-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            margin: 0 auto;
            background-color: var(--accent-transparent-light);
            border: 3px solid var(--accent);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: transform var(--transition-speed), background-color var(--transition-speed);
        }
        
        .breathing-circle.inhale {
            animation: inhale 4s forwards;
        }
        
        .breathing-circle.hold {
            animation: hold 7s forwards;
        }
        
        .breathing-circle.exhale {
            animation: exhale 8s forwards;
        }
        
        .breathing-circle.box-inhale {
            animation: inhale 4s forwards;
        }
        
        .breathing-circle.box-hold1 {
            animation: hold 4s forwards;
        }
        
        .breathing-circle.box-exhale {
            animation: exhale 4s forwards;
        }
        
        .breathing-circle.box-hold2 {
            animation: hold 4s forwards;
        }
        
        .muscle-relaxation-section {
            margin-top: 1.5rem;
            padding: 1rem;
            border-radius: var(--radius-md);
            background-color: var(--primary-light);
            text-align: left;
        }
        
        .muscle-group {
            padding: 1.2rem;
            margin-bottom: 1rem;
            border-radius: var(--radius-sm);
            background-color: var(--primary-medium);
            position: relative;
            cursor: pointer;
            transition: background-color var(--transition-speed);
        }
        
        .muscle-group h4 {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--accent);
            text-shadow: 0 1px 2px var(--black-transparent-light);
        }
        
        .muscle-group:hover {
            background-color: var(--primary-light);
        }
        
        .muscle-group.active {
            background-color: var(--accent-dark);
        }
        
        .muscle-group.active h4 {
            color: white;
            text-shadow: 0 1px 2px var(--black-transparent-medium);
        }
        
        .muscle-instruction {
            display: none;
            padding: 1.2rem;
            margin-top: 0.7rem;
            border-radius: var(--radius-sm);
            background-color: var(--accent-transparent-light);
            border-left: 4px solid var(--accent);
            font-size: 1.1rem;
            line-height: 1.6;
            color: var(--text-light);
            font-weight: 500;
        }
        
        .muscle-instruction.visible {
            display: block;
        }
        
        .muscle-instruction p {
            margin-bottom: 0.7rem;
            text-shadow: 0 1px 1px var(--black-transparent-light);
        }
        
        .relaxation-progress {
            height: 10px;
            background-color: var(--primary-medium);
            border-radius: 5px;
            margin: 1rem 0;
            overflow: hidden;
        }
        
        .relaxation-progress-bar {
            height: 100%;
            background-color: var(--accent);
            width: 0;
            transition: width var(--transition-speed);
        }
        
        .visualization-scene {
            position: relative;
            height: 200px;
            border-radius: var(--radius-md);
            overflow: hidden;
            margin: 1.5rem 0;
            background-size: cover;
            background-position: center;
        }
        
        .visualization-beach {
            background-image: linear-gradient(to bottom, #87CEEB, #1E90FF);
        }
        
        .visualization-forest {
            background-image: linear-gradient(to bottom, #228B22, #006400);
        }
        
        .visualization-sky {
            background-image: linear-gradient(to bottom, #4169E1, #191970);
        }
        
        .visualization-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            text-shadow: 1px 1px 3px var(--black-transparent-strong);
            padding: 1rem;
            background-color: var(--black-transparent-light);
        }
        
        .visualization-text {
            font-size: 1.2rem;
            max-width: 80%;
            text-align: center;
        }
        
        .exercise-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
        }
        
        .nav-btn {
            background-color: var(--primary-light);
            color: var(--text-light);
            border: none;
            border-radius: var(--radius-sm);
            padding: 0.5rem 1rem;
            cursor: pointer;
            transition: all var(--transition-speed);
        }
        
        .nav-btn:hover {
            background-color: var(--accent);
            color: var(--primary-dark);
        }
        
        .exercise-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }
        
        .exercise-tab {
            padding: 0.7rem 1.2rem;
            margin: 0.3rem;
            background-color: var(--primary-light);
            color: var(--text-light);
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all var(--transition-speed);
        }
        
        .exercise-tab.active {
            background-color: var(--accent);
            color: var(--primary-dark);
            box-shadow: 0 0 8px var(--accent);
            transform: translateY(-2px);
        }
        
        .exercise-content {
            display: none;
        }
        
        .exercise-content.active {
            display: block;
        }
        
        /* Stylowanie opisów ćwiczeń */
        .exercise-intro {
            font-size: 1.15rem;
            line-height: 1.7;
            color: var(--text-light);
            padding: 1rem;
            margin-bottom: 1.5rem;
            font-weight: 500;
            background-color: var(--accent-transparent-light);
            border-radius: var(--radius-sm);
            border-left: 4px solid var(--accent);
            text-shadow: 0 1px 2px var(--black-transparent-light);
        }
        
        @keyframes inhale {
            from { transform: scale(1); background-color: var(--accent-transparent-light); }
            to { transform: scale(1.5); background-color: var(--accent-transparent-medium); }
        }
        
        @keyframes hold {
            from { transform: scale(1.5); background-color: var(--accent-transparent-medium); }
            to { transform: scale(1.5); background-color: var(--accent-transparent-medium); }
        }
        
        @keyframes exhale {
            from { transform: scale(1.5); background-color: var(--accent-transparent-medium); }
            to { transform: scale(1); background-color: var(--accent-transparent-light); }
        }
        
        /* Animacja fali dla wizualizacji plaży */
        .wave {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 20px;
            background: var(--white-transparent-medium);
            border-radius: 50% 50% 0 0;
            animation: wave 8s infinite linear;
        }
        
        .wave:nth-child(2) {
            height: 15px;
            bottom: 10px;
            opacity: 0.6;
            animation-delay: 0.5s;
        }
        
        .wave:nth-child(3) {
            height: 10px;
            bottom: 15px;
            opacity: 0.4;
            animation-delay: 1s;
        }
        
        @keyframes wave {
            0% { transform: translateX(-50%); }
            100% { transform: translateX(50%); }
        }
        
        /* Sekcja porad dotyczących snu */
        .sleep-tips {
            padding: 1.5rem;
        }
        
        .tip-item {
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--primary-light);
        }
        
        .tip-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .tip-item p {
            color: var(--text-light);
            font-size: 1rem;
            line-height: 1.6;
        }
        
        .tip-item h4 {
            color: var(--accent);
            font-size: 1.2rem;
            margin-bottom: 0.8rem;
            font-weight: 600;
        }
        
        .tip-icon {
            color: var(--accent);
            margin-right: 0.5rem;
        }
        
        /* Przełącznik trybu jasny/ciemny */
        .theme-toggle {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            color: var(--accent);
            font-size: 1.5rem;
            cursor: pointer;
            z-index: 10;
            transition: transform var(--transition-speed);
        }
        
        .theme-toggle:hover {
            transform: rotate(30deg);
        }
        
        /* Stopka */
        footer {
            text-align: center;
            padding: 1.5rem 0;
            margin-top: 1rem;
            color: var(--text-light);
            opacity: 0.7;
        }
        
        /* Animacja księżyca */
        .moon {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 50px;
            height: 50px;
            background-color: var(--white-transparent-strong);
            border-radius: 50%;
            box-shadow: 0 0 20px var(--white-transparent-strong);
            z-index: 0;
            transition: background-color var(--transition-speed), box-shadow var(--transition-speed);
        }
        
        .light-mode .moon {
            background-color: #fbbf24;
            box-shadow: 0 0 30px rgba(251, 191, 36, 0.7);
        }
        
        /* Toast powiadomienia */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        .custom-toast {
            background-color: var(--primary-medium);
            color: var(--text-light);
            border-left: 4px solid var(--accent);
            box-shadow: var(--shadow-md);
        }
        
        /* Stylowanie dla bajek na dobranoc */
        .bedtime-stories {
            margin-top: 1.5rem;
        }
        
        .story-accordion {
            margin-bottom: 1.5rem;
        }
        
        .story-header {
            padding: 1rem;
            background-color: var(--primary-light);
            border-radius: var(--radius-sm);
            margin-bottom: 0.5rem;
            cursor: pointer;
            position: relative;
            transition: background-color var(--transition-speed);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .story-header:hover {
            background-color: var(--accent-transparent-light);
        }
        
        .story-header.active {
            background-color: var(--accent-dark);
        }
        
        .story-header h4 {
            color: var(--text-light);
            margin: 0;
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .story-header.active h4 {
            color: white;
        }
        
        .story-toggle-icon {
            transition: transform var(--transition-speed);
        }
        
        .story-header.active .story-toggle-icon {
            transform: rotate(180deg);
        }
        
        .story-content {
            display: none;
            padding: 1rem;
            background-color: var(--primary-medium);
            border-radius: var(--radius-sm);
            margin-bottom: 1rem;
            border-left: 4px solid var(--accent);
            line-height: 1.6;
        }
        
        .story-content.visible {
            display: block;
        }
        
        .story-content p {
            margin-bottom: 1rem;
            text-shadow: 0 1px 1px var(--black-transparent-light);
        }
        
        /* Responsywność */
        @media (max-width: 768px) {
            h1 {
                font-size: 2.2rem;
            }
            
            h2 {
                font-size: 1.5rem;
            }
            
            .sound-btn {
                padding: 0.6rem 1rem;
                margin: 0.3rem;
                font-size: 0.9rem;
            }
            
            .timer-display {
                font-size: 1.8rem;
            }
            
            .moon {
                width: 40px;
                height: 40px;
                top: 15px;
                left: 15px;
            }
            
            .breathing-circle {
                width: 120px;
                height: 120px;
            }
        }
    </style>
</head>
<body>
    <!-- Tło z gwiazdami i chmurami -->
    <div class="stars" id="stars"></div>
    <div class="moon"></div>
    
    <!-- Toast powiadomienia -->
    <div class="toast-container">
        <div class="toast custom-toast" role="alert" aria-live="assertive" aria-atomic="true" id="app-toast">
            <div class="toast-header">
                <strong class="me-auto" id="toast-title">Powiadomienie</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body" id="toast-message">
                Wiadomość
            </div>
        </div>
    </div>
    
    <div class="container">
        <!-- Przełącznik trybu jasny/ciemny -->
        <button class="theme-toggle" id="theme-toggle" title="Zmień motyw">
            <i class="fas fa-moon" id="theme-icon"></i>
        </button>
        
        <!-- Nagłówek -->
        <header>
            <h1>Śpij Słoneczko</h1>
            <p class="lead">Relaksująca aplikacja stworzona przez dziubaska dla Renatki</p>
        </header>
        
        <!-- Główna zawartość -->
        <main>
            <!-- Odtwarzacz dźwięków i timer -->
            <div class="card sound-player">
                <div class="card-body">
                    <h2><i class="fas fa-music"></i> Relaksujące dźwięki</h2>
                    
                    <!-- Przyciski dźwięków -->
                    <div class="d-flex flex-wrap justify-content-center mb-4">
                        <button class="sound-btn" data-sound="ocean"><i class="fas fa-water"></i> Szum morza</button>
                        <button class="sound-btn" data-sound="rain"><i class="fas fa-cloud-rain"></i> Deszcz</button>
                        <button class="sound-btn" data-sound="forest"><i class="fas fa-tree"></i> Las</button>
                        <button class="sound-btn" data-sound="night"><i class="fas fa-moon"></i> Noc</button>
                        <button class="sound-btn" data-sound="whitenoise"><i class="fas fa-wave-square"></i> Biały szum</button>
                        <button class="sound-btn" data-sound="dziubasek"><i class="fas fa-heart"></i> Dziubasek</button>
                        <button class="sound-btn" data-sound="dziubasek-vol2"><i class="fas fa-heartbeat"></i> Dziubasek Vol.2</button>
                    </div>
                    
                    <!-- Wizualizacja aktywnych dźwięków -->
                    <div class="active-sounds my-3" id="active-sounds-container">
                        <!-- Aktywne dźwięki będą dodawane tutaj dynamicznie -->
                    </div>
                    
                    <div class="controls">
                        <!-- Kontrola głośności -->
                        <div class="slider-container">
                            <label for="volume" class="form-label"><i class="fas fa-volume-up"></i> Głośność</label>
                            <input type="range" class="form-range" id="volume" min="0" max="1" step="0.01" value="0.5">
                        </div>
                        
                        <!-- Timer -->
                        <div class="timer-container">
                            <h3><i class="fas fa-clock"></i> Timer snu</h3>
                            <div class="timer-display" id="timer-display">00:00:00</div>
                            <div class="d-flex flex-wrap justify-content-center">
                                <button class="sound-btn timer-btn" data-time="5">5 min</button>
                                <button class="sound-btn timer-btn" data-time="15">15 min</button>
                                <button class="sound-btn timer-btn" data-time="30">30 min</button>
                                <button class="sound-btn timer-btn" data-time="60">1 godz</button>
                                <button class="sound-btn timer-btn" data-time="0"><i class="fas fa-stop"></i> Wyłącz</button>
                            </div>
                            
                            <!-- Niestandardowy timer -->
                            <div class="custom-timer-container mt-3">
                                <input type="number" min="1" max="480" class="custom-timer-input" id="custom-timer-input" placeholder="min">
                                <button class="sound-btn" id="custom-timer-btn"><i class="fas fa-check"></i> Ustaw</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Rozbudowane ćwiczenia relaksacyjne -->
            <div class="card relaxation-exercises">
                <div class="card-body">
                    <h2><i class="fas fa-spa"></i> Ćwiczenia relaksacyjne</h2>
                    
                    <div class="exercise-tabs">
                        <button class="exercise-tab active" data-tab="breathing"><i class="fas fa-lungs"></i> Techniki oddechowe</button>
                        <button class="exercise-tab" data-tab="muscle"><i class="fas fa-walking"></i> Relaksacja mięśni</button>
                        <button class="exercise-tab" data-tab="visualization"><i class="fas fa-cloud-sun"></i> Wizualizacje</button>
                        <button class="exercise-tab" data-tab="stories"><i class="fas fa-book"></i> Bajki na dobranoc</button>
                    </div>
                    
                    <!-- Techniki oddechowe -->
                    <div class="exercise-content active" id="breathing-content">
                        <div class="exercise-tabs">
                            <button class="exercise-tab active" data-breathing="478"><i class="fas fa-wind"></i> Technika 4-7-8</button>
                            <button class="exercise-tab" data-breathing="box"><i class="fas fa-square"></i> Oddychanie kwadratowe 4-4-4-4</button>
                            <button class="exercise-tab" data-breathing="diaphragm"><i class="fas fa-circle"></i> Oddychanie przeponowe</button>
                        </div>
                        
                        <div class="breathing-exercise">
                            <p id="breathing-description">Technika 4-7-8 pomaga zrelaksować się i przygotować do snu</p>
                            <div class="breathing-circle" id="breathing-circle">
                                <span id="breathing-text">Kliknij, aby rozpocząć</span>
                            </div>
                            <button class="sound-btn mt-4" id="start-breathing-btn">Rozpocznij ćwiczenie</button>
                        </div>
                    </div>
                    
                    <!-- Progresywna relaksacja mięśni -->
                    <div class="exercise-content" id="muscle-content">
                        <p class="exercise-intro">Progresywna relaksacja mięśni polega na naprzemiennym napinaniu i rozluźnianiu poszczególnych grup mięśni. Wykonuj to ćwiczenie w wygodnej pozycji, najlepiej leżącej.</p>
                        
                        <div class="relaxation-progress">
                            <div class="relaxation-progress-bar" id="muscle-progress"></div>
                        </div>
                        
                        <div class="muscle-relaxation-section">
                            <div class="muscle-group" data-group="hands">
                                <h4><i class="fas fa-hand-paper"></i> Dłonie i przedramiona</h4>
                                <div class="muscle-instruction">
                                    <p>1. Zaciśnij dłonie w pięści tak mocno, jak możesz</p>
                                    <p>2. Utrzymaj napięcie przez 5 sekund</p>
                                    <p>3. Powoli rozluźnij dłonie, czując jak napięcie odpływa</p>
                                    <p>4. Odpoczywaj przez 10 sekund, skupiając się na uczuciu rozluźnienia</p>
                                </div>
                            </div>
                            
                            <div class="muscle-group" data-group="arms">
                                <h4><i class="fas fa-running"></i> Ramiona i bicepsy</h4>
                                <div class="muscle-instruction">
                                    <p>1. Zegnij ręce w łokciach i napnij bicepsy</p>
                                    <p>2. Utrzymaj napięcie przez 5 sekund</p>
                                    <p>3. Powoli rozluźnij mięśnie, pozwalając ramionom opaść swobodnie</p>
                                    <p>4. Odpoczywaj przez 10 sekund, zauważając różnicę między napięciem a rozluźnieniem</p>
                                </div>
                            </div>
                            
                            <div class="muscle-group" data-group="shoulders">
                                <h4><i class="fas fa-user"></i> Barki i kark</h4>
                                <div class="muscle-instruction">
                                    <p>1. Podnieś barki w kierunku uszu (jak przy wzruszaniu ramionami)</p>
                                    <p>2. Utrzymaj napięcie przez 5 sekund</p>
                                    <p>3. Powoli opuść barki, pozwalając im całkowicie opaść</p>
                                    <p>4. Odpoczywaj przez 10 sekund, skupiając się na cieple rozchodzącym się po barkach</p>
                                </div>
                            </div>
                            
                            <div class="muscle-group" data-group="face">
                                <h4><i class="fas fa-smile"></i> Twarz i szczęka</h4>
                                <div class="muscle-instruction">
                                    <p>1. Zaciśnij szczękę, napnij usta i zmruż mocno oczy</p>
                                    <p>2. Utrzymaj napięcie przez 5 sekund</p>
                                    <p>3. Powoli rozluźnij wszystkie mięśnie twarzy</p>
                                    <p>4. Odpoczywaj przez 10 sekund, pozwalając twarzy być całkowicie rozluźnioną</p>
                                </div>
                            </div>
                            
                            <div class="muscle-group" data-group="chest">
                                <h4><i class="fas fa-lungs"></i> Klatka piersiowa i brzuch</h4>
                                <div class="muscle-instruction">
                                    <p>1. Weź głęboki wdech i napnij mięśnie brzucha</p>
                                    <p>2. Utrzymaj napięcie przez 5 sekund</p>
                                    <p>3. Powoli wydychaj powietrze, rozluźniając mięśnie</p>
                                    <p>4. Odpoczywaj przez 10 sekund, oddychając naturalnie</p>
                                </div>
                            </div>
                            
                            <div class="muscle-group" data-group="legs">
                                <h4><i class="fas fa-shoe-prints"></i> Nogi i stopy</h4>
                                <div class="muscle-instruction">
                                    <p>1. Napnij uda, łydki i stopy, podciągając palce stóp do góry</p>
                                    <p>2. Utrzymaj napięcie przez 5 sekund</p>
                                    <p>3. Powoli rozluźnij wszystkie mięśnie nóg</p>
                                    <p>4. Odpoczywaj przez 10 sekund, czując ciężar rozluźnionych nóg</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="text-center mt-4">
                            <button class="sound-btn" id="start-muscle-relaxation">Rozpocznij pełne ćwiczenie</button>
                        </div>
                    </div>
                    
                    <!-- Wizualizacje relaksacyjne -->
                    <div class="exercise-content" id="visualization-content">
                        <p class="exercise-intro">Wybierz scenę do wizualizacji. Zamknij oczy, słuchaj opisu i spróbuj wyobrazić sobie to miejsce wszystkimi zmysłami.</p>
                        
                        <div class="exercise-tabs visualization-scene-tabs">
                            <button class="exercise-tab active" data-scene="beach"><i class="fas fa-umbrella-beach"></i> Plaża</button>
                            <button class="exercise-tab" data-scene="forest"><i class="fas fa-tree"></i> Las</button>
                            <button class="exercise-tab" data-scene="sky"><i class="fas fa-cloud-moon"></i> Rozgwieżdżone niebo</button>
                        </div>
                        
                        <div class="visualization-scene visualization-beach" id="visualization-scene">
                            <div class="wave"></div>
                            <div class="wave"></div>
                            <div class="wave"></div>
                            <div class="visualization-overlay">
                                <p class="visualization-text" id="visualization-text">
                                    Wyobraź sobie, że leżysz na ciepłej, miękkiej plaży. Słońce delikatnie ogrzewa twoją skórę.
                                    Słyszysz rytmiczny szum fal, które łagodnie uderzają o brzeg...
                                </p>
                            </div>
                        </div>
                        
                        <div class="text-center mt-3">
                            <button class="sound-btn" id="start-visualization">Rozpocznij wizualizację</button>
                        </div>
                    </div>
                    
                    <!-- Bajki na dobranoc -->
                    <div class="exercise-content" id="stories-content">
                        <p class="exercise-intro">Wybierz jedną z bajek na dobranoc. Przeczytaj lub opowiedz ją, aby pomóc w wyciszeniu się przed snem.</p>
                        
                        <div class="bedtime-stories">
                            <div class="story-accordion">
                                <div class="story-header" data-story="star">
                                    <h4><i class="fas fa-star tip-icon"></i> Gwiazda, która bała się ciemności</h4>
                                    <i class="fas fa-chevron-down story-toggle-icon"></i>
                                </div>
                                <div class="story-content" id="star-story">
                                    <p>Dawno temu, wysoko na niebie mieszkała mała gwiazda o imieniu Luna. Luna była wyjątkowa – w przeciwieństwie do innych gwiazd, które kochały noc, ona bała się ciemności.</p>
                                    <p>"Jak możesz bać się ciemności?" - pytały inne gwiazdy. "Przecież jesteśmy gwiazdami! Świecimy właśnie w ciemności!"</p>
                                    <p>Ale Luna nie mogła poradzić sobie ze swoim lękiem. Zamiast świecić jasno jak inne gwiazdy, jej blask był ledwo widoczny, przytłumiony przez strach.</p>
                                    <p>Pewnej nocy Luna spotkała Księżyc, który zauważył jej problem. "Droga Luno," powiedział łagodnie, "pozwól, że zdradzę ci pewien sekret. Ciemność nie jest niczym strasznym. To po prostu przestrzeń czekająca, aż wypełni ją światło."</p>
                                    <p>Luna zastanowiła się nad tymi słowami. "Ale co jeśli moje światło jest zbyt małe, aby wypełnić całą tę ciemność?" - zapytała.</p>
                                    <p>"Spójrz w dół, na Ziemię," odpowiedział Księżyc. Luna spojrzała i zobaczyła małą dziewczynkę, która nie mogła zasnąć, gdyż również bała się ciemności. Dziewczynka wyglądała przez okno, szukając światła na niebie.</p>
                                    <p>"Widzisz?" - powiedział Księżyc. "Dla tej małej dziewczynki twoje światło może być najjaśniejszym punktem w nocy, przewodnikiem i pocieszeniem."</p>
                                    <p>Luna pomyślała o dziewczynce – o kimś, kto potrzebował jej światła tak samo, jak ona potrzebowała odwagi. Nagle poczuła, jak jej strach zaczyna znikać, a jej światło staje się coraz jaśniejsze.</p>
                                    <p>Od tej nocy Luna świeciła jasno, dumna ze swojej roli w ciemności. A mała dziewczynka znalazła swoją ulubioną gwiazdę na niebie – tę, która wydawała się świecić specjalnie dla niej, rozpraszając wszystkie lęki.</p>
                                    <p>I tak Luna odkryła, że czasami najjaśniej świecimy wtedy, gdy zamiast koncentrować się na własnych lękach, skupiamy się na przynoszeniu światła innym.</p>
                                </div>
                            </div>
                            
                            <div class="story-accordion">
                                <div class="story-header" data-story="forest">
                                    <h4><i class="fas fa-tree tip-icon"></i> Mądra Sowa i Las Snów</h4>
                                    <i class="fas fa-chevron-down story-toggle-icon"></i>
                                </div>
                                <div class="story-content" id="forest-story">
                                    <p>W samym sercu Czarodziejskiego Lasu mieszkała Mądra Sowa. Znana była ze swojej niezwykłej wiedzy i tajemniczej mocy – umiała zbierać sny i rozdawać je wieczorem wszystkim leśnym mieszkańcom.</p>
                                    <p>Co wieczór zwierzęta gromadziły się wokół jej starego dębu, czekając na sen, który pomoże im przespać noc. Mądra Sowa miała ich całą kolekcję – sny o lataniu dla ptaków, sny o pływaniu dla ryb, kolorowe sny dla motyli i przytulne sny dla niedźwiedzi.</p>
                                    <p>Pewnego dnia do lasu przybłąkał się mały jeżyk o imieniu Kolczatek. Był zmęczony po długiej podróży i potrzebował dobrego odpoczynku, ale miał problem – od dawna cierpiał na bezsenność.</p>
                                    <p>"Próbowałem wszystkiego," wyszeptał do Sowy, "liczyłem gwiazdy, piłem ciepłe mleko z miodem, nawet śpiewałem kołysanki sam sobie, ale nic nie działa. Czy możesz mi pomóc?"</p>
                                    <p>Mądra Sowa przyjrzała się małemu jeżykowi z uwagą. "Twój problem, mały przyjacielu, polega na tym, że twój umysł nadal biega, kiedy twoje ciało chce odpocząć. Potrzebujesz wyjątkowego snu, który pomoże ci się wyciszyć."</p>
                                    <p>Sowa poszukała w swojej kolekcji i znalazła specjalny sen, zawinięty w liść miętowy. "To jest Sen o Ciszy. Jest rzadki i bardzo cenny."</p>
                                    <p>Kolczatek podziękował Sowie i wrócił do swojego domku pod korzeniami. Tej nocy, gdy zamknął oczy, poczuł jak Sen o Ciszy otula go jak miękki koc. W tym śnie znalazł się na spokojnej polanie, gdzie słyszał tylko delikatny szept wiatru i odległe śpiewy ptaków. Powoli, jego oddech stał się głębszy, a myśli spokojniejsze.</p>
                                    <p>Kolczatek spał tej nocy lepiej niż kiedykolwiek wcześniej. Gdy się obudził, był wypoczęty i pełen energii. Od tego dnia, zanim poszedł spać, zawsze wyobrażał sobie tę spokojną polanę ze swojego snu.</p>
                                    <p>"Nie potrzebujesz już mojego magicznego snu," powiedziała Sowa, gdy Kolczatek przyszedł jej podziękować. "Nauczyłeś się, jak znaleźć ciszę w sobie. To jest prawdziwa magia snu."</p>
                                    <p>I tak mały jeżyk odkrył, że najpiękniejsze sny nie są tymi, które dostajemy od innych, ale tymi, które sami potrafimy stworzyć w naszych sercach.</p>
                                </div>
                            </div>
                            
                            <div class="story-accordion">
                                <div class="story-header" data-story="moon">
                                    <h4><i class="fas fa-moon tip-icon"></i> Księżyc i Marzenia</h4>
                                    <i class="fas fa-chevron-down story-toggle-icon"></i>
                                </div>
                                <div class="story-content" id="moon-story">
                                    <p>Każdej nocy, gdy cały świat zasypiał, Księżyc rozpoczynał swoją najważniejszą pracę. Nie było to tylko świecenie na niebie – to było coś znacznie ważniejszego. Księżyc zbierał marzenia śpiących dzieci.</p>
                                    <p>Używając swoich srebrnych promieni jak delikatnych rąk, ostrożnie podnosił marzenia, które unosiły się nad głowami śpiących dzieci. Niektóre marzenia były lekkie jak piórka, inne ciężkie jak kamienie. Niektóre błyszczały kolorami tęczy, inne były ciche i skromne. Księżyc kochał je wszystkie.</p>
                                    <p>Po zebraniu marzeń, Księżyc zabierał je wysoko na niebo, gdzie czekały na nie gwiazdy. Każda gwiazda miała specjalne zadanie – opiekowała się jednym marzeniem, karmiła je światłem i magią, sprawiając, że stawało się silniejsze.</p>
                                    <p>Była wśród nich dziewczynka o imieniu Zosia, która każdej nocy marzyła o tym samym – chciała latać. Jej marzenie było wyjątkowo jasne i przyciągało uwagę Księżyca. "To marzenie potrzebuje specjalnej opieki," pomyślał, powierzając je najjaśniejszej gwieździe na niebie.</p>
                                    <p>Mijały noce i miesiące. Marzenie Zosi rosło i nabierało kształtów, aż pewnej nocy, gdy spała, stało się coś magicznego. W swoim śnie Zosia poczuła, jak jej stopy odrywają się od ziemi. Najpierw unosiła się tylko kilka centymetrów, potem metr, aż w końcu szybowała wysoko ponad dachami domów, drzewami i chmurami.</p>
                                    <p>Gdy Zosia się obudziła, poczuła radość i spełnienie, choć nie pamiętała dokładnie swojego snu. Wiedziała tylko, że jest szczęśliwa i że coś wspaniałego wydarzyło się w nocy.</p>
                                    <p>Tej samej nocy, gdy spała, Księżyc zobaczył coś niezwykłego – z jej serca unosiło się nowe marzenie, tym razem o pomaganiu innym w spełnianiu ich własnych marzeń.</p>
                                    <p>Księżyc uśmiechnął się. Najpiękniejsza część jego pracy to nie tylko zbieranie marzeń, ale obserwowanie, jak jedno spełnione marzenie rodzi kolejne, jeszcze piękniejsze.</p>
                                    <p>I tak, każdej nocy, gdy patrzysz na niebo i widzisz Księżyc, pamiętaj – on nie tylko świeci, ale także dba o twoje najcenniejsze marzenia, aż nadejdzie czas, by stały się rzeczywistością.</p>
                                </div>
                            </div>
                            
                            <div class="story-accordion">
                                <div class="story-header" data-story="cloud">
                                    <h4><i class="fas fa-cloud tip-icon"></i> Mała Chmurka i jej Podróż</h4>
                                    <i class="fas fa-chevron-down story-toggle-icon"></i>
                                </div>
                                <div class="story-content" id="cloud-story">
                                    <p>Wysoko na niebie, gdzie powietrze jest czyste i błękitne, żyła sobie maleńka chmurka o imieniu Puszek. Była najmniejsza spośród wszystkich chmurek na niebie i często czuła się pominięta.</p>
                                    <p>"Jesteś zbyt mała, by tworzyć deszcz," mówiły większe chmury. "Nawet twój cień jest ledwo widoczny na ziemi."</p>
                                    <p>Puszek marzyła o tym, by pewnego dnia stać się wielką, potężną chmurą burzową, która mogłaby przynosić życiodajny deszcz spragnionym polom i lasom. Ale bez względu na to, jak bardzo się starała, pozostawała maleńka i puszystoszara.</p>
                                    <p>Pewnego dnia silny wiatr porwał Puszka i poniósł daleko od domu, nad rozległą pustynię. Puszek nigdy wcześniej nie widziała pustyni i przestraszyła się jej ogromnych, pustych przestrzeni. Nie było tam żadnych innych chmurek, z którymi mogłaby porozmawiać.</p>
                                    <p>Gdy tak dryfowała samotnie, usłyszała cichy głos. "Proszę, chmurko, zostań ze mną choć na chwilę." To był mały kaktus, samotny pośród piasków.</p>
                                    <p>"Jestem tylko małym Puszkiem," odpowiedziała chmurka. "Nie mam w sobie deszczu, nie mogę ci pomóc."</p>
                                    <p>"Ale twój cień," powiedział kaktus, "daje mi chwilę wytchnienia od palącego słońca. To więcej, niż miałem od wielu dni."</p>
                                    <p>Puszek nigdy nie pomyślał, że jego mały cień mógłby być dla kogoś tak ważny. Postanowił zostać nad kaktusem tak długo, jak się da. Przez cały dzień zapewniał mu cień i ochłodę.</p>
                                    <p>Gdy słońce zachodziło, kaktus podziękował chmurce. "Dzięki tobie przetrwałem dziś. Twoja dobroć jest jak deszcz dla mojego serca."</p>
                                    <p>Tej nocy, gdy Puszek unosił się nad pustynią, zauważył coś dziwnego – choć nie urósł ani trochę, czuł się jakoś... większy. Jakby wypełniał go spokój i radość znacznie większe niż on sam.</p>
                                    <p>Z czasem Puszek nauczył się, że prawdziwa wielkość nie zawsze zależy od rozmiaru. Czasami najmniejszy cień może mieć największe znaczenie dla kogoś, kto tego potrzebuje. I chociaż nigdy nie stał się wielką chmurą burzową, jego mały cień przynosił ulgę wielu zmęczonym wędrowcom i samotnym roślinom na pustyni.</p>
                                    <p>A gdy czasem spotykał się z innymi chmurami, dzielił się z nimi swoją mądrością: "Nie martw się o swoją wielkość. Martw się o wielkie dobro, które możesz uczynić, bez względu na to, jak mały jesteś."</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Porady dotyczące snu -->
            <div class="card sleep-tips">
                <div class="card-body">
                    <h2><i class="fas fa-bed"></i> Porady dla lepszego snu</h2>
                    <div class="tip-item">
                        <h4><i class="fas fa-calendar-alt tip-icon"></i> Regularne godziny snu</h4>
                        <p>Staraj się chodzić spać i budzić się o tej samej porze każdego dnia, nawet w weekendy. To pomaga w regulacji twojego wewnętrznego zegara biologicznego.</p>
                    </div>
                    <div class="tip-item">
                        <h4><i class="fas fa-mobile-alt tip-icon"></i> Unikaj niebieskiego światła</h4>
                        <p>Ogranicz korzystanie z urządzeń elektronicznych (telefon, tablet, laptop) co najmniej godzinę przed snem. Niebieskie światło emitowane przez te urządzenia może zakłócać produkcję melatoniny.</p>
                    </div>
                    <div class="tip-item">
                        <h4><i class="fas fa-spa tip-icon"></i> Stwórz rytuał przed snem</h4>
                        <p>Rozwijaj rytuały, które sygnalizują twojemu ciału, że czas się zrelaksować. Może to być czytanie książki, ciepła kąpiel, medytacja lub słuchanie kojącej muzyki.</p>
                    </div>
                    <div class="tip-item">
                        <h4><i class="fas fa-mug-hot tip-icon"></i> Pij ziołowe herbaty przed snem</h4>
                        <p>Ciepłe ziołowe napary, takie jak melisa, rumianek, lawenda czy lipa, pomagają się zrelaksować i przygotować ciało do snu. Wypijaj filiżankę około godzinę przed planowanym czasem snu.</p>
                    </div>
                    <div class="tip-item">
                        <h4><i class="fas fa-temperature-low tip-icon"></i> Komfortowa sypialnia</h4>
                        <p>Upewnij się, że twoja sypialnia jest ciemna, cicha i ma odpowiednią temperaturę (18-20°C). Wygodny materac i poduszki również są ważne dla jakości snu.</p>
                    </div>
                    <div class="tip-item">
                        <h4><i class="fas fa-headphones tip-icon"></i> Personalizuj dźwięki do zasypiania</h4>
                        <p>Wybieraj dźwięki, które osobiście działają na Ciebie uspokajająco. Możesz nagrać swoje ulubione odgłosy natury podczas spaceru, szum morza z wakacji, czy nawet znajome dźwięki domowe, które kojarzą Ci się z bezpieczeństwem i spokojem.</p>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- Stopka -->
        <footer>
            <p>© 2025 Śpij Słoneczko | Stworzone z miłością przez dziubaska dla Renatki 💝🌞💝</p>
            <p><a href="#" id="save-preferences" class="text-decoration-none" style="color: var(--accent)">Zapisz preferencje</a></p>
        </footer>
    </div>
    
    <!-- Szablony HTML -->
    <template id="sound-card-template">
        <div class="sound-card mb-2">
            <div class="d-flex align-items-center">
                <div class="sound-wave me-2">
                    <span></span>
                    <span></span>
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <span class="sound-name"></span>
            </div>
            <div>
                <input type="range" class="form-range individual-volume" min="0" max="1" step="0.01" value="0.5" style="width: 100px;">
                <button class="btn-close sound-close ms-2" aria-label="Close"></button>
            </div>
        </div>
    </template>
    
    <!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    
    <!-- Główny skrypt JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Inicjalizacja tooltipów Bootstrap
            const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });
            
            // Inicjalizacja toastów
            const toastEl = document.getElementById('app-toast');
            const toast = new bootstrap.Toast(toastEl, {
                autohide: true,
                delay: 3000
            });
            
            // Funkcja do pokazywania powiadomień
            function showToast(title, message) {
                document.getElementById('toast-title').textContent = title;
                document.getElementById('toast-message').textContent = message;
                toast.show();
            }
            
            // Tworzenie gwiazd dla animowanego tła
            const starsContainer = document.getElementById('stars');
            const starsCount = 150; // Liczba gwiazd
            
            // Tworzenie gwiazd
            for (let i = 0; i < starsCount; i++) {
                const star = document.createElement('div');
                star.classList.add('star');
                
                // Losowa pozycja
                star.style.left = `${Math.random() * 100}%`;
                star.style.top = `${Math.random() * 100}%`;
                
                // Losowy rozmiar (1-3px)
                const size = Math.random() * 2 + 1;
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                
                // Losowa intensywność blasku
                star.style.setProperty('--intensity', 0.2 + Math.random() * 0.8);
                
                // Losowe opóźnienie i czas trwania animacji
                star.style.setProperty('--delay', `${Math.random() * 4}s`);
                star.style.setProperty('--duration', `${3 + Math.random() * 5}s`);
                
                starsContainer.appendChild(star);
            }
            
            // Dodanie kilku przesuwających się chmur
            for (let i = 0; i < 5; i++) {
                const cloud = document.createElement('div');
                cloud.classList.add('cloud');
                
                // Losowa pozycja
                cloud.style.left = `${Math.random() * 100}%`;
                cloud.style.top = `${Math.random() * 100}%`;
                
                // Losowy rozmiar
                const size = 100 + Math.random() * 200;
                cloud.style.width = `${size}px`;
                cloud.style.height = `${size / 2}px`;
                
                // Losowe opóźnienie i czas trwania animacji
                cloud.style.setProperty('--duration', `${50 + Math.random() * 30}s`);
                
                starsContainer.appendChild(cloud);
            }
            
            // ========== PRZEŁĄCZNIK TRYBU JASNY/CIEMNY ==========
            const themeToggle = document.getElementById('theme-toggle');
            const themeIcon = document.getElementById('theme-icon');
            
            // Sprawdź, czy użytkownik ma zapisane preferencje
            const savedTheme = localStorage.getItem('spijSloneczko-theme');
            if (savedTheme === 'light') {
                document.body.classList.add('light-mode');
                themeIcon.classList.remove('fa-moon');
                themeIcon.classList.add('fa-sun');
            }
            
            themeToggle.addEventListener('click', function() {
                document.body.classList.toggle('light-mode');
                
                if (document.body.classList.contains('light-mode')) {
                    themeIcon.classList.remove('fa-moon');
                    themeIcon.classList.add('fa-sun');
                    localStorage.setItem('spijSloneczko-theme', 'light');
                } else {
                    themeIcon.classList.remove('fa-sun');
                    themeIcon.classList.add('fa-moon');
                    localStorage.setItem('spijSloneczko-theme', 'dark');
                }
            });
            
            // ========== SYSTEM ODTWARZANIA DŹWIĘKÓW ==========
            
            // Pobranie elementów DOM
            const soundButtons = document.querySelectorAll('.sound-btn[data-sound]');
            const volumeSlider = document.getElementById('volume');
            const timerButtons = document.querySelectorAll('.timer-btn');
            const timerDisplay = document.getElementById('timer-display');
            const customTimerInput = document.getElementById('custom-timer-input');
            const customTimerBtn = document.getElementById('custom-timer-btn');
            const activeContainer = document.getElementById('active-sounds-container');
            const soundCardTemplate = document.getElementById('sound-card-template');
            
            // Timer
            let timerInterval = null;
            let timerEndTime = null;
            
            // Przechowywanie aktywnych dźwięków (jako mapa)
            const activeSounds = new Map();
            
            // ===== KONFIGURACJA DŹWIĘKÓW =====
            const sounds = {
                'ocean': 'sounds/ocean.wav',
                'rain': 'sounds/rain.mp3',
                'forest': 'sounds/forest.mp3',
                'night': 'sounds/night.mp3',
                'whitenoise': 'sounds/whitenoise.wav',
                'dziubasek': 'sounds/dziubasek.mp3',
                'dziubasek-vol2': 'sounds/dziubasek-vol2.mp3'
            };
            
            // Mapowanie nazw dźwięków na przyjazne nazwy polskie
            const soundNames = {
                'ocean': 'Szum morza',
                'rain': 'Deszcz',
                'forest': 'Las',
                'night': 'Noc',
                'whitenoise': 'Biały szum',
                'dziubasek': 'Dziubasek',
                'dziubasek-vol2': 'Dziubasek Vol.2'
            };
            
            // Mapowanie nazw dźwięków na ikony
            const soundIcons = {
                'ocean': 'fa-water',
                'rain': 'fa-cloud-rain',
                'forest': 'fa-tree',
                'night': 'fa-moon',
                'whitenoise': 'fa-wave-square',
                'dziubasek': 'fa-heart',
                'dziubasek-vol2': 'fa-heartbeat'
            };
            
            // Funkcja tworząca element karty dźwięku
            function createSoundCard(soundName, audio) {
                const template = soundCardTemplate.content.cloneNode(true);
                const card = template.querySelector('.sound-card');
                card.dataset.sound = soundName;
                
                // Ustaw nazwę dźwięku
                const nameElement = card.querySelector('.sound-name');
                nameElement.textContent = soundNames[soundName] || soundName;
                
                // Dodaj ikonę
                const iconClass = soundIcons[soundName];
                if (iconClass) {
                    const icon = document.createElement('i');
                    icon.className = `fas ${iconClass} me-2`;
                    nameElement.prepend(icon);
                }
                
                // Ustaw klasę aktywną dla wizualizacji dźwięku
                card.classList.add('active');
                const soundWave = card.querySelector('.sound-wave');
                soundWave.classList.add('active');
                
                // Obsługa indywidualnej głośności
                const volumeControl = card.querySelector('.individual-volume');
                volumeControl.value = audio.volume;
                volumeControl.addEventListener('input', function() {
                    audio.volume = parseFloat(this.value);
                });
                
                // Obsługa przycisku zamykania
                const closeBtn = card.querySelector('.sound-close');
                closeBtn.addEventListener('click', function() {
                    stopSound(soundName);
                });
                
                return card;
            }
            
            // Funkcja odtwarzania dźwięku
            function playSound(soundName) {
                // Jeśli dźwięk jest już odtwarzany, zatrzymaj go
                if (activeSounds.has(soundName)) {
                    stopSound(soundName);
                    return;
                }
                
                try {
                    // Sprawdź, czy ścieżka do dźwięku istnieje
                    if (!sounds[soundName]) {
                        showToast("Błąd", `Brak pliku dźwiękowego dla: ${soundName}`);
                        return;
                    }
                    
                    // Utwórz element audio
                    const audio = new Audio(sounds[soundName]);
                    
                    // Ustawienia
                    audio.loop = true; // Zapętlenie dźwięku
                    
                    // Pobierz aktualną wartość głośności z suwaka
                    const volume = parseFloat(volumeSlider.value);
                    audio.volume = volume;
                    
                    // Obsługa błędów ładowania pliku
                    audio.onerror = function() {
                        showToast("Błąd", `Nie można załadować pliku: ${sounds[soundName]}`);
                    };
                    
                    // Rozpocznij odtwarzanie
                    audio.play().catch(err => {
                        showToast("Błąd", "Błąd odtwarzania dźwięku. Sprawdź uprawnienia przeglądarki.");
                    });
                    
                    // Dodaj dźwięk do aktywnych
                    activeSounds.set(soundName, audio);
                    
                    // Dodaj klasę active do przycisku
                    document.querySelector(`.sound-btn[data-sound="${soundName}"]`).classList.add('active');
                    
                    // Dodaj kartę dźwięku do kontenera
                    const soundCard = createSoundCard(soundName, audio);
                    activeContainer.appendChild(soundCard);
                    
                } catch (error) {
                    showToast("Błąd", "Wystąpił nieoczekiwany błąd podczas odtwarzania dźwięku");
                }
            }
            
            // Zatrzymanie pojedynczego dźwięku
            function stopSound(soundName) {
                if (activeSounds.has(soundName)) {
                    const audio = activeSounds.get(soundName);
                    audio.pause();
                    audio.currentTime = 0;
                    activeSounds.delete(soundName);
                    
                    // Usuń klasę active z przycisku
                    const button = document.querySelector(`.sound-btn[data-sound="${soundName}"]`);
                    if (button) button.classList.remove('active');
                    
                    // Usuń kartę dźwięku
                    const card = document.querySelector(`.sound-card[data-sound="${soundName}"]`);
                    if (card) card.remove();
                }
            }
            
            // Zatrzymanie wszystkich dźwięków
            function stopAllSounds() {
                for (const [soundName, audio] of activeSounds.entries()) {
                    audio.pause();
                    audio.currentTime = 0;
                    
                    // Usuń klasę active z przycisku
                    const button = document.querySelector(`.sound-btn[data-sound="${soundName}"]`);
                    if (button) button.classList.remove('active');
                }
                
                activeSounds.clear();
                activeContainer.innerHTML = '';
            }
            
            // Funkcja do płynnego wyciszania dźwięków
            function fadeOutAllSounds(duration = 3000) {
                // Zapisz początkowe głośności dla każdego dźwięku
                const initialVolumes = new Map();
                for (const [soundName, audio] of activeSounds.entries()) {
                    initialVolumes.set(soundName, audio.volume);
                }
                
                const startTime = Date.now();
                const fadeInterval = setInterval(() => {
                    const elapsed = Date.now() - startTime;
                    const ratio = 1 - Math.min(elapsed / duration, 1);
                    
                    // Aktualizuj głośność każdego dźwięku
                    for (const [soundName, audio] of activeSounds.entries()) {
                        audio.volume = initialVolumes.get(soundName) * ratio;
                    }
                    
                    // Zatrzymaj interwał i dźwięki po zakończeniu wyciszania
                    if (elapsed >= duration) {
                        clearInterval(fadeInterval);
                        stopAllSounds();
                    }
                }, 50);
            }
            
            // Ustawienie timera
            function setTimer(minutes) {
                // Wyczyszczenie istniejącego timera
                clearInterval(timerInterval);
                
                // Usunięcie klasy active ze wszystkich przycisków timera
                timerButtons.forEach(btn => btn.classList.remove('active'));
                
                // Jeśli minutes wynosi 0, wyczyść timer
                if (minutes === 0) {
                    timerDisplay.textContent = '00:00:00';
                    timerEndTime = null;
                    return;
                }
                
                // Aktywuj przycisk timera jeśli jest standardowym timerem
                const timerBtn = document.querySelector(`.timer-btn[data-time="${minutes}"]`);
                if (timerBtn) {
                    timerBtn.classList.add('active');
                }
                
                // Oblicz czas zakończenia
                const now = new Date();
                timerEndTime = new Date(now.getTime() + minutes * 60000);
                
                // Natychmiast aktualizuj wyświetlanie timera
                updateTimerDisplay();
                
                // Ustaw interwał do aktualizacji wyświetlania
                timerInterval = setInterval(function() {
                    if (!updateTimerDisplay()) {
                        // Timer zakończony
                        clearInterval(timerInterval);
                        
                        // Płynnie wycisz wszystkie dźwięki
                        fadeOutAllSounds(5000);
                        
                        // Usuń aktywne klasy z przycisków timera
                        timerButtons.forEach(btn => btn.classList.remove('active'));
                        
                        // Powiadomienie
                        showToast('Timer zakończony', 'Dźwięki zostały płynnie wyciszone.');
                        
                        // Powiadomienie przeglądarki (opcjonalnie)
                        if ('Notification' in window && Notification.permission === 'granted') {
                            new Notification('Śpij Słoneczko', {
                                body: 'Timer zakończony. Dźwięki zostały wyciszone.',
                                icon: '/favicon.ico'
                            });
                        }
                    }
                }, 1000);
                
                // Pokaż powiadomienie o ustawieniu timera
                showToast('Timer ustawiony', `Timer ustawiony na ${minutes} minut.`);
            }
            
            // Aktualizacja wyświetlania timera
            function updateTimerDisplay() {
                if (!timerEndTime) return false;
                
                const now = new Date();
                const diff = timerEndTime - now;
                
                // Jeśli timer się zakończył
                if (diff <= 0) {
                    timerDisplay.textContent = '00:00:00';
                    return false;
                }
                
                // Oblicz godziny, minuty, sekundy
                const hours = Math.floor(diff / 3600000);
                const minutes = Math.floor((diff % 3600000) / 60000);
                const seconds = Math.floor((diff % 60000) / 1000);
                
                // Formatuj wyświetlanie
                timerDisplay.textContent = 
                    `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                return true;
            }
            
            // =========== ROZBUDOWANE ĆWICZENIA RELAKSACYJNE ===========
            // Zmienne dla ćwiczeń oddechowych
            const breathingCircle = document.getElementById('breathing-circle');
            const breathingText = document.getElementById('breathing-text');
            const breathingDescription = document.getElementById('breathing-description');
            const startBreathingBtn = document.getElementById('start-breathing-btn');
            let breathingInterval = null;
            let currentBreathingType = '478'; // domyślnie 4-7-8
            
            // Definicje ćwiczeń oddechowych
            const breathingTypes = {
                '478': {
                    description: 'Technika 4-7-8 pomaga zrelaksować się i przygotować do snu',
                    phases: [
                        { name: 'inhale', text: 'Wdech', duration: 4000 },
                        { name: 'hold', text: 'Zatrzymaj', duration: 7000 },
                        { name: 'exhale', text: 'Wydech', duration: 8000 }
                    ]
                },
                'box': {
                    description: 'Oddychanie kwadratowe 4-4-4-4 pomaga uspokoić umysł i znaleźć równowagę',
                    phases: [
                        { name: 'box-inhale', text: 'Wdech', duration: 4000 },
                        { name: 'box-hold1', text: 'Zatrzymaj', duration: 4000 },
                        { name: 'box-exhale', text: 'Wydech', duration: 4000 },
                        { name: 'box-hold2', text: 'Zatrzymaj', duration: 4000 }
                    ]
                },
                'diaphragm': {
                    description: 'Oddychanie przeponowe głęboko dotlenia organizm i pomaga się zrelaksować',
                    phases: [
                        { name: 'inhale', text: 'Głęboki wdech przeponą', duration: 5000 },
                        { name: 'exhale', text: 'Powolny, pełny wydech', duration: 7000 }
                    ]
                }
            };
            
            // Funkcja rozpoczynająca ćwiczenie oddechowe
            function startBreathingExercise() {
                // Zatrzymaj istniejący interwał jeśli istnieje
                if (breathingInterval) {
                    clearInterval(breathingInterval);
                    breathingCircle.className = 'breathing-circle';
                    breathingText.textContent = 'Kliknij, aby rozpocząć';
                    startBreathingBtn.textContent = 'Rozpocznij ćwiczenie';
                    return;
                }
                
                const exerciseConfig = breathingTypes[currentBreathingType];
                let phase = 0;
                const phases = exerciseConfig.phases;
                
                function updateBreathingPhase() {
                    const currentPhase = phases[phase];
                    
                    // Usuń wszystkie klasy animacji
                    breathingCircle.className = 'breathing-circle';
                    
                    // Dodaj nową klasę animacji
                    setTimeout(() => {
                        breathingCircle.classList.add(currentPhase.name);
                        breathingText.textContent = currentPhase.text;
                    }, 10);
                    
                    // Przejdź do następnej fazy
                    phase = (phase + 1) % phases.length;
                    
                    // Ustaw timeout dla następnej fazy
                    breathingInterval = setTimeout(updateBreathingPhase, currentPhase.duration);
                }
                
                // Rozpocznij od pierwszej fazy
                updateBreathingPhase();
                
                // Zmień tekst przycisku
                startBreathingBtn.textContent = 'Zatrzymaj ćwiczenie';
            }
            
            // Obsługa przycisków wyboru techniki oddechowej
            document.querySelectorAll('.exercise-tab[data-breathing]').forEach(tab => {
                tab.addEventListener('click', function() {
                    // Zatrzymaj aktualne ćwiczenie
                    if (breathingInterval) {
                        clearInterval(breathingInterval);
                        breathingInterval = null;
                        breathingCircle.className = 'breathing-circle';
                        breathingText.textContent = 'Kliknij, aby rozpocząć';
                        startBreathingBtn.textContent = 'Rozpocznij ćwiczenie';
                    }
                    
                    // Ustaw nowy typ oddychania
                    currentBreathingType = this.dataset.breathing;
                    
                    // Aktualizuj opis
                    breathingDescription.textContent = breathingTypes[currentBreathingType].description;
                    
                    // Aktualizuj aktywny przycisk
                    document.querySelectorAll('.exercise-tab[data-breathing]').forEach(t => {
                        t.classList.remove('active');
                    });
                    this.classList.add('active');
                });
            });
            
            // Obsługa przycisku ćwiczenia oddechowego
            startBreathingBtn.addEventListener('click', function() {
                if (this.textContent.includes('Rozpocznij')) {
                    startBreathingExercise();
                } else {
                    if (breathingInterval) {
                        clearInterval(breathingInterval);
                        breathingInterval = null;
                    }
                    breathingCircle.className = 'breathing-circle';
                    breathingText.textContent = 'Kliknij, aby rozpocząć';
                    this.textContent = 'Rozpocznij ćwiczenie';
                }
            });
            
            // Umożliwienie kliknięcia bezpośrednio na kółko
            breathingCircle.addEventListener('click', function() {
                startBreathingBtn.click();
            });
            
            // =========== PROGRESYWNA RELAKSACJA MIĘŚNI ===========
            const muscleGroups = document.querySelectorAll('.muscle-group');
            const startMuscleBtn = document.getElementById('start-muscle-relaxation');
            const muscleProgress = document.getElementById('muscle-progress');
            let muscleRelaxationInterval = null;
            let currentMuscleGroup = 0;
            
            // Obsługa kliknięć w grupy mięśniowe
            muscleGroups.forEach(group => {
                group.addEventListener('click', function() {
                    // Przełącz widoczność instrukcji
                    const instruction = this.querySelector('.muscle-instruction');
                    instruction.classList.toggle('visible');
                    
                    // Przełącz stan aktywny grupy
                    this.classList.toggle('active');
                });
            });
            
            // Funkcja prowadząca przez pełne ćwiczenie relaksacji mięśniowej
            function startMuscleRelaxation() {
                // Zatrzymanie istniejącego ćwiczenia
                if (muscleRelaxationInterval) {
                    clearInterval(muscleRelaxationInterval);
                    muscleRelaxationInterval = null;
                    startMuscleBtn.textContent = 'Rozpocznij pełne ćwiczenie';
                    muscleGroups.forEach(group => {
                        group.classList.remove('active');
                        group.querySelector('.muscle-instruction').classList.remove('visible');
                    });
                    muscleProgress.style.width = '0%';
                    return;
                }
                
                // Przygotuj wszystkie grupy
                muscleGroups.forEach(group => {
                    group.classList.remove('active');
                    group.querySelector('.muscle-instruction').classList.remove('visible');
                });
                
                currentMuscleGroup = 0;
                startMuscleBtn.textContent = 'Zatrzymaj ćwiczenie';
                
                // Funkcja przechodząca przez poszczególne grupy mięśniowe
                function goToNextMuscleGroup() {
                    // Zakończ ćwiczenie po przejściu przez wszystkie grupy
                    if (currentMuscleGroup >= muscleGroups.length) {
                        clearInterval(muscleRelaxationInterval);
                        muscleRelaxationInterval = null;
                        startMuscleBtn.textContent = 'Rozpocznij pełne ćwiczenie';
                        
                        // Pokaż powiadomienie o zakończeniu
                        showToast('Ćwiczenie zakończone', 'Gratulacje! Ukończyłeś/aś ćwiczenie relaksacji mięśni.');
                        
                        // Resetuj grupy mięśniowe
                        muscleGroups.forEach(group => {
                            group.classList.remove('active');
                            group.querySelector('.muscle-instruction').classList.remove('visible');
                        });
                        return;
                    }
                    
                    // Aktualizuj pasek postępu
                    const progressPercentage = (currentMuscleGroup / muscleGroups.length) * 100;
                    muscleProgress.style.width = `${progressPercentage}%`;
                    
                    // Usuń aktywną klasę ze wszystkich grup
                    muscleGroups.forEach(group => {
                        group.classList.remove('active');
                        group.querySelector('.muscle-instruction').classList.remove('visible');
                    });
                    
                    // Aktywuj bieżącą grupę
                    const currentGroup = muscleGroups[currentMuscleGroup];
                    currentGroup.classList.add('active');
                    currentGroup.querySelector('.muscle-instruction').classList.add('visible');
                    
                    // Przewiń do aktywnej grupy
                    currentGroup.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    
                    // Przejdź do następnej grupy po 20 sekundach (5s napięcie + 15s relaks)
                    currentMuscleGroup++;
                    
                    // Pokaż powiadomienie
                    if (currentMuscleGroup <= muscleGroups.length) {
                        const groupName = currentGroup.querySelector('h4').textContent;
                        showToast('Grupa mięśniowa', groupName);
                    }
                }
                
                // Rozpocznij od pierwszej grupy
                goToNextMuscleGroup();
                
                // Ustaw interwał 20 sekund między grupami
                muscleRelaxationInterval = setInterval(goToNextMuscleGroup, 20000);
            }
            
            // Obsługa przycisku rozpoczęcia ćwiczenia relaksacji mięśni
            startMuscleBtn.addEventListener('click', startMuscleRelaxation);
            
            // =========== WIZUALIZACJE RELAKSACYJNE ===========
            const visualizationScene = document.getElementById('visualization-scene');
            const visualizationText = document.getElementById('visualization-text');
            const startVisualizationBtn = document.getElementById('start-visualization');
            let visualizationInterval = null;
            let currentScene = 'beach'; // domyślna scena
            
            // Teksty dla różnych scen wizualizacji
            const visualizationScenes = {
                'beach': [
                    'Wyobraź sobie, że leżysz na ciepłej, miękkiej plaży. Czujesz delikatne ciepło słońca na swojej skórze.',
                    'Fale rytmicznie uderzają o brzeg, tworząc uspokajający szum. Wdychasz świeży, morski zapach.',
                    'Z każdym oddechem czujesz się coraz bardziej zrelaksowany/a. Twoje ciało powoli zanurza się w miękkim piasku.',
                    'Niebo nad tobą jest błękitne, z kilkoma puszystymi chmurami. Słyszysz odległe krzyki mew.',
                    'Twoje mięśnie się rozluźniają, a umysł uspokaja. Pozwól sobie na całkowite odprężenie w tym spokojnym miejscu.'
                ],
                'forest': [
                    'Znajdujesz się w pięknym, starym lesie. Otaczają cię wysokie drzewa, a ich liście szumią delikatnie na wietrze.',
                    'Promienie słońca przebijają się przez korony drzew, tworząc ciepłe plamy światła na ścieżce przed tobą.',
                    'Słyszysz śpiew ptaków i delikatny szelest liści. Powietrze jest świeże i pełne zapachu żywicy.',
                    'Z każdym krokiem zagłębiasz się dalej w las, czując spokój i harmonię tego miejsca.',
                    'Znajdujesz miękkie, mchowe miejsce, gdzie możesz usiąść lub położyć się. Czujesz, jak cały stres opuszcza twoje ciało.'
                ],
                'sky': [
                    'Leżysz na miękkim kocu i patrzysz w nocne niebo pełne gwiazd. Nad tobą rozciąga się nieskończony kosmos.',
                    'Gwiazdy migoczą delikatnie, a ty dostrzegasz znane konstelacje i jasny sierp księżyca.',
                    'Powietrze jest chłodne i rześkie. Z każdym oddechem czujesz, jak twój umysł się uspokaja.',
                    'Twoje ciało staje się lekkie, niemal jakbyś mógł/mogła unosić się wśród gwiazd. Grawitacja zdaje się słabnąć.',
                    'Problemy i zmartwienia maleją, stają się małe jak drobne punkty na niebie. Czujesz głęboki spokój i połączenie z wszechświatem.'
                ]
            };
            
            // Funkcja zmieniająca scenę wizualizacji
            function changeVisualizationScene(sceneName) {
                // Usuń wszystkie klasy scen i dodaj odpowiednią
                visualizationScene.className = 'visualization-scene';
                visualizationScene.classList.add(`visualization-${sceneName}`);
                
                // Dodaj lub usuń elementy specyficzne dla sceny
                visualizationScene.innerHTML = '';
                
                if (sceneName === 'beach') {
                    // Dodaj fale dla plaży
                    for (let i = 0; i < 3; i++) {
                        const wave = document.createElement('div');
                        wave.className = 'wave';
                        visualizationScene.appendChild(wave);
                    }
                }
                
                // Dodaj overlay z tekstem
                const overlay = document.createElement('div');
                overlay.className = 'visualization-overlay';
                overlay.innerHTML = `<p class="visualization-text" id="visualization-text">${visualizationScenes[sceneName][0]}</p>`;
                visualizationScene.appendChild(overlay);
                
                // Aktualizuj referencję do elementu tekstu
                visualizationText = document.querySelector('#visualization-text');
            }
            
            // Funkcja rozpoczynająca wizualizację
            function startVisualization() {
                // Zatrzymaj istniejącą wizualizację jeśli istnieje
                if (visualizationInterval) {
                    clearInterval(visualizationInterval);
                    visualizationInterval = null;
                    startVisualizationBtn.textContent = 'Rozpocznij wizualizację';
                    return;
                }
                
                startVisualizationBtn.textContent = 'Zatrzymaj wizualizację';
                
                let currentTextIndex = 0;
                const texts = visualizationScenes[currentScene];
                
                // Funkcja aktualizująca tekst wizualizacji
                function updateVisualizationText() {
                    // Płynna zmiana tekstu
                    visualizationText.style.opacity = '0';
                    
                    setTimeout(() => {
                        visualizationText.textContent = texts[currentTextIndex];
                        visualizationText.style.opacity = '1';
                        
                        // Przejdź do następnego tekstu
                        currentTextIndex = (currentTextIndex + 1) % texts.length;
                    }, 500);
                }
                
                // Rozpocznij od pierwszego tekstu
                updateVisualizationText();
                
                // Ustaw interwał do zmiany tekstów co 10 sekund
                visualizationInterval = setInterval(updateVisualizationText, 10000);
            }
            
            // Obsługa przycisków wyboru sceny wizualizacji
            document.querySelectorAll('.visualization-scene-tabs .exercise-tab[data-scene]').forEach(tab => {
                tab.addEventListener('click', function() {
                    // Zatrzymaj aktualną wizualizację
                    if (visualizationInterval) {
                        clearInterval(visualizationInterval);
                        visualizationInterval = null;
                        startVisualizationBtn.textContent = 'Rozpocznij wizualizację';
                    }
                    
                    // Ustaw nową scenę
                    currentScene = this.dataset.scene;
                    changeVisualizationScene(currentScene);
                    
                    // Aktualizuj aktywny przycisk
                    document.querySelectorAll('.visualization-scene-tabs .exercise-tab').forEach(t => {
                        t.classList.remove('active');
                    });
                    this.classList.add('active');
                });
            });
            
            // Obsługa przycisku rozpoczęcia wizualizacji
            startVisualizationBtn.addEventListener('click', startVisualization);
            
            // =========== BAJKI NA DOBRANOC ===========
            // Obsługa akordeonu z bajkami
            const storyHeaders = document.querySelectorAll('.story-header');
            
            storyHeaders.forEach(header => {
                header.addEventListener('click', function() {
                    const storyId = this.dataset.story;
                    const content = document.getElementById(`${storyId}-story`);
                    
                    // Przełącz widoczność zawartości
                    content.classList.toggle('visible');
                    
                    // Przełącz stan aktywny nagłówka
                    this.classList.toggle('active');
                    
                    // Zamknij inne otwarte bajki
                    storyHeaders.forEach(otherHeader => {
                        if (otherHeader !== this && otherHeader.classList.contains('active')) {
                            otherHeader.classList.remove('active');
                            const otherId = otherHeader.dataset.story;
                            document.getElementById(`${otherId}-story`).classList.remove('visible');
                        }
                    });
                });
            });
            
            // Obsługa głównych zakładek ćwiczeń
            document.querySelectorAll('.exercise-tab[data-tab]').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.dataset.tab;
                    
                    // Ukryj wszystkie treści ćwiczeń
                    document.querySelectorAll('.exercise-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    // Pokaż wybraną treść
                    document.getElementById(`${tabName}-content`).classList.add('active');
                    
                    // Aktualizuj aktywny przycisk
                    document.querySelectorAll('.exercise-tab[data-tab]').forEach(t => {
                        t.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // Zatrzymaj wszystkie aktywne ćwiczenia
                    if (breathingInterval) {
                        clearInterval(breathingInterval);
                        breathingInterval = null;
                        breathingCircle.className = 'breathing-circle';
                        breathingText.textContent = 'Kliknij, aby rozpocząć';
                        startBreathingBtn.textContent = 'Rozpocznij ćwiczenie';
                    }
                    
                    if (muscleRelaxationInterval) {
                        clearInterval(muscleRelaxationInterval);
                        muscleRelaxationInterval = null;
                        startMuscleBtn.textContent = 'Rozpocznij pełne ćwiczenie';
                        muscleGroups.forEach(group => {
                            group.classList.remove('active');
                            group.querySelector('.muscle-instruction').classList.remove('visible');
                        });
                        muscleProgress.style.width = '0%';
                    }
                    
                    if (visualizationInterval) {
                        clearInterval(visualizationInterval);
                        visualizationInterval = null;
                        startVisualizationBtn.textContent = 'Rozpocznij wizualizację';
                    }
                });
            });
            
            // =========== NASŁUCHIWACZE ZDARZEŃ ===========
            
            // Nasłuchiwacze zdarzeń dla przycisków dźwięku
            soundButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const soundName = this.dataset.sound;
                    playSound(soundName);
                });
            });
            
            // Nasłuchiwacze zdarzeń dla suwaka głośności głównej
            volumeSlider.addEventListener('input', function() {
                const value = parseFloat(this.value);
                for (const audio of activeSounds.values()) {
                    audio.volume = value;
                }
                
                // Aktualizuj wszystkie suwaki indywidualnej głośności
                document.querySelectorAll('.individual-volume').forEach(slider => {
                    slider.value = value;
                });
            });
            
            // Nasłuchiwacze zdarzeń dla przycisków timera
            timerButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const minutes = parseInt(this.dataset.time);
                    setTimer(minutes);
                });
            });
            
            // Nasłuchiwacz dla niestandardowego timera
            customTimerBtn.addEventListener('click', function() {
                const minutes = parseInt(customTimerInput.value);
                if (isNaN(minutes) || minutes <= 0 || minutes > 480) {
                    showToast('Błąd', 'Wprowadź wartość między 1 a 480 minut.');
                    return;
                }
                setTimer(minutes);
                
                // Wyczyść pole input
                customTimerInput.value = '';
            });
            
            // Obsługa Enter w polu niestandardowego timera
            customTimerInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    customTimerBtn.click();
                }
            });
            
            // Obsługa zapisywania preferencji
            document.getElementById('save-preferences').addEventListener('click', function(e) {
                e.preventDefault();
                
                // Zapisz preferencje w localStorage
                const preferences = {
                    volume: volumeSlider.value,
                    theme: document.body.classList.contains('light-mode') ? 'light' : 'dark',
                    activeSounds: Array.from(activeSounds.keys())
                };
                
                localStorage.setItem('spijSloneczko-preferences', JSON.stringify(preferences));
                showToast('Zapisano', 'Twoje preferencje zostały zapisane!');
            });
            
            // Ładowanie zapisanych preferencji
            function loadSavedPreferences() {
                const savedPrefs = localStorage.getItem('spijSloneczko-preferences');
                if (!savedPrefs) return;
                
                try {
                    const preferences = JSON.parse(savedPrefs);
                    
                    // Ustaw głośność
                    if (preferences.volume) {
                        volumeSlider.value = preferences.volume;
                    }
                    
                    // Ustaw motyw (już obsłużone wcześniej)
                    
                    // Odtwórz zapisane dźwięki
                    if (preferences.activeSounds && Array.isArray(preferences.activeSounds)) {
                        preferences.activeSounds.forEach(sound => {
                            setTimeout(() => {
                                playSound(sound);
                            }, 500);
                        });
                    }
                    
                } catch (error) {
                    console.error('Błąd podczas wczytywania preferencji:', error);
                }
            }
            
            // Sprawdzenie dostępności plików dźwiękowych
            function checkSoundFiles() {
                Object.entries(sounds).forEach(([name, path]) => {
                    const testAudio = new Audio();
                    testAudio.addEventListener('error', () => {
                        console.warn(`Plik dźwiękowy "${path}" dla "${name}" nie został znaleziony.`);
                    });
                    testAudio.src = path;
                });
            }
            
            // Zapytanie o pozwolenie na powiadomienia
            if ('Notification' in window && Notification.permission !== 'granted' && Notification.permission !== 'denied') {
                Notification.requestPermission();
            }
            
            // Wczytaj preferencje po załadowaniu strony
            setTimeout(() => {
                loadSavedPreferences();
                checkSoundFiles();
            }, 1000);
        });
    </script>
