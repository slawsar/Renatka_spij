<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Śpij Słoneczko | Relaksująca aplikacja do zasypiania</title>
    <!-- Favicon -->
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <!-- Bootstrap CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <!-- Dodatkowe ikony -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Preload plików audio dla szybszego ładowania -->
    <link rel="preload" href="sounds/ocean.wav" as="audio">
    <link rel="preload" href="sounds/rain.mp3" as="audio">
    <link rel="preload" href="sounds/forest.mp3" as="audio">
    <link rel="preload" href="sounds/night.mp3" as="audio">
    <link rel="preload" href="sounds/whitenoise.wav" as="audio">
    
    <style>
        /* Główna kolorystyka i ogólne stylowanie */
        :root {
            --primary-dark: #0a1128;
            --primary-medium: #1c2541;
            --primary-light: #3a506b;
            --accent: #5bc0be;
            --accent-dark: #3a8a88;
            --text-light: #e9ecef;
        }
        
        body {
            background-color: var(--primary-dark);
            color: var(--text-light);
            font-family: 'Arial', sans-serif;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
            transition: background-color 0.5s ease;
        }
        
        body.light-mode {
            --primary-dark: #e9f5f9;
            --primary-medium: #c4e0f3;
            --primary-light: #93c5fd;
            --accent: #3b82f6;
            --accent-dark: #2563eb;
            --text-light: #1e293b;
            background-color: var(--primary-dark);
            color: var(--text-light);
        }
        
        /* Animowane tło z gwiazdami */
        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }
        
        .star {
            position: absolute;
            background-color: white;
            border-radius: 50%;
            opacity: 0;
            animation: twinkle var(--duration, 4s) infinite var(--delay, 0s);
        }
        
        @keyframes twinkle {
            0% { opacity: 0; }
            50% { opacity: var(--intensity, 1); }
            100% { opacity: 0; }
        }
        
        /* Półprzezroczyste chmury */
        .cloud {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 50%;
            filter: blur(20px);
            animation: float var(--duration, 60s) infinite linear;
            opacity: 0.3;
        }
        
        @keyframes float {
            0% { transform: translateX(-5%); }
            50% { transform: translateX(5%); }
            100% { transform: translateX(-5%); }
        }
        
        /* Główne elementy stylowania */
        .container {
            padding: 2rem 1rem;
            position: relative;
            z-index: 1;
        }
        
        header {
            text-align: center;
            padding: 2rem 0 1rem;
            position: relative;
        }
        
        h1 {
            color: var(--accent);
            font-size: 2.8rem;
            margin-bottom: 0.5rem;
            text-shadow: 0 0 10px rgba(91, 192, 190, 0.7);
        }
        
        h2 {
            color: var(--accent);
            font-size: 1.8rem;
            margin: 1.5rem 0;
        }
        
        h3 {
            color: var(--accent);
            font-size: 1.5rem;
        }
        
        .card {
            background-color: var(--primary-medium);
            border: none;
            border-radius: 15px;
            margin-bottom: 2rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
        }
        
        /* Stylowanie odtwarzacza dźwięku */
        .sound-player {
            padding: 1.5rem;
        }
        
        .sound-btn {
            background-color: var(--primary-light);
            color: var(--text-light);
            border: none;
            border-radius: 10px;
            padding: 0.8rem 1.2rem;
            margin: 0.5rem;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        
        .sound-btn:hover {
            background-color: var(--accent);
            color: var(--primary-dark);
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        
        .sound-btn.active {
            background-color: var(--accent);
            color: var(--primary-dark);
            box-shadow: 0 0 10px var(--accent);
        }
        
        .sound-card {
            background-color: var(--primary-light);
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            opacity: 0.7;
            transition: opacity 0.3s ease;
        }
        
        .sound-card.active {
            opacity: 1;
            box-shadow: 0 0 10px rgba(91, 192, 190, 0.5);
        }
        
        .sound-wave {
            display: flex;
            align-items: flex-end;
            height: 30px;
            width: 50px;
            margin-right: 10px;
        }
        
        .sound-wave.active span {
            animation: soundWave 1s infinite;
        }
        
        .sound-wave span {
            display: inline-block;
            width: 4px;
            margin: 0 2px;
            background-color: var(--accent);
            height: 5px;
            border-radius: 2px;
        }
        
        @keyframes soundWave {
            0%, 100% { height: 5px; }
            50% { height: 20px; }
        }
        
        .sound-wave span:nth-child(1) { animation-delay: 0.1s; }
        .sound-wave span:nth-child(2) { animation-delay: 0.2s; }
        .sound-wave span:nth-child(3) { animation-delay: 0.05s; }
        .sound-wave span:nth-child(4) { animation-delay: 0.3s; }
        .sound-wave span:nth-child(5) { animation-delay: 0.15s; }
        
        .controls {
            margin-top: 2rem;
        }
        
        .slider-container {
            margin: 1.5rem 0;
        }
        
        .form-label {
            color: var(--accent);
            font-weight: 500;
            font-size: 1.1rem;
            margin-bottom: 0.8rem;
        }
        
        .form-range::-webkit-slider-thumb {
            background: var(--accent);
        }
        
        .form-range::-moz-range-thumb {
            background: var(--accent);
        }
        
        /* Stylowanie timera */
        .timer-container {
            text-align: center;
            margin: 1.5rem 0;
        }
        
        .timer-display {
            font-size: 2.2rem;
            font-weight: bold;
            margin: 1rem 0;
            color: var(--accent);
            text-shadow: 0 0 5px rgba(91, 192, 190, 0.5);
        }
        
        .custom-timer-container {
            margin-top: 1rem;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .custom-timer-input {
            width: 80px;
            background-color: var(--primary-medium);
            border: 2px solid var(--accent);
            border-radius: 8px;
            color: var(--text-light);
            padding: 0.4rem;
            margin-right: 0.5rem;
            text-align: center;
        }
        
        /* Sekcja porad dotyczących snu */
        .sleep-tips {
            padding: 1.5rem;
        }
        
        .tip-item {
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--primary-light);
        }
        
        .tip-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .tip-item p {
            color: var(--text-light);
            font-size: 1rem;
            line-height: 1.6;
        }
        
        .tip-item h4 {
            color: var(--accent);
            font-size: 1.2rem;
            margin-bottom: 0.8rem;
            font-weight: 600;
        }
        
        .tip-icon {
            color: var(--accent);
            margin-right: 0.5rem;
        }
        
        /* Stylowanie dla ćwiczeń oddechowych */
        .breathing-exercise {
            text-align: center;
            padding: 2rem 0;
        }
        
        .breathing-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            margin: 0 auto;
            background-color: rgba(91, 192, 190, 0.2);
            border: 3px solid var(--accent);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: transform 0.3s ease, background-color 0.3s ease;
        }
        
        .breathing-circle.inhale {
            animation: inhale 4s forwards;
        }
        
        .breathing-circle.hold {
            animation: hold 7s forwards;
        }
        
        .breathing-circle.exhale {
            animation: exhale 8s forwards;
        }
        
        @keyframes inhale {
            from { transform: scale(1); background-color: rgba(91, 192, 190, 0.2); }
            to { transform: scale(1.5); background-color: rgba(91, 192, 190, 0.6); }
        }
        
        @keyframes hold {
            from { transform: scale(1.5); background-color: rgba(91, 192, 190, 0.6); }
            to { transform: scale(1.5); background-color: rgba(91, 192, 190, 0.6); }
        }
        
        @keyframes exhale {
            from { transform: scale(1.5); background-color: rgba(91, 192, 190, 0.6); }
            to { transform: scale(1); background-color: rgba(91, 192, 190, 0.2); }
        }
        
        /* Przełącznik trybu jasny/ciemny */
        .theme-toggle {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            color: var(--accent);
            font-size: 1.5rem;
            cursor: pointer;
            z-index: 10;
            transition: transform 0.3s ease;
        }
        
        .theme-toggle:hover {
            transform: rotate(30deg);
        }
        
        /* Stopka */
        footer {
            text-align: center;
            padding: 1.5rem 0;
            margin-top: 1rem;
            color: var(--text-light);
            opacity: 0.7;
        }
        
        /* Animacja księżyca */
        .moon {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 50px;
            height: 50px;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.7);
            z-index: 0;
            transition: background-color 0.5s ease, box-shadow 0.5s ease;
        }
        
        .light-mode .moon {
            background-color: #fbbf24;
            box-shadow: 0 0 30px rgba(251, 191, 36, 0.7);
        }
        
        /* Toast powiadomienia */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        .custom-toast {
            background-color: var(--primary-medium);
            color: var(--text-light);
            border-left: 4px solid var(--accent);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        /* Responsywność */
        @media (max-width: 768px) {
            h1 {
                font-size: 2.2rem;
            }
            
            h2 {
                font-size: 1.5rem;
            }
            
            .sound-btn {
                padding: 0.6rem 1rem;
                margin: 0.3rem;
                font-size: 0.9rem;
            }
            
            .timer-display {
                font-size: 1.8rem;
            }
            
            .moon {
                width: 40px;
                height: 40px;
                top: 15px;
                left: 15px;
            }
            
            .breathing-circle {
                width: 120px;
                height: 120px;
            }
        }
    </style>
</head>
<body>
    <!-- Tło z gwiazdami i chmurami -->
    <div class="stars" id="stars"></div>
    <div class="moon"></div>
    
    <!-- Toast powiadomienia -->
    <div class="toast-container">
        <div class="toast custom-toast" role="alert" aria-live="assertive" aria-atomic="true" id="app-toast">
            <div class="toast-header">
                <strong class="me-auto" id="toast-title">Powiadomienie</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body" id="toast-message">
                Wiadomość
            </div>
        </div>
    </div>
    
    <div class="container">
        <!-- Przełącznik trybu jasny/ciemny -->
        <button class="theme-toggle" id="theme-toggle" title="Zmień motyw">
            <i class="fas fa-moon" id="theme-icon"></i>
        </button>
        
        <!-- Nagłówek -->
        <header>
            <h1>Śpij Słoneczko</h1>
            <p class="lead">Relaksująca aplikacja stworzona przez dziubaska dla Renatki</p>
        </header>
        
        <!-- Główna zawartość -->
        <main>
            <!-- Odtwarzacz dźwięków i timer -->
            <div class="card sound-player">
                <div class="card-body">
                    <h2><i class="fas fa-music"></i> Relaksujące dźwięki</h2>
                    
                    <!-- Przyciski dźwięków -->
                    <div class="d-flex flex-wrap justify-content-center mb-4">
                        <button class="sound-btn" data-sound="ocean"><i class="fas fa-water"></i> Szum morza</button>
                        <button class="sound-btn" data-sound="rain"><i class="fas fa-cloud-rain"></i> Deszcz</button>
                        <button class="sound-btn" data-sound="forest"><i class="fas fa-tree"></i> Las</button>
                        <button class="sound-btn" data-sound="night"><i class="fas fa-moon"></i> Noc</button>
                        <button class="sound-btn" data-sound="whitenoise"><i class="fas fa-wave-square"></i> Biały szum</button>
                    </div>
                    
                    <!-- Wizualizacja aktywnych dźwięków -->
                    <div class="active-sounds my-3" id="active-sounds-container">
                        <!-- Aktywne dźwięki będą dodawane tutaj dynamicznie -->
                    </div>
                    
                    <div class="controls">
                        <!-- Kontrola głośności -->
                        <div class="slider-container">
                            <label for="volume" class="form-label"><i class="fas fa-volume-up"></i> Głośność</label>
                            <input type="range" class="form-range" id="volume" min="0" max="1" step="0.01" value="0.5">
                        </div>
                        
                        <!-- Timer -->
                        <div class="timer-container">
                            <h3><i class="fas fa-clock"></i> Timer snu</h3>
                            <div class="timer-display" id="timer-display">00:00:00</div>
                            <div class="d-flex flex-wrap justify-content-center">
                                <button class="sound-btn timer-btn" data-time="5">5 min</button>
                                <button class="sound-btn timer-btn" data-time="15">15 min</button>
                                <button class="sound-btn timer-btn" data-time="30">30 min</button>
                                <button class="sound-btn timer-btn" data-time="60">1 godz</button>
                                <button class="sound-btn timer-btn" data-time="0"><i class="fas fa-stop"></i> Wyłącz</button>
                            </div>
                            
                            <!-- Niestandardowy timer -->
                            <div class="custom-timer-container mt-3">
                                <input type="number" min="1" max="480" class="custom-timer-input" id="custom-timer-input" placeholder="min">
                                <button class="sound-btn" id="custom-timer-btn"><i class="fas fa-check"></i> Ustaw</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Ćwiczenie oddechowe -->
            <div class="card">
                <div class="card-body">
                    <h2><i class="fas fa-lungs"></i> Ćwiczenie oddechowe 4-7-8</h2>
                    <div class="breathing-exercise">
                        <p>Technika 4-7-8 pomaga zrelaksować się i przygotować do snu</p>
                        <div class="breathing-circle" id="breathing-circle">
                            <span id="breathing-text">Kliknij, aby rozpocząć</span>
                        </div>
                        <button class="sound-btn mt-4" id="start-breathing-btn">Rozpocznij ćwiczenie</button>
                    </div>
                </div>
            </div>
            
            <!-- Porady dotyczące snu -->
            <div class="card sleep-tips">
                <div class="card-body">
                    <h2><i class="fas fa-bed"></i> Porady dla lepszego snu</h2>
                    <div class="tip-item">
                        <h4><i class="fas fa-calendar-alt tip-icon"></i> Regularne godziny snu</h4>
                        <p>Staraj się chodzić spać i budzić się o tej samej porze każdego dnia, nawet w weekendy. To pomaga w regulacji twojego wewnętrznego zegara biologicznego.</p>
                    </div>
                    <div class="tip-item">
                        <h4><i class="fas fa-mobile-alt tip-icon"></i> Unikaj niebieskiego światła</h4>
                        <p>Ogranicz korzystanie z urządzeń elektronicznych (telefon, tablet, laptop) co najmniej godzinę przed snem. Niebieskie światło emitowane przez te urządzenia może zakłócać produkcję melatoniny.</p>
                    </div>
                    <div class="tip-item">
                        <h4><i class="fas fa-spa tip-icon"></i> Stwórz rytuał przed snem</h4>
                        <p>Rozwijaj rytuały, które sygnalizują twojemu ciału, że czas się zrelaksować. Może to być czytanie książki, ciepła kąpiel, medytacja lub słuchanie kojącej muzyki.</p>
                    </div>
                    <div class="tip-item">
                        <h4><i class="fas fa-mug-hot tip-icon"></i> Pij ziołowe herbaty przed snem</h4>
                        <p>Ciepłe ziołowe napary, takie jak melisa, rumianek, lawenda czy lipa, pomagają się zrelaksować i przygotować ciało do snu. Wypijaj filiżankę około godzinę przed planowanym czasem snu.</p>
                    </div>
                    <div class="tip-item">
                        <h4><i class="fas fa-temperature-low tip-icon"></i> Komfortowa sypialnia</h4>
                        <p>Upewnij się, że twoja sypialnia jest ciemna, cicha i ma odpowiednią temperaturę (18-20°C). Wygodny materac i poduszki również są ważne dla jakości snu.</p>
                    </div>
                    <div class="tip-item">
                        <h4><i class="fas fa-headphones tip-icon"></i> Personalizuj dźwięki do zasypiania</h4>
                        <p>Wybieraj dźwięki, które osobiście działają na Ciebie uspokajająco. Możesz nagrać swoje ulubione odgłosy natury podczas spaceru, szum morza z wakacji, czy nawet znajome dźwięki domowe, które kojarzą Ci się z bezpieczeństwem i spokojem.</p>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- Stopka -->
        <footer>
            <p>© 2025 Śpij Słoneczko | Stworzone z miłością przez dziubaska dla Renatki</p>
            <p><a href="#" id="save-preferences" class="text-decoration-none" style="color: var(--accent)">Zapisz preferencje</a></p>
        </footer>
    </div>
    
    <!-- Szablony HTML -->
    <template id="sound-card-template">
        <div class="sound-card mb-2">
            <div class="d-flex align-items-center">
                <div class="sound-wave me-2">
                    <span></span>
                    <span></span>
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <span class="sound-name"></span>
            </div>
            <div>
                <input type="range" class="form-range individual-volume" min="0" max="1" step="0.01" value="0.5" style="width: 100px;">
                <button class="btn-close sound-close ms-2" aria-label="Close"></button>
            </div>
        </div>
    </template>
    
    <!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    
    <!-- Główny skrypt JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Inicjalizacja tooltipów Bootstrap
            const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });
            
            // Inicjalizacja toastów
            const toastEl = document.getElementById('app-toast');
            const toast = new bootstrap.Toast(toastEl, {
                autohide: true,
                delay: 3000
            });
            
            // Funkcja do pokazywania powiadomień
            function showToast(title, message) {
                document.getElementById('toast-title').textContent = title;
                document.getElementById('toast-message').textContent = message;
                toast.show();
            }
            
            // Tworzenie gwiazd dla animowanego tła
            const starsContainer = document.getElementById('stars');
            const starsCount = 150; // Liczba gwiazd
            
            // Tworzenie gwiazd
            for (let i = 0; i < starsCount; i++) {
                const star = document.createElement('div');
                star.classList.add('star');
                
                // Losowa pozycja
                star.style.left = `${Math.random() * 100}%`;
                star.style.top = `${Math.random() * 100}%`;
                
                // Losowy rozmiar (1-3px)
                const size = Math.random() * 2 + 1;
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                
                // Losowa intensywność blasku
                star.style.setProperty('--intensity', 0.2 + Math.random() * 0.8);
                
                // Losowe opóźnienie i czas trwania animacji
                star.style.setProperty('--delay', `${Math.random() * 4}s`);
                star.style.setProperty('--duration', `${3 + Math.random() * 5}s`);
                
                starsContainer.appendChild(star);
            }
            
            // Dodanie kilku przesuwających się chmur
            for (let i = 0; i < 5; i++) {
                const cloud = document.createElement('div');
                cloud.classList.add('cloud');
                
                // Losowa pozycja
                cloud.style.left = `${Math.random() * 100}%`;
                cloud.style.top = `${Math.random() * 100}%`;
                
                // Losowy rozmiar
                const size = 100 + Math.random() * 200;
                cloud.style.width = `${size}px`;
                cloud.style.height = `${size / 2}px`;
                
                // Losowe opóźnienie i czas trwania animacji
                cloud.style.setProperty('--duration', `${50 + Math.random() * 30}s`);
                
                starsContainer.appendChild(cloud);
            }
            
            // ========== PRZEŁĄCZNIK TRYBU JASNY/CIEMNY ==========
            const themeToggle = document.getElementById('theme-toggle');
            const themeIcon = document.getElementById('theme-icon');
            
            // Sprawdź, czy użytkownik ma zapisane preferencje
            const savedTheme = localStorage.getItem('spijSloneczko-theme');
            if (savedTheme === 'light') {
                document.body.classList.add('light-mode');
                themeIcon.classList.remove('fa-moon');
                themeIcon.classList.add('fa-sun');
            }
            
            themeToggle.addEventListener('click', function() {
                document.body.classList.toggle('light-mode');
                
                if (document.body.classList.contains('light-mode')) {
                    themeIcon.classList.remove('fa-moon');
                    themeIcon.classList.add('fa-sun');
                    localStorage.setItem('spijSloneczko-theme', 'light');
                } else {
                    themeIcon.classList.remove('fa-sun');
                    themeIcon.classList.add('fa-moon');
                    localStorage.setItem('spijSloneczko-theme', 'dark');
                }
            });
            
            // ========== SYSTEM ODTWARZANIA DŹWIĘKÓW ==========
            
            // Pobranie elementów DOM
            const soundButtons = document.querySelectorAll('.sound-btn[data-sound]');
            const volumeSlider = document.getElementById('volume');
            const timerButtons = document.querySelectorAll('.timer-btn');
            const timerDisplay = document.getElementById('timer-display');
            const customTimerInput = document.getElementById('custom-timer-input');
            const customTimerBtn = document.getElementById('custom-timer-btn');
            const activeContainer = document.getElementById('active-sounds-container');
            const soundCardTemplate = document.getElementById('sound-card-template');
            
            // Timer
            let timerInterval = null;
            let timerEndTime = null;
            
            // Przechowywanie aktywnych dźwięków (jako mapa)
            const activeSounds = new Map();
            
            // ===== KONFIGURACJA DŹWIĘKÓW =====
            const sounds = {
                'ocean': 'sounds/ocean.wav',
                'rain': 'sounds/rain.mp3',
                'forest': 'sounds/forest.mp3',
                'night': 'sounds/night.mp3',
                'whitenoise': 'sounds/whitenoise.wav'
            };
            
            // Mapowanie nazw dźwięków na przyjazne nazwy polskie
            const soundNames = {
                'ocean': 'Szum morza',
                'rain': 'Deszcz',
                'forest': 'Las',
                'night': 'Noc',
                'whitenoise': 'Biały szum'
            };
            
            // Mapowanie nazw dźwięków na ikony
            const soundIcons = {
                'ocean': 'fa-water',
                'rain': 'fa-cloud-rain',
                'forest': 'fa-tree',
                'night': 'fa-moon',
                'whitenoise': 'fa-wave-square'
            };
            
            // Funkcja tworząca element karty dźwięku
            function createSoundCard(soundName, audio) {
                const template = soundCardTemplate.content.cloneNode(true);
                const card = template.querySelector('.sound-card');
                card.dataset.sound = soundName;
                
                // Ustaw nazwę dźwięku
                const nameElement = card.querySelector('.sound-name');
                nameElement.textContent = soundNames[soundName] || soundName;
                
                // Dodaj ikonę
                const iconClass = soundIcons[soundName];
                if (iconClass) {
                    const icon = document.createElement('i');
                    icon.className = `fas ${iconClass} me-2`;
                    nameElement.prepend(icon);
                }
                
                // Ustaw klasę aktywną dla wizualizacji dźwięku
                card.classList.add('active');
                const soundWave = card.querySelector('.sound-wave');
                soundWave.classList.add('active');
                
                // Obsługa indywidualnej głośności
                const volumeControl = card.querySelector('.individual-volume');
                volumeControl.value = audio.volume;
                volumeControl.addEventListener('input', function() {
                    audio.volume = parseFloat(this.value);
                });
                
                // Obsługa przycisku zamykania
                const closeBtn = card.querySelector('.sound-close');
                closeBtn.addEventListener('click', function() {
                    stopSound(soundName);
                });
                
                return card;
            }
            
            // Funkcja odtwarzania dźwięku
            function playSound(soundName) {
                // Jeśli dźwięk jest już odtwarzany, zatrzymaj go
                if (activeSounds.has(soundName)) {
                    stopSound(soundName);
                    return;
                }
                
                try {
                    // Sprawdź, czy ścieżka do dźwięku istnieje
                    if (!sounds[soundName]) {
                        showToast("Błąd", `Brak pliku dźwiękowego dla: ${soundName}`);
                        return;
                    }
                    
                    // Utwórz element audio
                    const audio = new Audio(sounds[soundName]);
                    
                    // Ustawienia
                    audio.loop = true; // Zapętlenie dźwięku
                    
                    // Pobierz aktualną wartość głośności z suwaka
                    const volume = parseFloat(volumeSlider.value);
                    audio.volume = volume;
                    
                    // Obsługa błędów ładowania pliku
                    audio.onerror = function() {
                        showToast("Błąd", `Nie można załadować pliku: ${sounds[soundName]}`);
                    };
                    
                    // Rozpocznij odtwarzanie
                    audio.play().catch(err => {
                        showToast("Błąd", "Błąd odtwarzania dźwięku. Sprawdź uprawnienia przeglądarki.");
                    });
                    
                    // Dodaj dźwięk do aktywnych
                    activeSounds.set(soundName, audio);
                    
                    // Dodaj klasę active do przycisku
                    document.querySelector(`.sound-btn[data-sound="${soundName}"]`).classList.add('active');
                    
                    // Dodaj kartę dźwięku do kontenera
                    const soundCard = createSoundCard(soundName, audio);
                    activeContainer.appendChild(soundCard);
                    
                } catch (error) {
                    showToast("Błąd", "Wystąpił nieoczekiwany błąd podczas odtwarzania dźwięku");
                }
            }
            
            // Zatrzymanie pojedynczego dźwięku
            function stopSound(soundName) {
                if (activeSounds.has(soundName)) {
                    const audio = activeSounds.get(soundName);
                    audio.pause();
                    audio.currentTime = 0;
                    activeSounds.delete(soundName);
                    
                    // Usuń klasę active z przycisku
                    const button = document.querySelector(`.sound-btn[data-sound="${soundName}"]`);
                    if (button) button.classList.remove('active');
                    
                    // Usuń kartę dźwięku
                    const card = document.querySelector(`.sound-card[data-sound="${soundName}"]`);
                    if (card) card.remove();
                }
            }
            
            // Zatrzymanie wszystkich dźwięków
            function stopAllSounds() {
                for (const [soundName, audio] of activeSounds.entries()) {
                    audio.pause();
                    audio.currentTime = 0;
                    
                    // Usuń klasę active z przycisku
                    const button = document.querySelector(`.sound-btn[data-sound="${soundName}"]`);
                    if (button) button.classList.remove('active');
                }
                
                activeSounds.clear();
                activeContainer.innerHTML = '';
            }
            
            // Funkcja do płynnego wyciszania dźwięków
            function fadeOutAllSounds(duration = 3000) {
                // Zapisz początkowe głośności dla każdego dźwięku
                const initialVolumes = new Map();
                for (const [soundName, audio] of activeSounds.entries()) {
                    initialVolumes.set(soundName, audio.volume);
                }
                
                const startTime = Date.now();
                const fadeInterval = setInterval(() => {
                    const elapsed = Date.now() - startTime;
                    const ratio = 1 - Math.min(elapsed / duration, 1);
                    
                    // Aktualizuj głośność każdego dźwięku
                    for (const [soundName, audio] of activeSounds.entries()) {
                        audio.volume = initialVolumes.get(soundName) * ratio;
                    }
                    
                    // Zatrzymaj interwał i dźwięki po zakończeniu wyciszania
                    if (elapsed >= duration) {
                        clearInterval(fadeInterval);
                        stopAllSounds();
                    }
                }, 50);
            }
            
            // Ustawienie timera
            function setTimer(minutes) {
                // Wyczyszczenie istniejącego timera
                clearInterval(timerInterval);
                
                // Usunięcie klasy active ze wszystkich przycisków timera
                timerButtons.forEach(btn => btn.classList.remove('active'));
                
                // Jeśli minutes wynosi 0, wyczyść timer
                if (minutes === 0) {
                    timerDisplay.textContent = '00:00:00';
                    timerEndTime = null;
                    return;
                }
                
                // Aktywuj przycisk timera jeśli jest standardowym timerem
                const timerBtn = document.querySelector(`.timer-btn[data-time="${minutes}"]`);
                if (timerBtn) {
                    timerBtn.classList.add('active');
                }
                
                // Oblicz czas zakończenia
                const now = new Date();
                timerEndTime = new Date(now.getTime() + minutes * 60000);
                
                // Natychmiast aktualizuj wyświetlanie timera
                updateTimerDisplay();
                
                // Ustaw interwał do aktualizacji wyświetlania
                timerInterval = setInterval(function() {
                    if (!updateTimerDisplay()) {
                        // Timer zakończony
                        clearInterval(timerInterval);
                        
                        // Płynnie wycisz wszystkie dźwięki
                        fadeOutAllSounds(5000);
                        
                        // Usuń aktywne klasy z przycisków timera
                        timerButtons.forEach(btn => btn.classList.remove('active'));
                        
                        // Powiadomienie
                        showToast('Timer zakończony', 'Dźwięki zostały płynnie wyciszone.');
                        
                        // Powiadomienie przeglądarki (opcjonalnie)
                        if ('Notification' in window && Notification.permission === 'granted') {
                            new Notification('Śpij Słoneczko', {
                                body: 'Timer zakończony. Dźwięki zostały wyciszone.',
                                icon: '/favicon.ico'
                            });
                        }
                    }
                }, 1000);
                
                // Pokaż powiadomienie o ustawieniu timera
                showToast('Timer ustawiony', `Timer ustawiony na ${minutes} minut.`);
            }
            
            // Aktualizacja wyświetlania timera
            function updateTimerDisplay() {
                if (!timerEndTime) return false;
                
                const now = new Date();
                const diff = timerEndTime - now;
                
                // Jeśli timer się zakończył
                if (diff <= 0) {
                    timerDisplay.textContent = '00:00:00';
                    return false;
                }
                
                // Oblicz godziny, minuty, sekundy
                const hours = Math.floor(diff / 3600000);
                const minutes = Math.floor((diff % 3600000) / 60000);
                const seconds = Math.floor((diff % 60000) / 1000);
                
                // Formatuj wyświetlanie
                timerDisplay.textContent = 
                    `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                return true;
            }
            
            // =========== ĆWICZENIE ODDECHOWE ===========
            const breathingCircle = document.getElementById('breathing-circle');
            const breathingText = document.getElementById('breathing-text');
            const startBreathingBtn = document.getElementById('start-breathing-btn');
            let breathingInterval = null;
            
            function startBreathingExercise() {
                // Zatrzymaj istniejący interwał jeśli istnieje
                if (breathingInterval) {
                    clearInterval(breathingInterval);
                    breathingCircle.className = 'breathing-circle';
                    breathingText.textContent = 'Kliknij, aby rozpocząć';
                    return;
                }
                
                let phase = 0;
                const phases = [
                    { name: 'inhale', text: 'Wdech', duration: 4000 },
                    { name: 'hold', text: 'Zatrzymaj', duration: 7000 },
                    { name: 'exhale', text: 'Wydech', duration: 8000 }
                ];
                
                function updateBreathingPhase() {
                    const currentPhase = phases[phase];
                    
                    // Usuń wszystkie klasy animacji
                    breathingCircle.className = 'breathing-circle';
                    
                    // Dodaj nową klasę animacji
                    setTimeout(() => {
                        breathingCircle.classList.add(currentPhase.name);
                        breathingText.textContent = currentPhase.text;
                    }, 10);
                    
                    // Przejdź do następnej fazy
                    phase = (phase + 1) % phases.length;
                }
                
                // Rozpocznij od wdechu
                updateBreathingPhase();
                
                // Ustawienie interwału do zmiany faz
                breathingInterval = setInterval(() => {
                    updateBreathingPhase();
                }, phases[phase].duration);
                
                // Zmień tekst przycisku
                startBreathingBtn.textContent = 'Zatrzymaj ćwiczenie';
            }
            
            // Obsługa przycisku ćwiczenia oddechowego
            startBreathingBtn.addEventListener('click', function() {
                if (this.textContent.includes('Rozpocznij')) {
                    startBreathingExercise();
                    this.textContent = 'Zatrzymaj ćwiczenie';
                } else {
                    if (breathingInterval) {
                        clearInterval(breathingInterval);
                        breathingInterval = null;
                    }
                    breathingCircle.className = 'breathing-circle';
                    breathingText.textContent = 'Kliknij, aby rozpocząć';
                    this.textContent = 'Rozpocznij ćwiczenie';
                }
            });
            
            // Umożliwienie kliknięcia bezpośrednio na kółko
            breathingCircle.addEventListener('click', function() {
                startBreathingBtn.click();
            });
            
            // =========== NASŁUCHIWACZE ZDARZEŃ ===========
            
            // Nasłuchiwacze zdarzeń dla przycisków dźwięku
            soundButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const soundName = this.dataset.sound;
                    playSound(soundName);
                });
            });
            
            // Nasłuchiwacze zdarzeń dla suwaka głośności głównej
            volumeSlider.addEventListener('input', function() {
                const value = parseFloat(this.value);
                for (const audio of activeSounds.values()) {
                    audio.volume = value;
                }
                
                // Aktualizuj wszystkie suwaki indywidualnej głośności
                document.querySelectorAll('.individual-volume').forEach(slider => {
                    slider.value = value;
                });
            });
            
            // Nasłuchiwacze zdarzeń dla przycisków timera
            timerButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const minutes = parseInt(this.dataset.time);
                    setTimer(minutes);
                });
            });
            
            // Nasłuchiwacz dla niestandardowego timera
            customTimerBtn.addEventListener('click', function() {
                const minutes = parseInt(customTimerInput.value);
                if (isNaN(minutes) || minutes <= 0 || minutes > 480) {
                    showToast('Błąd', 'Wprowadź wartość między 1 a 480 minut.');
                    return;
                }
                setTimer(minutes);
                
                // Wyczyść pole input
                customTimerInput.value = '';
            });
            
            // Obsługa Enter w polu niestandardowego timera
            customTimerInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    customTimerBtn.click();
                }
            });
            
            // Obsługa zapisywania preferencji
            document.getElementById('save-preferences').addEventListener('click', function(e) {
                e.preventDefault();
                
                // Zapisz preferencje w localStorage
                const preferences = {
                    volume: volumeSlider.value,
                    theme: document.body.classList.contains('light-mode') ? 'light' : 'dark',
                    activeSounds: Array.from(activeSounds.keys())
                };
                
                localStorage.setItem('spijSloneczko-preferences', JSON.stringify(preferences));
                showToast('Zapisano', 'Twoje preferencje zostały zapisane!');
            });
            
            // Ładowanie zapisanych preferencji
            function loadSavedPreferences() {
                const savedPrefs = localStorage.getItem('spijSloneczko-preferences');
                if (!savedPrefs) return;
                
                try {
                    const preferences = JSON.parse(savedPrefs);
                    
                    // Ustaw głośność
                    if (preferences.volume) {
                        volumeSlider.value = preferences.volume;
                    }
                    
                    // Ustaw motyw (już obsłużone wcześniej)
                    
                    // Odtwórz zapisane dźwięki
                    if (preferences.activeSounds && Array.isArray(preferences.activeSounds)) {
                        preferences.activeSounds.forEach(sound => {
                            setTimeout(() => {
                                playSound(sound);
                            }, 500);
                        });
                    }
                    
                } catch (error) {
                    console.error('Błąd podczas wczytywania preferencji:', error);
                }
            }
            
            // Sprawdzenie dostępności plików dźwiękowych
            function checkSoundFiles() {
                Object.entries(sounds).forEach(([name, path]) => {
                    const testAudio = new Audio();
                    testAudio.addEventListener('error', () => {
                        console.warn(`Plik dźwiękowy "${path}" dla "${name}" nie został znaleziony.`);
                    });
                    testAudio.src = path;
                });
            }
            
            // Zapytanie o pozwolenie na powiadomienia
            if ('Notification' in window && Notification.permission !== 'granted' && Notification.permission !== 'denied') {
                Notification.requestPermission();
            }
            
            // Wczytaj preferencje po załadowaniu strony
            setTimeout(() => {
                loadSavedPreferences();
                checkSoundFiles();
            }, 1000);
        });
    </script>
</body>
</html>